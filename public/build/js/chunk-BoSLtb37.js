var C=Object.defineProperty,T=(a,e,t)=>e in a?C(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,b=(a,e,t)=>T(a,typeof e!="symbol"?e+"":e,t);const w={"#":{pattern:/[0-9]/},"@":{pattern:/[a-zA-Z]/},"*":{pattern:/[a-zA-Z0-9]/}},N=(a,e,t)=>a.replaceAll(e,"").replace(t,".").replace("..",".").replace(/[^.\d]/g,""),S=(a,e,t)=>{var s;return new Intl.NumberFormat(((s=t.number)==null?void 0:s.locale)??"en",{minimumFractionDigits:a,maximumFractionDigits:e,roundingMode:"trunc"})},P=(a,e=!0,t)=>{var s,n,r,l;const u=((s=t.number)==null?void 0:s.unsigned)!==!0&&a.startsWith("-")?"-":"",p=((n=t.number)==null?void 0:n.fraction)??0;let o=S(0,p,t);const k=o.formatToParts(1000.12),m=((r=k.find(i=>i.type==="group"))==null?void 0:r.value)??" ",f=((l=k.find(i=>i.type==="decimal"))==null?void 0:l.value)??".",h=N(a,m,f);if(Number.isNaN(parseFloat(h)))return u;const v=h.split(".");if(v[1]!=null&&v[1].length>=1){const i=v[1].length<=p?v[1].length:p;o=S(i,p,t)}let d=o.format(parseFloat(h));return e?p>0&&h.endsWith(".")&&!h.slice(0,-1).includes(".")&&(d+=f):d=N(d,m,f),u+d},I=a=>JSON.parse(a.replaceAll("'",'"')),W=(a,e={})=>{const t={...e};a.dataset.maska!=null&&a.dataset.maska!==""&&(t.mask=F(a.dataset.maska)),a.dataset.maskaEager!=null&&(t.eager=E(a.dataset.maskaEager)),a.dataset.maskaReversed!=null&&(t.reversed=E(a.dataset.maskaReversed)),a.dataset.maskaTokensReplace!=null&&(t.tokensReplace=E(a.dataset.maskaTokensReplace)),a.dataset.maskaTokens!=null&&(t.tokens=O(a.dataset.maskaTokens));const s={};return a.dataset.maskaNumberLocale!=null&&(s.locale=a.dataset.maskaNumberLocale),a.dataset.maskaNumberFraction!=null&&(s.fraction=parseInt(a.dataset.maskaNumberFraction)),a.dataset.maskaNumberUnsigned!=null&&(s.unsigned=E(a.dataset.maskaNumberUnsigned)),(a.dataset.maskaNumber!=null||Object.values(s).length>0)&&(t.number=s),t},E=a=>a!==""?!!JSON.parse(a):!0,F=a=>a.startsWith("[")&&a.endsWith("]")?I(a):a,O=a=>{if(a.startsWith("{")&&a.endsWith("}"))return I(a);const e={};return a.split("|").forEach(t=>{const s=t.split(":");e[s[0]]={pattern:x()?new RegExp(s[1],"u"):new RegExp(s[1]),optional:s[2]==="optional",multiple:s[2]==="multiple",repeated:s[2]==="repeated"}}),e},x=()=>{try{return new RegExp("\\p{L}","u"),!0}catch{return!1}};class V{constructor(e={}){b(this,"opts",{}),b(this,"memo",new Map);const t={...e};if(t.tokens!=null){t.tokens=t.tokensReplace?{...t.tokens}:{...w,...t.tokens};for(const s of Object.values(t.tokens))typeof s.pattern=="string"&&(s.pattern=x()?new RegExp(s.pattern,"u"):new RegExp(s.pattern))}else t.tokens=w;Array.isArray(t.mask)&&(t.mask.length>1?t.mask=[...t.mask].sort((s,n)=>s.length-n.length):t.mask=t.mask[0]??""),t.mask===""&&(t.mask=null),this.opts=t}masked(e){return this.process(String(e),this.findMask(String(e)))}unmasked(e){return this.process(String(e),this.findMask(String(e)),!1)}isEager(){return this.opts.eager===!0}isReversed(){return this.opts.reversed===!0}completed(e){const t=this.findMask(String(e));if(this.opts.mask==null||t==null)return!1;const s=this.process(String(e),t).length;return typeof this.opts.mask=="string"?s>=this.opts.mask.length:s>=t.length}findMask(e){const t=this.opts.mask;if(t==null)return null;if(typeof t=="string")return t;if(typeof t=="function")return t(e);const s=this.process(e,t.slice(-1).pop()??"",!1);return t.find(n=>this.process(e,n,!1).length>=s.length)??""}escapeMask(e){const t=[],s=[];return e.split("").forEach((n,r)=>{n==="!"&&e[r-1]!=="!"?s.push(r-s.length):t.push(n)}),{mask:t.join(""),escaped:s}}process(e,t,s=!0){if(this.opts.number!=null)return P(e,s,this.opts);if(t==null)return e;const n=`v=${e},mr=${t},m=${s?1:0}`;if(this.memo.has(n))return this.memo.get(n);const{mask:r,escaped:l}=this.escapeMask(t),u=[],p=this.opts.tokens!=null?this.opts.tokens:{},o=this.isReversed()?-1:1,k=this.isReversed()?"unshift":"push",m=this.isReversed()?0:r.length-1,f=this.isReversed()?()=>i>-1&&c>-1:()=>i<r.length&&c<e.length,h=y=>!this.isReversed()&&y<=m||this.isReversed()&&y>=m;let v,d=-1,i=this.isReversed()?r.length-1:0,c=this.isReversed()?e.length-1:0,M=!1;for(;f();){const y=r.charAt(i),g=p[y],A=g?.transform!=null?g.transform(e.charAt(c)):e.charAt(c);if(!l.includes(i)&&g!=null?(A.match(g.pattern)!=null?(u[k](A),g.repeated?(d===-1?d=i:i===m&&i!==d&&(i=d-o),m===d&&(i-=o)):g.multiple&&(M=!0,i-=o),i+=o):g.multiple?M&&(i+=o,c-=o,M=!1):A===v?v=void 0:g.optional&&(i+=o,c-=o),c+=o):(s&&!this.isEager()&&u[k](y),A===y&&!this.isEager()?c+=o:v=y,this.isEager()||(i+=o)),this.isEager())for(;h(i)&&(p[r.charAt(i)]==null||l.includes(i));){if(s){if(u[k](r.charAt(i)),e.charAt(c)===r.charAt(i)){i+=o,c+=o;continue}}else r.charAt(i)===e.charAt(c)&&(c+=o);i+=o}}return this.memo.set(n,u.join("")),this.memo.get(n)}}class j{constructor(e,t={}){b(this,"items",new Map),b(this,"eventAbortController"),b(this,"onInput",s=>{if(s instanceof CustomEvent&&s.type==="input"&&!s.isTrusted&&!s.bubbles)return;const n=s.target,r=this.items.get(n);if(r===void 0)return;const l="inputType"in s&&s.inputType.startsWith("delete"),u=r.isEager(),p=l&&u&&r.unmasked(n.value)===""?"":n.value;this.fixCursor(n,l,()=>this.setValue(n,p))}),this.options=t,this.eventAbortController=new AbortController,this.init(this.getInputs(e))}update(e={}){this.options={...e},this.init(Array.from(this.items.keys()))}updateValue(e){var t;e.value!==""&&e.value!==((t=this.processInput(e))==null?void 0:t.masked)&&this.setValue(e,e.value)}destroy(){this.eventAbortController.abort(),this.items.clear()}init(e){const t=this.getOptions(this.options);for(const s of e){if(!this.items.has(s)){const{signal:r}=this.eventAbortController;s.addEventListener("input",this.onInput,{capture:!0,signal:r})}const n=new V(W(s,t));this.items.set(s,n),queueMicrotask(()=>this.updateValue(s)),s.selectionStart===null&&n.isEager()&&console.warn("Maska: input of `%s` type is not supported",s.type)}}getInputs(e){return typeof e=="string"?Array.from(document.querySelectorAll(e)):"length"in e?Array.from(e):[e]}getOptions(e){const{onMaska:t,preProcess:s,postProcess:n,...r}=e;return r}fixCursor(e,t,s){var n,r;const l=e.selectionStart,u=e.value;if(s(),l===null||l===u.length&&!t)return;const p=e.value,o=u.slice(0,l),k=p.slice(0,l),m=(n=this.processInput(e,o))==null?void 0:n.unmasked,f=(r=this.processInput(e,k))==null?void 0:r.unmasked;if(m===void 0||f===void 0)return;let h=l;o!==k&&(h+=t?p.length-u.length:m.length-f.length),e.setSelectionRange(h,h)}setValue(e,t){const s=this.processInput(e,t);s!==void 0&&(e.value=s.masked,this.options.onMaska!=null&&(Array.isArray(this.options.onMaska)?this.options.onMaska.forEach(n=>n(s)):this.options.onMaska(s)),e.dispatchEvent(new CustomEvent("maska",{detail:s})),e.dispatchEvent(new CustomEvent("input",{detail:s.masked})))}processInput(e,t){const s=this.items.get(e);if(s===void 0)return;let n=t??e.value;this.options.preProcess!=null&&(n=this.options.preProcess(n));let r=s.masked(n);return this.options.postProcess!=null&&(r=this.options.postProcess(r)),{masked:r,unmasked:s.unmasked(n),completed:s.completed(n)}}}const R=new WeakMap,L=(a,e)=>{if(a.arg==null||a.instance==null)return;const t="setup"in a.instance.$.type;a.arg in a.instance?a.instance[a.arg]=e:t&&console.warn("Maska: please expose `%s` using defineExpose",a.arg)},$=(a,e)=>{var t;const s=a instanceof HTMLInputElement?a:a.querySelector("input");if(s==null||s?.type==="file")return;let n={};if(e.value!=null&&(n=typeof e.value=="string"?{mask:e.value}:{...e.value}),e.arg!=null){const r=l=>{const u=e.modifiers.unmasked?l.unmasked:e.modifiers.completed?l.completed:l.masked;L(e,u)};n.onMaska=n.onMaska==null?r:Array.isArray(n.onMaska)?[...n.onMaska,r]:[n.onMaska,r]}R.has(s)?(t=R.get(s))==null||t.update(n):R.set(s,new j(s,n))};export{$ as k};
