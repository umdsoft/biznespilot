import{r as c,b as _,o as q,e as E,C as n,F as o,z as r,J as F,y as v,D as C,A as f,H as u,W as L,x as N,E as P,G as V,I as H,B as S,v as O,M as T}from"./chunk-KPSVwAyv.js";import{b as G,l as J,r as R,a as D}from"./chunk-BVrjkT6E.js";import{r as $}from"./chunk-CXygRKxK.js";import{r as Z}from"./chunk-Dfha1x8d.js";import{r as K}from"./chunk-31-ywezX.js";import{r as Q}from"./chunk-CQ-EgyBm.js";import{r as X}from"./chunk-BgOPVSvg.js";const Y={class:"relative"},ee={key:0,class:"absolute -top-1 -right-1 inline-flex items-center justify-center min-w-[18px] h-[18px] px-1 text-xs font-bold bg-red-500 text-white rounded-full animate-pulse"},te={class:"absolute right-0 mt-2 w-80 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 z-50 overflow-hidden"},re={class:"px-4 py-3 border-b border-gray-100 dark:border-gray-700 flex items-center justify-between"},ae={class:"max-h-80 overflow-y-auto"},se=["onClick"],oe={class:"flex items-start gap-3"},le={class:"flex-1 min-w-0"},ne={class:"text-sm font-medium text-gray-900 dark:text-white truncate"},ie={class:"text-xs text-gray-500 dark:text-gray-400 line-clamp-2"},de={class:"text-xs text-gray-400 dark:text-gray-500 mt-1"},ce={key:1,class:"px-4 py-8 text-center"},ue={key:0,class:"px-4 py-2 border-t border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50"},pe={__name:"AlertDropdown",setup(ge){const y=G(),s=c(!1),l=c([]),i=c(0),b=c(!1);let g=null;const h=_(()=>{const e=y.url;return e.startsWith("/operator")?"/operator/alerts":e.startsWith("/sales-head")?"/sales-head/alerts":"/business/alerts"}),A=_(()=>{const e=y.url;return e.startsWith("/operator")?"/operator/alerts/active":e.startsWith("/sales-head")?"/sales-head/alerts/active":"/business/alerts/active"}),B=()=>{s.value=!s.value,s.value&&m()},m=async()=>{try{b.value=!0;const e=await D.get(A.value);e.data&&(l.value=e.data.alerts||[],i.value=e.data.unreadCount||0)}catch(e){console.error("Failed to fetch alerts:",e)}finally{b.value=!1}},z=e=>{s.value=!1,R.visit(`${h.value}/${e.id}`)},I=async()=>{try{const e=h.value+"/mark-all-read";await D.post(e),i.value=0,l.value=l.value.map(t=>({...t,status:"read"}))}catch(e){console.error("Failed to mark all as read:",e)}},M=e=>{const t={urgent:"bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400",high:"bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400",medium:"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400",low:"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"};return t[e]||t.medium},U=e=>{const t={urgent:X,high:Q,medium:K,low:Z};return t[e]||t.medium},W=e=>{const t=new Date(e),d=new Date-t,x=Math.floor(d/6e4),k=Math.floor(d/36e5),w=Math.floor(d/864e5);return x<1?"Hozir":x<60?`${x} daqiqa oldin`:k<24?`${k} soat oldin`:w<7?`${w} kun oldin`:t.toLocaleDateString("uz-UZ")},p=e=>{e.target.closest(".relative")||(s.value=!1)},j=()=>{m(),g=setInterval(()=>{s.value||m()},6e4)};return q(()=>{document.addEventListener("click",p),j()}),E(()=>{document.removeEventListener("click",p),g&&clearInterval(g)}),(e,t)=>(o(),n("div",Y,[r("button",{onClick:B,class:"relative flex items-center justify-center w-10 h-10 rounded-xl border border-gray-200 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all duration-200",title:"Ogohlantirishlar"},[v(f($),{class:"w-5 h-5 text-gray-600 dark:text-gray-400"}),i.value>0?(o(),n("span",ee,u(i.value>99?"99+":i.value),1)):C("",!0)]),F(r("div",te,[r("div",re,[t[2]||(t[2]=r("h3",{class:"font-semibold text-gray-900 dark:text-white"},"Ogohlantirishlar",-1)),v(f(J),{href:h.value,class:"text-xs text-blue-600 dark:text-blue-400 hover:underline",onClick:t[0]||(t[0]=a=>s.value=!1)},{default:N(()=>[...t[1]||(t[1]=[P(" Barchasini ko'rish ",-1)])]),_:1},8,["href"])]),r("div",ae,[l.value.length>0?(o(!0),n(V,{key:0},H(l.value,a=>(o(),n("div",{key:a.id,class:"px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700 border-b border-gray-100 dark:border-gray-700 last:border-0 cursor-pointer",onClick:d=>z(a)},[r("div",oe,[r("div",{class:S(["w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",M(a.priority)])},[(o(),O(T(U(a.priority)),{class:"w-4 h-4"}))],2),r("div",le,[r("p",ne,u(a.title),1),r("p",ie,u(a.message),1),r("p",de,u(W(a.created_at)),1)])])],8,se))),128)):(o(),n("div",ce,[v(f($),{class:"w-12 h-12 mx-auto text-gray-300 dark:text-gray-600"}),t[3]||(t[3]=r("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"}," Hozircha ogohlantirishlar yo'q ",-1))]))]),l.value.length>0?(o(),n("div",ue,[r("button",{onClick:I,class:"w-full text-center text-sm text-blue-600 dark:text-blue-400 hover:underline"}," Barchasini o'qilgan deb belgilash ")])):C("",!0)],512),[[L,s.value]])]))}};export{pe as _};
