import{r as e,o as t,D as a,z as s,y as r,x as n,A as o,B as l,H as d,L as i,F as c,G as g,I as u,J as y,O as x,Q as p,p as m,E as b}from"./chunk-7Urb0kxg.js";import{l as f,r as k}from"./chunk-DKkye6wf.js";const v={class:"h-[calc(100vh-180px)] flex gap-6"},h={class:"flex-1 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 flex flex-col overflow-hidden"},w={class:"p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between"},_={class:"flex items-center"},j={class:"font-medium text-gray-900 dark:text-white"},S={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},C={class:"flex items-center gap-3"},O={class:"flex items-center gap-2"},T={key:0,class:"text-xs opacity-70 mb-1"},F={key:1,class:"flex items-center gap-2"},N={class:"font-mono"},z={key:2,class:"space-y-1"},K={class:"text-sm opacity-90"},X={key:0,class:"text-xs opacity-75"},B={key:3,class:"flex items-center gap-2"},E={key:4,class:"space-y-1"},H={key:0,class:"text-sm"},R={key:5,class:"space-y-1"},q={class:"flex items-center gap-2"},A={key:0,class:"text-sm"},M={key:6,class:"whitespace-pre-wrap"},P={class:"p-4 border-t border-gray-200 dark:border-gray-700"},J={class:"flex items-end gap-3"},L={class:"flex-1"},D=["onKeydown"],I=["disabled"],Q={key:0,class:"animate-spin w-5 h-5",fill:"none",viewBox:"0 0 24 24"},U={key:1,class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},V={class:"w-80 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden"},Y={class:"p-4 space-y-4"},G={class:"flex items-center justify-center"},W={class:"w-20 h-20 rounded-full flex items-center justify-center bg-blue-100 dark:bg-blue-900/30"},Z={class:"text-3xl font-bold text-blue-600 dark:text-blue-400"},$={class:"text-center"},ee={class:"text-lg font-medium text-gray-900 dark:text-white"},te={key:0,class:"text-gray-500 dark:text-gray-400"},ae={class:"space-y-3"},se={class:"p-3 bg-gray-50 dark:bg-gray-900 rounded-lg"},re={class:"font-medium text-gray-900 dark:text-white"},ne={key:0,class:"p-3 bg-gray-50 dark:bg-gray-900 rounded-lg"},oe={class:"font-medium text-gray-900 dark:text-white"},le={key:1,class:"p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg"},de={class:"font-medium text-yellow-700 dark:text-yellow-300"},ie={key:2,class:"p-3 bg-gray-50 dark:bg-gray-900 rounded-lg"},ce={class:"flex flex-wrap gap-1"},ge={key:0,class:"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg"},ue={class:"font-medium text-green-700 dark:text-green-300"},ye={class:"inline-block mt-1 px-2 py-0.5 bg-green-200 dark:bg-green-800/30 text-green-800 dark:text-green-200 text-xs rounded-full"},xe={__name:"TelegramConversationShow",props:{bot:Object,conversation:Object,user:Object,messages:{type:Array,default:()=>[]},lead:Object,panelType:{type:String,default:"business",validator:e=>["business","marketing"].includes(e)}},setup(xe){const pe=xe,me=(e,t=null)=>{const a="business"===pe.panelType?"business.":"marketing.";return t?route(a+e,t):route(a+e)},be=e(null),fe=e(""),ke=e(!1),ve=e=>{if(!e)return"?";return e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2)},he=e=>{const t=e.content;if(!t)return{};if("string"==typeof t)try{return JSON.parse(t)}catch{return{text:t}}return t},we=e=>{const t=he(e);return t.command?"command":t.phone_number?"contact":t.latitude&&t.longitude?"location":t.photo||t.file_id?"photo":t.document||t.file_name?"document":"text"},_e=e=>{const t=he(e);return t.text?t.text:"string"==typeof e.content?e.content:"object"==typeof t&&Object.keys(t).length>0?t.message?t.message:t.body?t.body:"[Xabar]":e.content||""},je=e=>{const t={active:"bg-green-100 dark:bg-green-900/30",handoff:"bg-yellow-100 dark:bg-yellow-900/30",closed:"bg-gray-100 dark:bg-gray-700"};return t[e]||t.active},Se=e=>{const t={active:"text-green-600 dark:text-green-400",handoff:"text-yellow-600 dark:text-yellow-400",closed:"text-gray-600 dark:text-gray-400"};return t[e]||t.active},Ce=e=>{const t={active:"px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400",handoff:"px-2.5 py-1 rounded-full text-xs font-medium bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400",closed:"px-2.5 py-1 rounded-full text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"};return t[e]||t.active},Oe=async()=>{if(fe.value.trim()&&!ke.value){ke.value=!0;try{const e=await fetch(me("telegram-funnels.conversations.send",[pe.bot.id,pe.conversation.id]),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content,Accept:"application/json"},body:JSON.stringify({text:fe.value})}),t=await e.json();t.success?(fe.value="",k.reload({only:["messages"]})):alert(t.message||"Xabar yuborishda xatolik")}catch(e){alert("Server bilan bog'lanishda xatolik")}finally{ke.value=!1}}},Te=async()=>{await fetch(me("telegram-funnels.conversations.assign",[pe.bot.id,pe.conversation.id]),{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content}}),k.reload()},Fe=async()=>{confirm("Suhbatni yopishni xohlaysizmi?")&&(await fetch(me("telegram-funnels.conversations.close",[pe.bot.id,pe.conversation.id]),{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content}}),k.reload())},Ne=async()=>{await fetch(me("telegram-funnels.conversations.reopen",[pe.bot.id,pe.conversation.id]),{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content}}),k.reload()};return t(()=>{m(()=>{be.value&&(be.value.scrollTop=be.value.scrollHeight)})}),(e,t)=>{return b(),a("div",v,[s("div",h,[s("div",w,[s("div",_,[r(o(f),{href:me("telegram-funnels.conversations.index",xe.bot.id),class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 mr-4"},{default:n(()=>[...t[1]||(t[1]=[s("svg",{class:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),_:1},8,["href"]),s("div",{class:l(["w-10 h-10 rounded-full flex items-center justify-center mr-3",je(xe.conversation.status)])},[s("span",{class:l(["text-lg font-semibold",Se(xe.conversation.status)])},d(ve(xe.user.full_name)),3)],2),s("div",null,[s("p",j,d(xe.user.full_name||"Noma'lum"),1),xe.user.username?(b(),a("p",S,"@"+d(xe.user.username),1)):i("",!0)])]),s("div",C,[s("span",{class:l(Ce(xe.conversation.status))},d((m=xe.conversation.status,{active:"Faol",handoff:"Handoff",closed:"Yopilgan"}[m]||m)),3),s("div",O,["handoff"!==xe.conversation.status||xe.conversation.assigned_operator?i("",!0):(b(),a("button",{key:0,onClick:Te,class:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors"}," Menga biriktirish ")),"closed"!==xe.conversation.status?(b(),a("button",{key:1,onClick:Fe,class:"px-3 py-1.5 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 text-sm font-medium rounded-lg transition-colors"}," Yopish ")):(b(),a("button",{key:2,onClick:Ne,class:"px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-colors"}," Qayta ochish "))])])]),s("div",{ref_key:"messagesContainer",ref:be,class:"flex-1 overflow-y-auto p-4 space-y-4"},[(b(!0),a(c,null,g(xe.messages,e=>(b(),a("div",{key:e.id,class:l(["flex","outgoing"===e.direction?"justify-end":"justify-start"])},[s("div",{class:l(["max-w-[70%] rounded-2xl px-4 py-2","outgoing"===e.direction?"bg-blue-600 text-white rounded-br-md":"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white rounded-bl-md"])},["operator"===e.sender_type?(b(),a("div",T," Operator ")):i("",!0),"command"===we(e)?(b(),a("div",F,[t[2]||(t[2]=s("span",{class:"text-lg"},"âš¡",-1)),s("span",N,d(he(e).command),1)])):"contact"===we(e)?(b(),a("div",z,[t[3]||(t[3]=s("div",{class:"flex items-center gap-2"},[s("span",{class:"text-lg"},"ðŸ“±"),s("span",{class:"font-medium"},"Kontakt yuborildi")],-1)),s("p",K,d(he(e).phone_number),1),he(e).first_name?(b(),a("p",X,d(he(e).first_name)+" "+d(he(e).last_name||""),1)):i("",!0)])):"location"===we(e)?(b(),a("div",B,[...t[4]||(t[4]=[s("span",{class:"text-lg"},"ðŸ“",-1),s("span",null,"Lokatsiya yuborildi",-1)])])):"photo"===we(e)?(b(),a("div",E,[t[5]||(t[5]=s("div",{class:"flex items-center gap-2"},[s("span",{class:"text-lg"},"ðŸ–¼ï¸"),s("span",null,"Rasm")],-1)),he(e).caption?(b(),a("p",H,d(he(e).caption),1)):i("",!0)])):"document"===we(e)?(b(),a("div",R,[s("div",q,[t[6]||(t[6]=s("span",{class:"text-lg"},"ðŸ“„",-1)),s("span",null,d(he(e).file_name||"Fayl"),1)]),he(e).caption?(b(),a("p",A,d(he(e).caption),1)):i("",!0)])):(b(),a("p",M,d(_e(e)),1)),s("p",{class:l(["text-xs mt-1","outgoing"===e.direction?"text-blue-100":"text-gray-500 dark:text-gray-400"])},d(e.created_at),3)],2)],2))),128))],512),s("div",P,[s("div",J,[s("div",L,[u(s("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>fe.value=e),onKeydown:x(p(Oe,["exact","prevent"]),["enter"]),rows:"2",class:"w-full px-4 py-3 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 dark:text-white resize-none",placeholder:"Xabar yozing..."},null,40,D),[[y,fe.value]])]),s("button",{onClick:Oe,disabled:!fe.value.trim()||ke.value,class:"px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white font-medium rounded-xl transition-colors flex items-center gap-2"},[ke.value?(b(),a("svg",Q,[...t[7]||(t[7]=[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(b(),a("svg",U,[...t[8]||(t[8]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"},null,-1)])]))],8,I)])])]),s("div",V,[t[14]||(t[14]=s("div",{class:"p-4 border-b border-gray-200 dark:border-gray-700"},[s("h3",{class:"font-semibold text-gray-900 dark:text-white"},"Foydalanuvchi ma'lumotlari")],-1)),s("div",Y,[s("div",G,[s("div",W,[s("span",Z,d(ve(xe.user.full_name)),1)])]),s("div",$,[s("p",ee,d(xe.user.full_name||"Noma'lum"),1),xe.user.username?(b(),a("p",te,"@"+d(xe.user.username),1)):i("",!0)]),s("div",ae,[s("div",se,[t[9]||(t[9]=s("p",{class:"text-xs text-gray-500 dark:text-gray-400 mb-1"},"Telegram ID",-1)),s("p",re,d(xe.user.telegram_id),1)]),xe.user.phone?(b(),a("div",ne,[t[10]||(t[10]=s("p",{class:"text-xs text-gray-500 dark:text-gray-400 mb-1"},"Telefon",-1)),s("p",oe,d(xe.user.phone),1)])):i("",!0),xe.conversation.handoff_reason?(b(),a("div",le,[t[11]||(t[11]=s("p",{class:"text-xs text-yellow-600 dark:text-yellow-400 mb-1"},"Handoff sababi",-1)),s("p",de,d(xe.conversation.handoff_reason),1)])):i("",!0),xe.user.tags&&xe.user.tags.length>0?(b(),a("div",ie,[t[12]||(t[12]=s("p",{class:"text-xs text-gray-500 dark:text-gray-400 mb-2"},"Teglar",-1)),s("div",ce,[(b(!0),a(c,null,g(xe.user.tags,e=>(b(),a("span",{key:e,class:"px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 text-xs rounded-full"},d(e),1))),128))])])):i("",!0)]),xe.lead?(b(),a("div",ge,[t[13]||(t[13]=s("p",{class:"text-xs text-green-600 dark:text-green-400 mb-1"},"Bog'langan Lid",-1)),s("p",ue,d(xe.lead.name),1),s("span",ye,d(xe.lead.status),1)])):i("",!0)])])]);var m}}};export{xe as _};
