import{r as M,o as P,w as z,b as f,v as A,x as C,y as n,z as t,A as c,D as i,L as h,I as U,J as V,E as d,B as g,H as s,S as v,C as x,F as D,G as q}from"./chunk-BcTZxe-J.js";import{b as E,h as K,l as O,a as Y}from"./chunk-BYRtWSr0.js";import{_ as Z}from"./chunk-DkmELHfI.js";import{u as J}from"./app-CPufef6f.js";import{r as B}from"./chunk-I93QdGKi.js";import{r as T}from"./chunk-qVc0_oyq.js";import{r as H}from"./chunk-aL39oRCf.js";import{r as L}from"./chunk-DnfwDglZ.js";import{r as G}from"./chunk-Ba8J67bG.js";import{r as I}from"./chunk-D58UsNjm.js";import{r as Q}from"./chunk-Rs1WNzbn.js";import{r as X}from"./chunk-CQoMtUf7.js";import{r as W}from"./chunk-Brk9BpGk.js";import{r as tt}from"./chunk-L32cCIyO.js";import"./chunk-D6nU8-nU.js";import"./chunk-BVYwhYNk.js";import"./chunk-BqueMrU7.js";import"./chunk-_yYzsx_i.js";import"./chunk-CJsSO8V8.js";import"./chunk-LBbTbQSS.js";import"./chunk-DNp5bQOL.js";import"./chunk-CG0drqHE.js";import"./chunk-CklLzvQL.js";import"./chunk-CnrLL2pV.js";import"./chunk-BHX0ueEB.js";import"./chunk-C1xeNfMu.js";const et={class:"py-6 px-4 sm:px-6 lg:px-8"},st={class:"mb-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4"},rt={class:"flex items-center gap-4"},at=["disabled"],ot={key:0},lt={key:1},dt={key:0,class:"flex items-center justify-center py-20"},it={key:1,class:"space-y-8"},nt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"},ct={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-100 dark:border-gray-700"},gt={class:"flex items-center justify-between mb-4"},xt={class:"w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-xl flex items-center justify-center"},ut={class:"space-y-2"},mt={class:"text-3xl font-bold text-gray-900 dark:text-white"},pt={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2"},_t={class:"text-xs text-gray-500"},yt={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-100 dark:border-gray-700"},bt={class:"flex items-center justify-between mb-4"},ht={class:"w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-xl flex items-center justify-center"},ft={key:0,class:"flex items-center text-green-600"},vt={key:1,class:"flex items-center text-red-600"},wt={class:"space-y-2"},kt={class:"text-2xl font-bold text-gray-900 dark:text-white"},jt={class:"text-sm text-gray-500"},Ft={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-100 dark:border-gray-700"},Mt={class:"flex items-center justify-between mb-4"},Dt={class:"w-12 h-12 bg-orange-100 dark:bg-orange-900/30 rounded-xl flex items-center justify-center"},qt={class:"text-sm font-medium text-orange-600 dark:text-orange-400"},Bt={class:"space-y-2"},$t={class:"text-2xl font-bold text-gray-900 dark:text-white"},Rt={class:"text-sm text-gray-500"},St={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-100 dark:border-gray-700"},Ct={class:"flex items-center justify-between mb-4"},It={class:"w-12 h-12 bg-red-100 dark:bg-red-900/30 rounded-xl flex items-center justify-center"},Nt={key:0,class:"px-2 py-1 text-xs font-medium text-red-600 bg-red-100 rounded-full"},Pt={class:"space-y-2"},zt={class:"text-2xl font-bold text-gray-900 dark:text-white"},At={class:"text-sm text-red-600"},Ut={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Vt={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-100 dark:border-gray-700"},Et={class:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center"},Kt={class:"flex items-end justify-between"},Ot={class:"text-4xl font-bold text-gray-900 dark:text-white"},Yt={class:"text-sm text-gray-500"},Zt={class:"text-right"},Jt={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-100 dark:border-gray-700"},Tt={class:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center"},Ht={class:"flex items-end justify-between"},Lt={class:"text-4xl font-bold text-gray-900 dark:text-white"},Gt={class:"text-sm text-gray-500"},Qt={class:"h-16 w-16 rounded-full border-4 border-blue-500 flex items-center justify-center"},Xt={class:"text-lg font-bold text-blue-600"},Wt={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-100 dark:border-gray-700"},te={class:"flex items-center justify-between mb-6"},ee={class:"text-lg font-semibold text-gray-900 dark:text-white flex items-center"},se={class:"flex gap-2 text-sm"},re={class:"px-2 py-1 bg-green-100 text-green-700 rounded-full"},ae={class:"px-2 py-1 bg-red-100 text-red-700 rounded-full"},oe={class:"overflow-x-auto"},le={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},de={class:"divide-y divide-gray-200 dark:divide-gray-700"},ie={class:"px-4 py-4"},ne={class:"px-4 py-4"},ce={class:"flex items-center"},ge={class:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white font-bold"},xe={class:"ml-3 font-medium text-gray-900 dark:text-white"},ue={class:"px-4 py-4 text-right text-gray-500"},me={class:"px-4 py-4 text-right font-medium text-gray-900 dark:text-white"},pe={class:"px-4 py-4 text-right"},_e={class:"flex items-center justify-end"},ye={class:"w-20 bg-gray-200 dark:bg-gray-700 rounded-full h-2 mr-2"},be={class:"px-4 py-4 text-right"},he={class:"px-4 py-4 text-right font-medium"},fe={key:0,class:"text-center py-8 text-gray-500"},ve={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},we={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-100 dark:border-gray-700"},ke={class:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center"},je={class:"space-y-4"},Fe={class:"text-sm text-gray-600 dark:text-gray-400"},Me={class:"flex items-center"},De={class:"font-medium text-gray-900 dark:text-white min-w-[100px] text-right"},qe={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-100 dark:border-gray-700"},Be={class:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center"},$e={class:"grid grid-cols-2 gap-4 mb-4"},Re={class:"bg-red-50 dark:bg-red-900/20 rounded-xl p-4"},Se={class:"text-3xl font-bold text-red-600"},Ce={class:"bg-red-50 dark:bg-red-900/20 rounded-xl p-4"},Ie={class:"text-2xl font-bold text-red-600"},Ne={key:0,class:"bg-gray-50 dark:bg-gray-700/50 rounded-xl p-4"},Pe={class:"font-medium text-gray-900 dark:text-white"},ze={class:"text-sm text-gray-500"},Ae={key:1,class:"mt-3 bg-gray-50 dark:bg-gray-700/50 rounded-xl p-4"},Ue={class:"font-medium text-gray-900 dark:text-white"},Ve={class:"text-sm text-gray-500"},Ee={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-100 dark:border-gray-700"},Ke={class:"text-lg font-semibold text-gray-900 dark:text-white mb-6 flex items-center"},Oe={class:"h-64 flex items-end justify-between gap-4"},Ye={class:"w-full flex flex-col items-center gap-1 h-48"},Ze=["title"],Je=["title"],Te={class:"mt-2 text-center"},He={class:"text-xs font-medium text-gray-900 dark:text-white"},Le={class:"text-xs text-gray-500"},Ge={key:2,class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-12 text-center"},ks={__name:"Dashboard",props:{currentBusiness:{type:Object,default:null}},setup(N){J(),E();const $=N,b=M(!1),w=M(new Date().toISOString().slice(0,7)),p=M(null),F=async()=>{if($.currentBusiness?.id){b.value=!0;try{const l=await Y.get(`/api/v1/businesses/${$.currentBusiness.id}/sales-analytics/dashboard`,{params:{date:w.value+"-01"}});p.value=l.data.data}catch(l){console.error("Error fetching sales dashboard:",l)}finally{b.value=!1}}};P(()=>{F()}),z(w,()=>{F()});const a=f(()=>p.value?.current_period||{}),k=f(()=>p.value?.manager_rankings||{}),_=f(()=>p.value?.receivables||{}),u=f(()=>p.value?.rejection_analysis||{}),y=f(()=>p.value?.trend||[]),R=l=>l<0?"text-red-600 bg-red-100":l<.5?"text-orange-600 bg-orange-100":l<1?"text-yellow-600 bg-yellow-100":l>=1?"text-green-600 bg-green-100":"text-gray-600 bg-gray-100",S=l=>l>=100?"bg-green-500":l>=80?"bg-blue-500":l>=50?"bg-yellow-500":"bg-red-500",j=l=>l?new Intl.NumberFormat("uz-UZ").format(Math.round(l)):"0",m=l=>l?new Intl.NumberFormat("uz-UZ",{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0}).format(l)+" UZS":"0 UZS";return(l,e)=>(d(),A(Z,null,{default:C(()=>[n(c(K),{title:"Sotuv Dashboardi - ROP"}),t("div",et,[t("div",st,[e[1]||(e[1]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900 dark:text-white"}," Sotuv bo'limi dashboardi "),t("p",{class:"text-gray-500 dark:text-gray-400 mt-1"}," Denis Shenukov metodologiyasi asosida tahlil ")],-1)),t("div",rt,[U(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>w.value=r),type:"month",class:"rounded-lg border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[V,w.value]]),t("button",{onClick:F,disabled:b.value,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors"},[b.value?(d(),i("span",ot,"Yuklanmoqda...")):(d(),i("span",lt,"Yangilash"))],8,at)])]),b.value?(d(),i("div",dt,[...e[2]||(e[2]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"},null,-1)])])):p.value?(d(),i("div",it,[t("div",nt,[t("div",ct,[t("div",gt,[t("div",xt,[n(c(B),{class:"w-6 h-6 text-blue-600 dark:text-blue-400"})]),a.value.has_target?(d(),i("span",{key:0,class:g(["px-3 py-1 text-sm font-medium rounded-full",R(a.value.kpi_score)])}," KPI: "+s((a.value.kpi_score*100).toFixed(1))+"% ",3)):h("",!0)]),t("div",ut,[e[3]||(e[3]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Reja bajarilishi",-1)),t("p",mt,s(a.value.completion_percent?.toFixed(1)||0)+"% ",1),t("div",pt,[t("div",{class:g(["h-2 rounded-full transition-all",S(a.value.completion_percent)]),style:v({width:Math.min(a.value.completion_percent||0,100)+"%"})},null,6)]),t("p",_t,s(a.value.kpi_interpretation?.message),1)])]),t("div",yt,[t("div",bt,[t("div",ht,[n(c(T),{class:"w-6 h-6 text-green-600 dark:text-green-400"})]),a.value.is_on_track?(d(),i("div",ft,[n(c(H),{class:"w-5 h-5 mr-1"}),e[4]||(e[4]=t("span",{class:"text-sm font-medium"},"Trendda",-1))])):(d(),i("div",vt,[n(c(L),{class:"w-5 h-5 mr-1"}),e[5]||(e[5]=t("span",{class:"text-sm font-medium"},"Orqada",-1))]))]),t("div",wt,[e[6]||(e[6]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Haqiqiy daromad",-1)),t("p",kt,s(m(a.value.fact_revenue)),1),t("p",jt," Reja: "+s(m(a.value.plan_revenue)),1)])]),t("div",Ft,[t("div",Mt,[t("div",Dt,[n(c(G),{class:"w-6 h-6 text-orange-600 dark:text-orange-400"})]),t("span",qt,s(a.value.days_remaining)+" kun qoldi ",1)]),t("div",Bt,[e[7]||(e[7]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Qolgan maqsad",-1)),t("p",$t,s(m(a.value.remaining_revenue)),1),t("p",Rt," Kunlik kerak: "+s(m(a.value.daily_target)),1)])]),t("div",St,[t("div",Ct,[t("div",It,[n(c(I),{class:"w-6 h-6 text-red-600 dark:text-red-400"})]),_.value.overdue_percent>20?(d(),i("span",Nt," Xavf! ")):h("",!0)]),t("div",Pt,[e[8]||(e[8]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Debitorka",-1)),t("p",zt,s(m(_.value.total_amount)),1),t("p",At," Muddati o'tgan: "+s(m(_.value.overdue_amount))+" ("+s(_.value.overdue_percent?.toFixed(1))+"%) ",1)])])]),t("div",Ut,[t("div",Vt,[t("h3",Et,[n(c(Q),{class:"w-5 h-5 mr-2 text-green-600"}),e[9]||(e[9]=x(" Bitimlar ",-1))]),t("div",Kt,[t("div",null,[t("p",Ot,s(a.value.deals?.fact||0),1),t("p",Yt," Rejadan "+s(a.value.deals?.plan||0)+" ta ",1)]),t("div",Zt,[t("p",{class:g(["text-2xl font-bold",(a.value.deals?.percent||0)>=100?"text-green-600":"text-orange-600"])},s(a.value.deals?.percent?.toFixed(1)||0)+"% ",3),e[10]||(e[10]=t("p",{class:"text-sm text-gray-500"},"bajarildi",-1))])])]),t("div",Jt,[t("h3",Tt,[n(c(X),{class:"w-5 h-5 mr-2 text-blue-600"}),e[11]||(e[11]=x(" Yangi mijozlar ",-1))]),t("div",Ht,[t("div",null,[t("p",Lt,s(a.value.new_clients?.fact||0),1),t("p",Gt," Rejadan "+s(a.value.new_clients?.plan||0)+" ta ",1)]),t("div",Qt,[t("span",Xt,s(a.value.new_clients?.plan>0?Math.round(a.value.new_clients?.fact/a.value.new_clients?.plan*100):0)+"% ",1)])])])]),t("div",Wt,[t("div",te,[t("h3",ee,[n(c(W),{class:"w-5 h-5 mr-2 text-yellow-500"}),e[12]||(e[12]=x(" Menejerlar reytingi ",-1))]),t("div",se,[t("span",re,s(k.value.on_target_count||0)+" rejada ",1),t("span",ae,s(k.value.below_target_count||0)+" orqada ",1)])]),t("div",oe,[t("table",le,[e[13]||(e[13]=t("thead",null,[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"#"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Menejer"),t("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Reja"),t("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Fakt"),t("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Bajarilish"),t("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"KPI"),t("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Bitimlar")])],-1)),t("tbody",de,[(d(!0),i(D,null,q(k.value.rankings,(r,o)=>(d(),i("tr",{key:r.user_id,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50"},[t("td",ie,[t("span",{class:g(["inline-flex items-center justify-center w-8 h-8 rounded-full font-bold text-sm",o===0?"bg-yellow-100 text-yellow-700":o===1?"bg-gray-100 text-gray-700":o===2?"bg-orange-100 text-orange-700":"bg-gray-50 text-gray-500"])},s(o+1),3)]),t("td",ne,[t("div",ce,[t("div",ge,s(r.user_name?.charAt(0)||"?"),1),t("span",xe,s(r.user_name),1)])]),t("td",ue,s(j(r.plan)),1),t("td",me,s(j(r.fact)),1),t("td",pe,[t("div",_e,[t("div",ye,[t("div",{class:g(["h-2 rounded-full",S(r.completion_percent)]),style:v({width:Math.min(r.completion_percent,100)+"%"})},null,6)]),t("span",{class:g(r.completion_percent>=100?"text-green-600":"text-gray-600")},s(r.completion_percent?.toFixed(1))+"% ",3)])]),t("td",be,[t("span",{class:g(["px-2 py-1 text-sm font-medium rounded-full",R(r.kpi_score)])},s((r.kpi_score*100).toFixed(0))+"% ",3)]),t("td",he,s(r.deals_closed),1)]))),128))])])]),k.value.rankings?.length?h("",!0):(d(),i("div",fe," Menejer ma'lumotlari topilmadi "))]),t("div",ve,[t("div",we,[t("h3",ke,[n(c(I),{class:"w-5 h-5 mr-2 text-red-600"}),e[14]||(e[14]=x(" Debitorka yoshi (Aging) ",-1))]),t("div",je,[(d(!0),i(D,null,q(_.value.aging,(r,o)=>(d(),i("div",{key:o,class:"flex items-center justify-between"},[t("span",Fe,s(o==="current"?"Joriy":o==="1_30_days"?"1-30 kun":o==="31_60_days"?"31-60 kun":o==="61_90_days"?"61-90 kun":"90+ kun"),1),t("div",Me,[t("div",{class:g(["h-4 rounded mr-3",o==="current"?"bg-green-500":o==="1_30_days"?"bg-yellow-500":o==="31_60_days"?"bg-orange-500":"bg-red-500"]),style:v({width:_.value.total_amount>0?Math.max(r/_.value.total_amount*200,4)+"px":"4px"})},null,6),t("span",De,s(m(r)),1)])]))),128))])]),t("div",qe,[t("h3",Be,[n(c(tt),{class:"w-5 h-5 mr-2 text-red-600"}),e[15]||(e[15]=x(" Yo'qotilgan bitimlar tahlili ",-1))]),t("div",$e,[t("div",Re,[t("p",Se,s(u.value.total_lost||0),1),e[16]||(e[16]=t("p",{class:"text-sm text-gray-500"},"Jami yo'qotilgan",-1))]),t("div",Ce,[t("p",Ie,s(m(u.value.total_lost_value)),1),e[17]||(e[17]=t("p",{class:"text-sm text-gray-500"},"Potensial qiymat",-1))])]),u.value.top_reason?(d(),i("div",Ne,[e[18]||(e[18]=t("p",{class:"text-sm text-gray-500 mb-1"},"Eng ko'p rad etish sababi:",-1)),t("p",Pe,[x(s(u.value.top_reason.reason_name)+" ",1),t("span",ze,"("+s(u.value.top_reason.count)+" marta)",1)])])):h("",!0),u.value.top_competitor?(d(),i("div",Ae,[e[19]||(e[19]=t("p",{class:"text-sm text-gray-500 mb-1"},"Asosiy raqobatchi:",-1)),t("p",Ue,[x(s(u.value.top_competitor.competitor_name)+" ",1),t("span",Ve,"("+s(u.value.top_competitor.count)+" marta)",1)])])):h("",!0)])]),t("div",Ee,[t("h3",Ke,[n(c(B),{class:"w-5 h-5 mr-2 text-blue-600"}),e[20]||(e[20]=x(" 6 oylik trend ",-1))]),t("div",Oe,[(d(!0),i(D,null,q(y.value,r=>(d(),i("div",{key:r.month,class:"flex-1 flex flex-col items-center"},[t("div",Ye,[t("div",{class:"w-6 bg-gray-300 dark:bg-gray-600 rounded-t transition-all",style:v({height:y.value.length>0&&Math.max(...y.value.map(o=>o.plan))>0?r.plan/Math.max(...y.value.map(o=>o.plan))*100+"%":"0%"}),title:"Reja: "+j(r.plan)},null,12,Ze),t("div",{class:g(["w-6 rounded-t transition-all",r.completion_percent>=100?"bg-green-500":"bg-blue-500"]),style:v({height:y.value.length>0&&Math.max(...y.value.map(o=>o.plan))>0?r.fact/Math.max(...y.value.map(o=>o.plan))*100+"%":"0%"}),title:"Fakt: "+j(r.fact)},null,14,Je)]),t("div",Te,[t("p",He,s(r.completion_percent?.toFixed(0))+"% ",1),t("p",Le,s(r.month_name?.slice(0,3)),1)])]))),128))]),e[21]||(e[21]=t("div",{class:"flex justify-center gap-6 mt-4"},[t("div",{class:"flex items-center"},[t("div",{class:"w-4 h-4 bg-gray-300 dark:bg-gray-600 rounded mr-2"}),t("span",{class:"text-sm text-gray-500"},"Reja")]),t("div",{class:"flex items-center"},[t("div",{class:"w-4 h-4 bg-blue-500 rounded mr-2"}),t("span",{class:"text-sm text-gray-500"},"Fakt")]),t("div",{class:"flex items-center"},[t("div",{class:"w-4 h-4 bg-green-500 rounded mr-2"}),t("span",{class:"text-sm text-gray-500"},"100%+ bajarildi")])],-1))])])):b.value?h("",!0):(d(),i("div",Ge,[n(c(B),{class:"w-16 h-16 mx-auto text-gray-400 mb-4"}),e[23]||(e[23]=t("h3",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-2"}," Ma'lumot topilmadi ",-1)),e[24]||(e[24]=t("p",{class:"text-gray-500 mb-6"}," Ushbu davr uchun sotuv ma'lumotlari mavjud emas. Avval sotuv rejasini yarating. ",-1)),n(c(O),{href:"/sales/targets/create",class:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"},{default:C(()=>[...e[22]||(e[22]=[x(" Reja yaratish ",-1)])]),_:1})]))])]),_:1}))}};export{ks as default};
