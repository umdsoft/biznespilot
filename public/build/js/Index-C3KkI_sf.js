import{r as x,b as N,o as P,v as S,x as U,y as g,z as t,D as o,L as v,A as u,C as d,B as m,E as i,H as s,F as k,G as f,I as H,K as G,J as Q}from"./chunk-BcTZxe-J.js";import{h as W,a as C}from"./chunk-BYRtWSr0.js";import{_ as Z}from"./chunk-C8lq39jQ.js";import{b as z}from"./chunk-AyRJdOJv.js";import{r as tt}from"./chunk-D0j8iZkh.js";import{a as et}from"./chunk-BVYwhYNk.js";import{r as at}from"./chunk-Sr2jsNPC.js";import{r as rt}from"./chunk-br81ceNR.js";import{r as st}from"./chunk-CklLzvQL.js";import{r as it}from"./chunk-CJsSO8V8.js";import"./app-BC9IivQF.js";import"./chunk-C1xeNfMu.js";import"./chunk-BqueMrU7.js";import"./chunk-_yYzsx_i.js";import"./chunk-Rs1WNzbn.js";import"./chunk-CrR1zWIb.js";import"./chunk-CQoMtUf7.js";import"./chunk-qVc0_oyq.js";import"./chunk-LBbTbQSS.js";import"./chunk-I93QdGKi.js";import"./chunk-DNp5bQOL.js";import"./chunk-CG0drqHE.js";import"./chunk-CnrLL2pV.js";import"./chunk-D58UsNjm.js";import"./chunk-Ba8J67bG.js";import"./chunk-BHX0ueEB.js";const ot={class:"space-y-6"},lt={class:"flex items-center justify-between"},dt=["disabled"],nt={key:0,class:"grid grid-cols-1 md:grid-cols-5 gap-4"},gt={class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700"},ut={class:"text-center"},ct={class:"w-12 h-12 mx-auto bg-gray-100 dark:bg-gray-700 rounded-xl flex items-center justify-center mb-3"},xt={class:"text-2xl font-bold text-gray-900 dark:text-white"},mt={class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border-l-4 border-red-500"},pt={class:"text-center"},ht={class:"text-3xl font-bold text-red-500 dark:text-red-400"},yt={class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border-l-4 border-orange-500"},bt={class:"text-center"},vt={class:"text-3xl font-bold text-orange-500 dark:text-orange-400"},kt={class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border-l-4 border-yellow-500"},ft={class:"text-center"},_t={class:"text-3xl font-bold text-yellow-500 dark:text-yellow-400"},wt={class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border-l-4 border-green-500"},qt={class:"text-center"},Ct={class:"text-3xl font-bold text-green-500 dark:text-green-400"},jt={key:1,class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700"},$t={class:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2"},Bt={class:"space-y-3"},zt={key:2,class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700"},Mt={class:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4"},Ot={class:"text-sm text-gray-700 dark:text-gray-300 mt-1 font-medium"},Rt={class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},At={class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700"},Ft={class:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2"},Ht={class:"flex items-center gap-4"},It={class:"flex items-center gap-2"},Tt=["value"],Yt={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden border border-gray-200 dark:border-gray-700"},Et={class:"overflow-x-auto"},Kt={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},Vt={class:"divide-y divide-gray-200 dark:divide-gray-700"},Xt={class:"px-6 py-4 whitespace-nowrap"},Dt={class:"flex items-center"},Jt={class:"w-10 h-10 bg-purple-100 dark:bg-purple-900/50 rounded-full flex items-center justify-center"},Lt={class:"text-sm font-medium text-purple-600 dark:text-purple-300"},Nt={class:"ml-4"},Pt={class:"text-sm font-medium text-gray-900 dark:text-white"},St={class:"text-sm text-gray-500 dark:text-gray-400"},Ut={class:"px-6 py-4 whitespace-nowrap"},Gt={class:"flex items-center gap-2"},Qt={class:"px-6 py-4 whitespace-nowrap"},Wt={class:"px-6 py-4"},Zt={class:"flex flex-wrap gap-1"},te={class:"px-6 py-4 whitespace-nowrap text-right"},ee={class:"flex items-center justify-end gap-2"},ae=["onClick"],re=["onClick"],se={key:0,class:"p-8 text-center"},ie={key:1,class:"p-8 text-center text-gray-500 dark:text-gray-400"},oe={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/60"},le={class:"bg-white dark:bg-gray-800 rounded-xl p-6 w-full max-w-md mx-4 border border-gray-200 dark:border-gray-700"},de={class:"text-sm text-gray-600 dark:text-gray-300 mb-4"},ne={class:"font-medium"},ge={class:"flex justify-end gap-3 mt-4"},Te={__name:"Index",props:{currentBusiness:Object},setup(I){const c=I,h=x(!0),j=x([]),l=x(null),$=x(""),_=x(!1),w=x(null),y=x(""),T=[{value:"",label:"Barcha darajalar"},{value:"critical",label:"Juda yuqori xavf"},{value:"high",label:"Yuqori xavf"},{value:"moderate",label:"O'rtacha xavf"},{value:"low",label:"Past xavf"}],Y=r=>({critical:"Juda yuqori xavf",high:"Yuqori xavf",moderate:"O'rtacha xavf",medium:"O'rtacha xavf",low:"Past xavf"})[r]||r,M=N(()=>{if(!l.value)return[];const r=[],e=l.value.distribution||{},a=l.value.factor_analysis||[],n=l.value.overview?.avg_risk_score||0,B=e.critical?.count||0,L=e.high?.count||0,A=B+L;A>0&&r.push({type:"warning",title:"Yuqori xavfdagi hodimlar",message:`${A} ta hodim yuqori yoki juda yuqori ketish xavfida. Ular bilan shaxsiy suhbat o'tkazing va sabablarini aniqlang.`,icon:"exclamation"}),n>=60?r.push({type:"danger",title:"Umumiy xavf darajasi yuqori",message:`O'rtacha xavf balli ${n}%. Kompaniyada umumiy muammo bo'lishi mumkin - ish sharoitlari, kompensatsiya yoki boshqaruv sifatini tekshiring.`,icon:"alert"}):n>=40?r.push({type:"warning",title:"O'rtacha xavf darajasi",message:`O'rtacha xavf balli ${n}%. Proaktiv choralar ko'rish tavsiya etiladi.`,icon:"info"}):r.push({type:"success",title:"Xavf darajasi nazorat ostida",message:`O'rtacha xavf balli ${n}%. Hodimlar odatda kompaniyada qolishga tayyor.`,icon:"check"});const F=a.filter(p=>p.avg_score>=50);if(F.length>0){const p=F.map(q=>q.label).join(", ");r.push({type:"info",title:"Asosiy xavf omillari",message:`Eng ko'p ta'sir qiluvchi omillar: ${p}. Bu sohalarga e'tibor qarating.`,icon:"lightbulb"})}if(a.length>0){const p=a[0],q=E(p.key,p.avg_score);q&&r.push({type:"tip",title:"Tavsiya",message:q,icon:"lightbulb"})}return r}),E=(r,e)=>e<40?null:{engagement:"Hodimlar ishga qiziqishi past. Gallup Q12 so'rovnomasini o'tkazing va natijalarni tahlil qiling. Regular 1:1 uchrashuvlar o'tkazing.",tenure:"Yangi hodimlar ko'p ketmoqda. Onboarding jarayonini yaxshilang va birinchi 90 kun davomida ko'proq e'tibor bering.",compensation:"Kompensatsiya bilan bog'liq muammolar bor. Bozor narxlarini o'rganing va raqobatbardosh taklif qiling.",growth:"Hodimlar o'sish imkoniyatlarini ko'rmayapti. Aniq martaba yo'llarini belgilang va o'quv dasturlarini taklif qiling.",workload:"Ish yuki juda og'ir. Vazifalarni qayta taqsimlang va qo'shimcha resurslar yollashni ko'rib chiqing.",recognition:"Hodimlar tan olinmayapti. Muvaffaqiyatlarni nishonlash va tashakkur bildirish madaniyatini joriy qiling."}[r]||null,b=async()=>{if(c.currentBusiness?.id){h.value=!0;try{const[r,e]=await Promise.all([C.get(`/api/v1/businesses/${c.currentBusiness.id}/hr/flight-risk`,{params:{risk_level:$.value||void 0}}),C.get(`/api/v1/businesses/${c.currentBusiness.id}/hr/flight-risk/statistics`)]);j.value=r.data.data?.data||[],l.value=e.data.data}catch(r){console.error("Error fetching flight risk data:",r)}finally{h.value=!1}}},K=async r=>{if(c.currentBusiness?.id)try{await C.post(`/api/v1/businesses/${c.currentBusiness.id}/hr/flight-risk/${r}/recalculate`),b()}catch(e){console.error("Error recalculating risk:",e)}},V=r=>{w.value=r,_.value=!0},X=async()=>{if(!(!c.currentBusiness?.id||!w.value||!y.value.trim()))try{await C.post(`/api/v1/businesses/${c.currentBusiness.id}/hr/flight-risk/${w.value.user?.id}/mitigation`,{action:y.value}),_.value=!1,y.value="",b()}catch(r){console.error("Error adding mitigation:",r)}},D=r=>({critical:"bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300",high:"bg-orange-100 text-orange-800 dark:bg-orange-900/50 dark:text-orange-300",moderate:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300",medium:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300",low:"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300"})[r]||"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",O=r=>r>=70?"text-red-500 dark:text-red-400":r>=50?"text-orange-500 dark:text-orange-400":r>=30?"text-yellow-500 dark:text-yellow-400":"text-green-500 dark:text-green-400",J=r=>({danger:"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800",warning:"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800",success:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",info:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",tip:"bg-purple-50 dark:bg-purple-900/20 border-purple-200 dark:border-purple-800"})[r]||"bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-700",R=r=>({danger:"text-red-800 dark:text-red-300",warning:"text-amber-800 dark:text-amber-300",success:"text-green-800 dark:text-green-300",info:"text-blue-800 dark:text-blue-300",tip:"text-purple-800 dark:text-purple-300"})[r]||"text-gray-800 dark:text-gray-300";return P(b),(r,e)=>(i(),S(Z,{title:"Flight Risk"},{default:U(()=>[g(u(W),{title:"Ketish Xavfi"}),t("div",ot,[t("div",lt,[e[4]||(e[4]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"}," Ketish Xavfi Tahlili "),t("p",{class:"text-gray-500 dark:text-gray-400 mt-1"}," Hodimlarning ketish xavfini kuzatish va proaktiv choralar ko'rish ")],-1)),t("button",{onClick:b,disabled:h.value,class:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50"},[g(u(z),{class:m(["w-5 h-5",h.value?"animate-spin":""])},null,8,["class"]),e[3]||(e[3]=d(" Yangilash ",-1))],8,dt)]),l.value?(i(),o("div",nt,[t("div",gt,[t("div",ut,[t("div",ct,[g(u(tt),{class:"w-6 h-6 text-gray-600 dark:text-gray-300"})]),t("p",xt,s(l.value.overview?.total_employees||0),1),e[5]||(e[5]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Jami hodimlar",-1))])]),t("div",mt,[t("div",pt,[t("p",ht,s(l.value.distribution?.critical?.count||0),1),e[6]||(e[6]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Juda yuqori xavf",-1))])]),t("div",yt,[t("div",bt,[t("p",vt,s(l.value.distribution?.high?.count||0),1),e[7]||(e[7]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Yuqori xavf",-1))])]),t("div",kt,[t("div",ft,[t("p",_t,s(l.value.distribution?.moderate?.count||0),1),e[8]||(e[8]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"O'rtacha xavf",-1))])]),t("div",wt,[t("div",qt,[t("p",Ct,s(l.value.distribution?.low?.count||0),1),e[9]||(e[9]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Past xavf",-1))])])])):v("",!0),M.value.length>0?(i(),o("div",jt,[t("h3",$t,[g(u(et),{class:"w-5 h-5 text-amber-500"}),e[10]||(e[10]=d(" Xulosa va Tavsiyalar ",-1))]),t("div",Bt,[(i(!0),o(k,null,f(M.value,(a,n)=>(i(),o("div",{key:n,class:m(["p-4 rounded-lg border",J(a.type)])},[t("h4",{class:m(["font-medium mb-1",R(a.type)])},s(a.title),3),t("p",{class:m(["text-sm",R(a.type)])},s(a.message),3)],2))),128))])])):v("",!0),l.value?.factor_analysis?(i(),o("div",zt,[e[11]||(e[11]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"}," Xavf omillari tahlili ",-1)),t("div",Mt,[(i(!0),o(k,null,f(l.value.factor_analysis,a=>(i(),o("div",{key:a.key,class:"p-4 bg-gray-50 dark:bg-gray-700 rounded-lg text-center border border-gray-200 dark:border-gray-600"},[t("div",{class:m(["text-2xl font-bold",O(a.avg_score)])},s(a.avg_score)+"% ",3),t("div",Ot,s(a.label),1),t("div",Rt,s(a.impact),1)]))),128))])])):v("",!0),t("div",At,[t("h3",Ft,[g(u(at),{class:"w-5 h-5 text-blue-500"}),e[12]||(e[12]=d(" Flight Risk haqida ",-1))]),e[13]||(e[13]=t("div",{class:"prose dark:prose-invert max-w-none text-sm"},[t("p",{class:"text-gray-700 dark:text-gray-300 mb-3"},[t("strong",null,"Flight Risk"),d(" - bu hodimning kompaniyani tark etish ehtimolini baholash tizimi. Bu ko'rsatkich bir nechta omillar asosida hisoblanadi va HR jamoasiga proaktiv choralar ko'rishga yordam beradi. ")]),t("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[t("div",null,[t("h4",{class:"font-medium text-gray-900 dark:text-white mb-2"},"Xavf darajalari:"),t("ul",{class:"space-y-1 text-gray-600 dark:text-gray-400"},[t("li",null,[t("span",{class:"text-red-500 font-medium"},"Juda yuqori (70%+):"),d(" Tezkor aralashuv zarur")]),t("li",null,[t("span",{class:"text-orange-500 font-medium"},"Yuqori (50-70%):"),d(" Diqqat talab qiladi")]),t("li",null,[t("span",{class:"text-yellow-500 font-medium"},"O'rtacha (30-50%):"),d(" Kuzatish ostida")]),t("li",null,[t("span",{class:"text-green-500 font-medium"},"Past (0-30%):"),d(" Barqaror")])])]),t("div",null,[t("h4",{class:"font-medium text-gray-900 dark:text-white mb-2"},"Asosiy omillar:"),t("ul",{class:"space-y-1 text-gray-600 dark:text-gray-400"},[t("li",null,[t("strong",null,"Ishga qiziqish:"),d(" Ishga qiziqish darajasi (so'rovnoma asosida)")]),t("li",null,[t("strong",null,"Tenure:"),d(" Kompaniyada ishlash muddati")]),t("li",null,[t("strong",null,"Growth:"),d(" Martaba o'sish imkoniyatlari")]),t("li",null,[t("strong",null,"Recognition:"),d(" Muvaffaqiyatlarni tan olish")])])])])],-1))]),t("div",Ht,[t("div",It,[g(u(rt),{class:"w-5 h-5 text-gray-400 dark:text-gray-500"}),H(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>$.value=a),onChange:b,class:"px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 text-gray-900 dark:text-white"},[(i(),o(k,null,f(T,a=>t("option",{key:a.value,value:a.value},s(a.label),9,Tt)),64))],544),[[G,$.value]])])]),t("div",Yt,[t("div",Et,[t("table",Kt,[e[14]||(e[14]=t("thead",{class:"bg-gray-50 dark:bg-gray-700"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase"},"Hodim"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase"},"Xavf balli"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase"},"Daraja"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase"},"Asosiy omillar"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase"},"Amallar")])],-1)),t("tbody",Vt,[(i(!0),o(k,null,f(j.value,a=>(i(),o("tr",{key:a.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50"},[t("td",Xt,[t("div",Dt,[t("div",Jt,[t("span",Lt,s(a.user?.name?.charAt(0)||"?"),1)]),t("div",Nt,[t("div",Pt,s(a.user?.name||"Noma'lum"),1),t("div",St,s(a.user?.email),1)])])]),t("td",Ut,[t("div",Gt,[t("span",{class:m(["text-lg font-bold",O(a.risk_score)])},s(a.risk_score)+"% ",3)])]),t("td",Qt,[t("span",{class:m(["px-3 py-1 text-xs font-medium rounded-full",D(a.risk_level)])},s(Y(a.risk_level)),3)]),t("td",Wt,[t("div",Zt,[(i(!0),o(k,null,f(a.top_risk_factors,(n,B)=>(i(),o("span",{key:B,class:"px-2 py-0.5 text-xs bg-gray-100 dark:bg-gray-600 text-gray-700 dark:text-gray-200 rounded"},s(n),1))),128))])]),t("td",te,[t("div",ee,[t("button",{onClick:n=>V(a),class:"p-2 text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/30 rounded-lg",title:"Chora-tadbir qo'shish"},[g(u(st),{class:"w-5 h-5"})],8,ae),t("button",{onClick:n=>K(a.user?.id),class:"p-2 text-purple-600 dark:text-purple-400 hover:bg-purple-50 dark:hover:bg-purple-900/30 rounded-lg",title:"Qayta hisoblash"},[g(u(z),{class:"w-5 h-5"})],8,re)])])]))),128))])])]),h.value?(i(),o("div",se,[g(u(z),{class:"w-8 h-8 mx-auto animate-spin text-purple-500 dark:text-purple-400"}),e[15]||(e[15]=t("p",{class:"mt-2 text-gray-500 dark:text-gray-400"},"Yuklanmoqda...",-1))])):j.value.length===0?(i(),o("div",ie,[g(u(it),{class:"w-12 h-12 mx-auto opacity-50 mb-3"}),e[16]||(e[16]=t("p",null,"Flight risk ma'lumotlari topilmadi",-1))])):v("",!0)])]),_.value?(i(),o("div",oe,[t("div",le,[e[18]||(e[18]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"}," Chora-tadbir qo'shish ",-1)),t("p",de,[t("span",ne,s(w.value?.user?.name),1),e[17]||(e[17]=d(" uchun ",-1))]),H(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=a=>y.value=a),rows:"3",placeholder:"Chora-tadbir tavsifi...",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 focus:ring-2 focus:ring-purple-500 focus:border-purple-500"},null,512),[[Q,y.value]]),t("div",ge,[t("button",{onClick:e[2]||(e[2]=a=>_.value=!1),class:"px-4 py-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"}," Bekor qilish "),t("button",{onClick:X,class:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"}," Qo'shish ")])])])):v("",!0)]),_:1}))}};export{Te as default};
