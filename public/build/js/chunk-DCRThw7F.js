import{r as k,o as F,D as r,z as t,y as z,x as K,A as X,B as g,H as l,L as d,F as v,G as w,I as E,J as R,O as H,Q as L,p as V,E as a}from"./chunk-BcTZxe-J.js";import{l as q,r as m}from"./chunk-BYRtWSr0.js";const A={class:"h-[calc(100vh-180px)] flex gap-6"},D={class:"flex-1 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 flex flex-col overflow-hidden"},P={class:"p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between"},I={class:"flex items-center"},J={class:"font-medium text-gray-900 dark:text-white"},Q={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},U={class:"flex items-center gap-3"},Y={class:"flex items-center gap-2"},G={key:0,class:"text-xs opacity-70 mb-1"},W={key:1,class:"flex items-center gap-2"},Z={class:"font-mono"},$={key:2,class:"space-y-1"},ee={class:"text-sm opacity-90"},te={key:0,class:"text-xs opacity-75"},se={key:3,class:"flex items-center gap-2"},ne={key:4,class:"space-y-1"},oe={key:0,class:"text-sm"},re={key:5,class:"space-y-1"},ae={class:"flex items-center gap-2"},le={key:0,class:"text-sm"},ie={key:6,class:"whitespace-pre-wrap"},de={class:"p-4 border-t border-gray-200 dark:border-gray-700"},ce={class:"flex items-end gap-3"},ue={class:"flex-1"},ge=["onKeydown"],ye=["disabled"],xe={key:0,class:"animate-spin w-5 h-5",fill:"none",viewBox:"0 0 24 24"},fe={key:1,class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},be={class:"w-80 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden"},me={class:"p-4 space-y-4"},ke={class:"flex items-center justify-center"},he={class:"w-20 h-20 rounded-full flex items-center justify-center bg-blue-100 dark:bg-blue-900/30"},pe={class:"text-3xl font-bold text-blue-600 dark:text-blue-400"},ve={class:"text-center"},we={class:"text-lg font-medium text-gray-900 dark:text-white"},_e={key:0,class:"text-gray-500 dark:text-gray-400"},Ce={class:"space-y-3"},Se={class:"p-3 bg-gray-50 dark:bg-gray-900 rounded-lg"},Te={class:"font-medium text-gray-900 dark:text-white"},je={key:0,class:"p-3 bg-gray-50 dark:bg-gray-900 rounded-lg"},Oe={class:"font-medium text-gray-900 dark:text-white"},Me={key:1,class:"p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg"},Be={class:"font-medium text-yellow-700 dark:text-yellow-300"},Ne={key:2,class:"p-3 bg-gray-50 dark:bg-gray-900 rounded-lg"},Fe={class:"flex flex-wrap gap-1"},ze={key:0,class:"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg"},Ke={class:"font-medium text-green-700 dark:text-green-300"},Xe={class:"inline-block mt-1 px-2 py-0.5 bg-green-200 dark:bg-green-800/30 text-green-800 dark:text-green-200 text-xs rounded-full"},He={__name:"TelegramConversationShow",props:{bot:Object,conversation:Object,user:Object,messages:{type:Array,default:()=>[]},lead:Object,panelType:{type:String,default:"business",validator:n=>["business","marketing"].includes(n)}},setup(n){const c=n,y=(o,e=null)=>{const s=c.panelType==="business"?"business.":"marketing.";return e?route(s+o,e):route(s+o)},b=k(null),u=k(""),x=k(!1),h=o=>o?o.split(" ").map(s=>s[0]).join("").toUpperCase().slice(0,2):"?",i=o=>{const e=o.content;if(!e)return{};if(typeof e=="string")try{return JSON.parse(e)}catch{return{text:e}}return e},f=o=>{const e=i(o);return e.command?"command":e.phone_number?"contact":e.latitude&&e.longitude?"location":e.photo||e.file_id?"photo":e.document||e.file_name?"document":"text"},_=o=>{const e=i(o);return e.text?e.text:typeof o.content=="string"?o.content:typeof e=="object"&&Object.keys(e).length>0?e.message?e.message:e.body?e.body:"[Xabar]":o.content||""},C=o=>({active:"Faol",handoff:"Handoff",closed:"Yopilgan"})[o]||o,S=o=>{const e={active:"bg-green-100 dark:bg-green-900/30",handoff:"bg-yellow-100 dark:bg-yellow-900/30",closed:"bg-gray-100 dark:bg-gray-700"};return e[o]||e.active},T=o=>{const e={active:"text-green-600 dark:text-green-400",handoff:"text-yellow-600 dark:text-yellow-400",closed:"text-gray-600 dark:text-gray-400"};return e[o]||e.active},j=o=>{const e={active:"px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400",handoff:"px-2.5 py-1 rounded-full text-xs font-medium bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400",closed:"px-2.5 py-1 rounded-full text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"};return e[o]||e.active},O=()=>{V(()=>{b.value&&(b.value.scrollTop=b.value.scrollHeight)})},p=async()=>{if(!(!u.value.trim()||x.value)){x.value=!0;try{const e=await(await fetch(y("telegram-funnels.conversations.send",[c.bot.id,c.conversation.id]),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content,Accept:"application/json"},body:JSON.stringify({text:u.value})})).json();e.success?(u.value="",m.reload({only:["messages"]})):alert(e.message||"Xabar yuborishda xatolik")}catch{alert("Server bilan bog'lanishda xatolik")}finally{x.value=!1}}},M=async()=>{await fetch(y("telegram-funnels.conversations.assign",[c.bot.id,c.conversation.id]),{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content}}),m.reload()},B=async()=>{confirm("Suhbatni yopishni xohlaysizmi?")&&(await fetch(y("telegram-funnels.conversations.close",[c.bot.id,c.conversation.id]),{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content}}),m.reload())},N=async()=>{await fetch(y("telegram-funnels.conversations.reopen",[c.bot.id,c.conversation.id]),{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content}}),m.reload()};return F(()=>{O()}),(o,e)=>(a(),r("div",A,[t("div",D,[t("div",P,[t("div",I,[z(X(q),{href:y("telegram-funnels.conversations.index",n.bot.id),class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 mr-4"},{default:K(()=>[...e[1]||(e[1]=[t("svg",{class:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),_:1},8,["href"]),t("div",{class:g(["w-10 h-10 rounded-full flex items-center justify-center mr-3",S(n.conversation.status)])},[t("span",{class:g(["text-lg font-semibold",T(n.conversation.status)])},l(h(n.user.full_name)),3)],2),t("div",null,[t("p",J,l(n.user.full_name||"Noma'lum"),1),n.user.username?(a(),r("p",Q,"@"+l(n.user.username),1)):d("",!0)])]),t("div",U,[t("span",{class:g(j(n.conversation.status))},l(C(n.conversation.status)),3),t("div",Y,[n.conversation.status==="handoff"&&!n.conversation.assigned_operator?(a(),r("button",{key:0,onClick:M,class:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors"}," Menga biriktirish ")):d("",!0),n.conversation.status!=="closed"?(a(),r("button",{key:1,onClick:B,class:"px-3 py-1.5 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 text-sm font-medium rounded-lg transition-colors"}," Yopish ")):(a(),r("button",{key:2,onClick:N,class:"px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-colors"}," Qayta ochish "))])])]),t("div",{ref_key:"messagesContainer",ref:b,class:"flex-1 overflow-y-auto p-4 space-y-4"},[(a(!0),r(v,null,w(n.messages,s=>(a(),r("div",{key:s.id,class:g(["flex",s.direction==="outgoing"?"justify-end":"justify-start"])},[t("div",{class:g(["max-w-[70%] rounded-2xl px-4 py-2",s.direction==="outgoing"?"bg-blue-600 text-white rounded-br-md":"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white rounded-bl-md"])},[s.sender_type==="operator"?(a(),r("div",G," Operator ")):d("",!0),f(s)==="command"?(a(),r("div",W,[e[2]||(e[2]=t("span",{class:"text-lg"},"âš¡",-1)),t("span",Z,l(i(s).command),1)])):f(s)==="contact"?(a(),r("div",$,[e[3]||(e[3]=t("div",{class:"flex items-center gap-2"},[t("span",{class:"text-lg"},"ðŸ“±"),t("span",{class:"font-medium"},"Kontakt yuborildi")],-1)),t("p",ee,l(i(s).phone_number),1),i(s).first_name?(a(),r("p",te,l(i(s).first_name)+" "+l(i(s).last_name||""),1)):d("",!0)])):f(s)==="location"?(a(),r("div",se,[...e[4]||(e[4]=[t("span",{class:"text-lg"},"ðŸ“",-1),t("span",null,"Lokatsiya yuborildi",-1)])])):f(s)==="photo"?(a(),r("div",ne,[e[5]||(e[5]=t("div",{class:"flex items-center gap-2"},[t("span",{class:"text-lg"},"ðŸ–¼ï¸"),t("span",null,"Rasm")],-1)),i(s).caption?(a(),r("p",oe,l(i(s).caption),1)):d("",!0)])):f(s)==="document"?(a(),r("div",re,[t("div",ae,[e[6]||(e[6]=t("span",{class:"text-lg"},"ðŸ“„",-1)),t("span",null,l(i(s).file_name||"Fayl"),1)]),i(s).caption?(a(),r("p",le,l(i(s).caption),1)):d("",!0)])):(a(),r("p",ie,l(_(s)),1)),t("p",{class:g(["text-xs mt-1",s.direction==="outgoing"?"text-blue-100":"text-gray-500 dark:text-gray-400"])},l(s.created_at),3)],2)],2))),128))],512),t("div",de,[t("div",ce,[t("div",ue,[E(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=s=>u.value=s),onKeydown:H(L(p,["exact","prevent"]),["enter"]),rows:"2",class:"w-full px-4 py-3 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 dark:text-white resize-none",placeholder:"Xabar yozing..."},null,40,ge),[[R,u.value]])]),t("button",{onClick:p,disabled:!u.value.trim()||x.value,class:"px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white font-medium rounded-xl transition-colors flex items-center gap-2"},[x.value?(a(),r("svg",xe,[...e[7]||(e[7]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(a(),r("svg",fe,[...e[8]||(e[8]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"},null,-1)])]))],8,ye)])])]),t("div",be,[e[14]||(e[14]=t("div",{class:"p-4 border-b border-gray-200 dark:border-gray-700"},[t("h3",{class:"font-semibold text-gray-900 dark:text-white"},"Foydalanuvchi ma'lumotlari")],-1)),t("div",me,[t("div",ke,[t("div",he,[t("span",pe,l(h(n.user.full_name)),1)])]),t("div",ve,[t("p",we,l(n.user.full_name||"Noma'lum"),1),n.user.username?(a(),r("p",_e,"@"+l(n.user.username),1)):d("",!0)]),t("div",Ce,[t("div",Se,[e[9]||(e[9]=t("p",{class:"text-xs text-gray-500 dark:text-gray-400 mb-1"},"Telegram ID",-1)),t("p",Te,l(n.user.telegram_id),1)]),n.user.phone?(a(),r("div",je,[e[10]||(e[10]=t("p",{class:"text-xs text-gray-500 dark:text-gray-400 mb-1"},"Telefon",-1)),t("p",Oe,l(n.user.phone),1)])):d("",!0),n.conversation.handoff_reason?(a(),r("div",Me,[e[11]||(e[11]=t("p",{class:"text-xs text-yellow-600 dark:text-yellow-400 mb-1"},"Handoff sababi",-1)),t("p",Be,l(n.conversation.handoff_reason),1)])):d("",!0),n.user.tags&&n.user.tags.length>0?(a(),r("div",Ne,[e[12]||(e[12]=t("p",{class:"text-xs text-gray-500 dark:text-gray-400 mb-2"},"Teglar",-1)),t("div",Fe,[(a(!0),r(v,null,w(n.user.tags,s=>(a(),r("span",{key:s,class:"px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 text-xs rounded-full"},l(s),1))),128))])])):d("",!0)]),n.lead?(a(),r("div",ze,[e[13]||(e[13]=t("p",{class:"text-xs text-green-600 dark:text-green-400 mb-1"},"Bog'langan Lid",-1)),t("p",Ke,l(n.lead.name),1),t("span",Xe,l(n.lead.status),1)])):d("",!0)])])]))}};export{He as _};
