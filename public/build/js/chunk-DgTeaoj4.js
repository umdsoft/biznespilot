import{d as e}from"./chunk-BWiubfpN.js";import{a as t}from"./chunk-BhZp3z4u.js";import{r as a,b as s}from"./chunk-CpmtkKLp.js";const u=e("auth",()=>{const e=a(null),u=a(sessionStorage.getItem("auth_token")||null),n=a(JSON.parse(sessionStorage.getItem("current_business"))||null),o=s(()=>!!u.value);async function r(){try{await t.post("/api/v1/auth/logout")}catch(a){}finally{e.value=null,u.value=null,n.value=null,sessionStorage.removeItem("auth_token"),sessionStorage.removeItem("current_business"),delete t.defaults.headers.common.Authorization,delete t.defaults.headers.common["X-Business-ID"]}}function i(e){n.value=e,sessionStorage.setItem("current_business",JSON.stringify(e)),t.defaults.headers.common["X-Business-ID"]=e.id}return u.value&&(t.defaults.headers.common.Authorization=`Bearer ${u.value}`),n.value&&(t.defaults.headers.common["X-Business-ID"]=n.value.id),{user:e,token:u,currentBusiness:n,isAuthenticated:o,register:async function(a){try{const s=await t.post("/api/v1/auth/register",a);return u.value=s.data.data.token,e.value=s.data.data.user,sessionStorage.setItem("auth_token",u.value),t.defaults.headers.common.Authorization=`Bearer ${u.value}`,s.data}catch(s){throw s.response?.data||s}},login:async function(a){try{const s=await t.post("/api/v1/auth/login",a);return u.value=s.data.data.token,e.value=s.data.data.user,sessionStorage.setItem("auth_token",u.value),t.defaults.headers.common.Authorization=`Bearer ${u.value}`,e.value.businesses&&e.value.businesses.length>0&&i(e.value.businesses[0]),s.data}catch(s){throw s.response?.data||s}},logout:r,fetchUser:async function(){try{const a=await t.get("/api/v1/auth/me");return e.value=a.data.data,a.data}catch(a){throw await r(),a}},setCurrentBusiness:i}});export{u};
