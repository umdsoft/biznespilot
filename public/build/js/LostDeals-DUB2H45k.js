import{r as g,o as w,v as k,x as q,y as j,z as t,A as B,D as a,L as c,I as f,J as h,E as l,F as d,H as o,G as m,B as C,S as _}from"./chunk-BcTZxe-J.js";import{h as M,a as Y}from"./chunk-BYRtWSr0.js";import{_ as z}from"./chunk-TXgJ1MaD.js";import"./chunk-AyRJdOJv.js";import"./app-BC9IivQF.js";import"./chunk-C1xeNfMu.js";import"./chunk-BVYwhYNk.js";import"./chunk-BqueMrU7.js";import"./chunk-_yYzsx_i.js";import"./chunk-Rs1WNzbn.js";import"./chunk-CJsSO8V8.js";import"./chunk-CrR1zWIb.js";import"./chunk-CQoMtUf7.js";import"./chunk-qVc0_oyq.js";import"./chunk-LBbTbQSS.js";import"./chunk-I93QdGKi.js";import"./chunk-DNp5bQOL.js";import"./chunk-CG0drqHE.js";import"./chunk-CklLzvQL.js";import"./chunk-CnrLL2pV.js";import"./chunk-D58UsNjm.js";import"./chunk-Ba8J67bG.js";import"./chunk-BHX0ueEB.js";const V={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},S={class:"mb-6 flex gap-4 items-end"},N={key:0,class:"flex justify-center py-12"},T={class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"},D={class:"bg-red-50 rounded-lg p-6 border border-red-200"},F={class:"flex items-center justify-between"},L={class:"text-3xl font-bold text-red-700"},O={class:"bg-orange-50 rounded-lg p-6 border border-orange-200"},U={class:"flex items-center justify-between"},E={class:"text-3xl font-bold text-orange-700"},H={class:"bg-yellow-50 rounded-lg p-6 border border-yellow-200"},I={class:"flex items-center justify-between"},J={class:"text-3xl font-bold text-yellow-700"},$={class:"bg-white rounded-lg shadow"},A={class:"border-b border-gray-200"},G={class:"flex -mb-px"},R=["onClick"],Z={class:"p-6"},K={key:0,class:"space-y-4"},P={class:"flex-1"},Q={class:"flex justify-between items-center mb-2"},W={class:"font-medium text-gray-900"},X={class:"text-sm text-gray-500"},tt={class:"w-full bg-gray-200 rounded-full h-3"},et={class:"mt-2 text-sm text-gray-600"},st={key:1,class:"space-y-4"},ot={class:"flex-1"},lt={class:"flex justify-between items-center mb-2"},at={class:"font-medium text-gray-900"},it={class:"text-sm text-gray-500"},nt={class:"w-full bg-gray-200 rounded-full h-3"},rt={class:"mt-2 text-sm text-gray-600"},dt={key:2,class:"space-y-4"},ut={class:"flex-1"},ct={class:"flex justify-between items-center mb-2"},mt={class:"font-medium text-gray-900"},gt={class:"text-sm text-gray-500"},yt={class:"w-full bg-gray-200 rounded-full h-3"},vt={class:"mt-2 text-sm text-gray-600"},_t={key:3,class:"space-y-4"},xt={class:"flex-1"},pt={class:"flex justify-between items-center mb-2"},ft={class:"font-medium text-gray-900"},ht={class:"text-sm text-gray-500"},bt={class:"w-full bg-gray-200 rounded-full h-3"},wt={class:"mt-2 text-sm text-gray-600"},kt={key:0,class:"mt-8 bg-white rounded-lg shadow p-6"},qt={class:"space-y-2"},jt={class:"font-medium"},Bt={class:"text-right"},Ct={class:"text-red-600 font-bold"},Mt={class:"text-gray-500 ml-2"},te={__name:"LostDeals",props:{lostReasons:Object,lazyLoad:Boolean},setup(Yt){const x=g(!0),i=g(null),y=g(""),v=g(""),u=g("reason"),p=async()=>{x.value=!0;try{const n={};y.value&&(n.date_from=y.value),v.value&&(n.date_to=v.value);const s=await Y.get(route("business.analytics.api.lost-deals"),{params:n});i.value=s.data}catch(n){console.error("Failed to fetch lost deals:",n)}finally{x.value=!1}};w(()=>{p()});const r=n=>n?new Intl.NumberFormat("uz-UZ").format(n):"0",b=[{key:"reason",label:"Sabab bo'yicha"},{key:"stage",label:"Bosqich bo'yicha"},{key:"operator",label:"Operator bo'yicha"},{key:"source",label:"Manba bo'yicha"}];return(n,s)=>(l(),k(z,{title:"Yo'qotilgan Sotuvlar Tahlili"},{default:q(()=>[j(B(M),{title:"Yo'qotilgan Sotuvlar"}),t("div",V,[s[14]||(s[14]=t("div",{class:"mb-8"},[t("h1",{class:"text-2xl font-bold text-gray-900"},"Yo'qotilgan Sotuvlar Tahlili"),t("p",{class:"mt-1 text-sm text-gray-500"},"Nega sotuvlar yo'qolgani va qanday yo'qotishlarni oldini olish mumkinligi haqida")],-1)),t("div",S,[t("div",null,[s[2]||(s[2]=t("label",{class:"block text-sm font-medium text-gray-700"},"Boshlanish",-1)),f(t("input",{type:"date","onUpdate:modelValue":s[0]||(s[0]=e=>y.value=e),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,512),[[h,y.value]])]),t("div",null,[s[3]||(s[3]=t("label",{class:"block text-sm font-medium text-gray-700"},"Tugash",-1)),f(t("input",{type:"date","onUpdate:modelValue":s[1]||(s[1]=e=>v.value=e),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,512),[[h,v.value]])]),t("button",{onClick:p,class:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"}," Yangilash ")]),x.value?(l(),a("div",N,[...s[4]||(s[4]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"},null,-1)])])):i.value?(l(),a(d,{key:1},[t("div",T,[t("div",D,[t("div",F,[t("div",null,[s[5]||(s[5]=t("p",{class:"text-sm font-medium text-red-600"},"Jami yo'qotilgan",-1)),t("p",L,o(i.value.summary?.total_lost),1)]),s[6]||(s[6]=t("div",{class:"h-12 w-12 rounded-full bg-red-100 flex items-center justify-center"},[t("svg",{class:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})])],-1))])]),t("div",O,[t("div",U,[t("div",null,[s[7]||(s[7]=t("p",{class:"text-sm font-medium text-orange-600"},"Yo'qotilgan qiymat",-1)),t("p",E,o(r(i.value.summary?.total_value_lost)),1),s[8]||(s[8]=t("p",{class:"text-xs text-orange-500"},"so'm",-1))]),s[9]||(s[9]=t("div",{class:"h-12 w-12 rounded-full bg-orange-100 flex items-center justify-center"},[t("svg",{class:"h-6 w-6 text-orange-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))])]),t("div",H,[t("div",I,[t("div",null,[s[10]||(s[10]=t("p",{class:"text-sm font-medium text-yellow-600"},"O'rtacha qiymat",-1)),t("p",J,o(r(i.value.summary?.avg_value_lost)),1),s[11]||(s[11]=t("p",{class:"text-xs text-yellow-500"},"so'm / lid",-1))]),s[12]||(s[12]=t("div",{class:"h-12 w-12 rounded-full bg-yellow-100 flex items-center justify-center"},[t("svg",{class:"h-6 w-6 text-yellow-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})])],-1))])])]),t("div",$,[t("div",A,[t("nav",G,[(l(),a(d,null,m(b,e=>t("button",{key:e.key,onClick:zt=>u.value=e.key,class:C(["px-6 py-3 text-sm font-medium border-b-2 transition-colors",u.value===e.key?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},o(e.label),11,R)),64))])]),t("div",Z,[u.value==="reason"?(l(),a("div",K,[(l(!0),a(d,null,m(i.value.by_reason,e=>(l(),a("div",{key:e.reason,class:"flex items-center p-4 bg-gray-50 rounded-lg"},[t("div",P,[t("div",Q,[t("h4",W,o(e.reason_label),1),t("span",X,o(e.count)+" lid ("+o(e.percentage)+"%)",1)]),t("div",tt,[t("div",{class:"bg-red-500 h-3 rounded-full transition-all",style:_({width:e.percentage+"%"})},null,4)]),t("p",et,"Yo'qotilgan qiymat: "+o(r(e.total_value))+" so'm",1)])]))),128))])):c("",!0),u.value==="stage"?(l(),a("div",st,[(l(!0),a(d,null,m(i.value.by_stage,e=>(l(),a("div",{key:e.stage_id,class:"flex items-center p-4 bg-gray-50 rounded-lg"},[t("div",ot,[t("div",lt,[t("h4",at,o(e.stage_name),1),t("span",it,o(e.count)+" lid ("+o(e.percentage)+"%)",1)]),t("div",nt,[t("div",{class:"bg-orange-500 h-3 rounded-full transition-all",style:_({width:e.percentage+"%"})},null,4)]),t("p",rt,"Yo'qotilgan qiymat: "+o(r(e.total_value))+" so'm",1)])]))),128))])):c("",!0),u.value==="operator"?(l(),a("div",dt,[(l(!0),a(d,null,m(i.value.by_operator,e=>(l(),a("div",{key:e.user_id,class:"flex items-center p-4 bg-gray-50 rounded-lg"},[t("div",ut,[t("div",ct,[t("h4",mt,o(e.user_name),1),t("span",gt,o(e.count)+" lid ("+o(e.percentage)+"%)",1)]),t("div",yt,[t("div",{class:"bg-yellow-500 h-3 rounded-full transition-all",style:_({width:e.percentage+"%"})},null,4)]),t("p",vt,"Yo'qotilgan qiymat: "+o(r(e.total_value))+" so'm",1)])]))),128))])):c("",!0),u.value==="source"?(l(),a("div",_t,[(l(!0),a(d,null,m(i.value.by_source,e=>(l(),a("div",{key:e.channel_id,class:"flex items-center p-4 bg-gray-50 rounded-lg"},[t("div",xt,[t("div",pt,[t("h4",ft,o(e.channel_name),1),t("span",ht,o(e.count)+" lid ("+o(e.percentage)+"%)",1)]),t("div",bt,[t("div",{class:"bg-purple-500 h-3 rounded-full transition-all",style:_({width:e.percentage+"%"})},null,4)]),t("p",wt,"Yo'qotilgan qiymat: "+o(r(e.total_value))+" so'm",1)])]))),128))])):c("",!0)])]),i.value.monthly_trend?.length?(l(),a("div",kt,[s[13]||(s[13]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Oylik trend",-1)),t("div",qt,[(l(!0),a(d,null,m(i.value.monthly_trend,e=>(l(),a("div",{key:e.month,class:"flex items-center justify-between p-3 bg-gray-50 rounded"},[t("span",jt,o(e.month),1),t("div",Bt,[t("span",Ct,o(e.count)+" lid",1),t("span",Mt,o(r(e.total_value))+" so'm",1)])]))),128))])])):c("",!0)],64)):c("",!0)])]),_:1}))}};export{te as default};
