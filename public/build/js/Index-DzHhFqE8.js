import{r as V,b as Q,v as h,x,y as n,z as e,A as i,C as o,D as v,E as u,F as a,G as c,I as p,B as f,H as l,M as F,Q as R,J as b,L as w,K as T,R as B}from"./chunk-KPSVwAyv.js";import{h as H,r as _}from"./chunk-BVrjkT6E.js";import{_ as N}from"./chunk-Cy19HSui.js";import{r as k}from"./chunk-Tj_a7zxz.js";import{r as Y}from"./chunk-BgOPVSvg.js";import{n as z,f as E,s as q,a as G}from"./chunk-S7b6IQvx.js";import{r as $}from"./chunk-DRZjuALB.js";import{r as I}from"./chunk-Qe-_4ASA.js";import{r as J}from"./chunk-D5sR6A8B.js";import{r as K}from"./chunk-D_ekjwSj.js";import{r as W}from"./chunk-Dfha1x8d.js";import{r as X}from"./chunk-Dems4pAU.js";import{a as Z}from"./chunk-DN454CZt.js";import{S as ee,Y as te,h as A,G as se,V as re}from"./chunk-CViO97f5.js";import"./chunk-B1Yis8U5.js";import"./chunk-CXygRKxK.js";import"./chunk-31-ywezX.js";import"./chunk-CQ-EgyBm.js";import"./app-906_W7J6.js";import"./chunk-BvkwlYlD.js";import"./chunk-BgShz32H.js";import"./chunk-Ch0Q6XPl.js";import"./chunk-CYw1XsNK.js";import"./chunk-qku2UxUN.js";import"./chunk-D59q4lxq.js";import"./chunk-Cw_2vanC.js";import"./chunk-14qmXdHo.js";import"./chunk-CYZ54WJE.js";import"./chunk-D-7B8ZCD.js";import"./chunk-J14gS6og.js";const ae={class:"py-6"},oe={class:"w-full px-4 sm:px-6 lg:px-8"},le={class:"flex items-center justify-between mb-6"},ie={class:"flex gap-3"},ne={class:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-6"},de={class:"flex items-center gap-2 mb-2"},ge={class:"text-sm text-gray-400"},ue={class:"text-2xl font-bold text-white"},ce={key:0,class:"bg-orange-500/10 border border-orange-500/30 rounded-xl p-4 mb-6"},me={class:"flex items-start gap-3"},pe={class:"space-y-2"},ye={class:"text-gray-300"},xe={class:"bg-gray-800 rounded-xl overflow-hidden"},ve={key:0,class:"p-8 text-center text-gray-500"},fe={key:1,class:"divide-y divide-gray-700"},be={class:"w-10 h-10 rounded-lg bg-gray-700 flex items-center justify-center"},_e={class:"flex-1 min-w-0"},he={class:"flex items-center gap-2 mb-1"},we={class:"font-medium text-white"},ke={class:"text-sm text-gray-400"},qe={key:0},$e={key:1},Ce={class:"text-sm text-gray-500"},je={class:"flex items-center gap-2"},Se=["onClick"],Ve=["onClick"],Te={class:"mt-6 bg-gray-800 rounded-xl p-6"},Be={class:"flex items-center gap-2 overflow-x-auto pb-4"},ze={class:"text-sm text-white font-medium"},Ae={class:"text-xs text-gray-400 mt-1"},Oe={class:"fixed inset-0 overflow-y-auto"},Ue={class:"flex min-h-full items-center justify-center p-4"},Pe={class:"border-b border-gray-700 px-6 py-4"},De={class:"flex items-center justify-between"},Le={class:"w-8 h-8 rounded-lg bg-emerald-500/20 flex items-center justify-center"},Me={class:"relative"},Qe=["value"],Fe={key:0,class:"mt-1.5 text-xs text-gray-500"},Re={key:0,class:"bg-gray-700/30 rounded-xl p-4"},He={class:"space-y-3"},Ne={class:"text-sm text-gray-400 min-w-[80px]"},Ye=["onUpdate:modelValue","placeholder"],Ee={class:"grid grid-cols-2 gap-4"},Ge={class:"relative"},Ie=["value"],Je={class:"relative"},Ke=["value"],We={key:1,class:"flex items-center justify-center gap-3 py-2"},Xe={class:"px-3 py-1.5 rounded-lg bg-gray-700 text-sm text-gray-300"},Ze={key:0,class:"px-3 py-1.5 rounded-lg bg-emerald-500/20 text-sm text-emerald-400 font-medium"},et={key:1,class:"px-3 py-1.5 rounded-lg bg-gray-700 text-sm text-gray-500"},tt={class:"space-y-3"},st={class:"flex items-center gap-3 p-3 rounded-xl bg-gray-700/30 hover:bg-gray-700/50 cursor-pointer transition group"},rt={class:"flex items-center gap-3 p-3 rounded-xl bg-gray-700/30 hover:bg-gray-700/50 cursor-pointer transition group"},at={class:"block text-sm font-medium text-gray-300 mb-2"},ot={class:"text-gray-500 font-normal ml-1"},lt={class:"border-t border-gray-700 px-6 py-4 bg-gray-800/50 flex items-center justify-end gap-3"},it=["disabled"],Lt={__name:"Index",props:{rules:Array,stages:Array,triggerTypes:Object,bottlenecks:Array,pipelineStats:Object},setup(d){const C=d,y=V(!1),r=V({trigger_type:"",trigger_conditions:{},from_stage_slug:"",to_stage_slug:"",only_if_current_stage:!1,prevent_backward:!0,priority:0}),j=Q(()=>r.value.trigger_type?C.triggerTypes[r.value.trigger_type]?.conditions||[]:[]),O=g=>({call_log_created:Z,task_created:X,task_completed:W,message_sent:K,lead_lost:G,sale_created:J})[g]||z,U=g=>Object.entries(g).map(([s,t])=>`${s}=${t}`).join(", "),P=g=>C.pipelineStats.stages.find(t=>t.slug===g)?.count||0,S=()=>{const g=Object.fromEntries(Object.entries(r.value.trigger_conditions).filter(([s,t])=>t));_.post(route("sales-head.pipeline-automation.store"),{...r.value,trigger_conditions:Object.keys(g).length?g:null},{preserveScroll:!0,onSuccess:()=>{y.value=!1,r.value={trigger_type:"",trigger_conditions:{},from_stage_slug:"",to_stage_slug:"",only_if_current_stage:!1,prevent_backward:!0,priority:0}}})},D=g=>{_.post(route("sales-head.pipeline-automation.toggle",g.id),{},{preserveScroll:!0})},L=g=>{confirm("Bu qoidani o'chirmoqchimisiz?")&&_.delete(route("sales-head.pipeline-automation.destroy",g.id),{preserveScroll:!0})},M=()=>{confirm("Barcha qoidalar o'chirilib, standart qoidalar tiklanadi. Davom etasizmi?")&&_.post(route("sales-head.pipeline-automation.reset"),{},{preserveScroll:!0})};return(g,s)=>(a(),h(N,{title:"Pipeline Avtomatizatsiya"},{default:x(()=>[n(i(H),{title:"Pipeline Avtomatizatsiya"}),e("div",ae,[e("div",oe,[e("div",le,[s[12]||(s[12]=e("div",null,[e("h1",{class:"text-2xl font-bold text-white"},"Pipeline Avtomatizatsiya"),e("p",{class:"text-gray-400 mt-1"},"Lead bosqichlarini avtomatik o'zgartirish qoidalari")],-1)),e("div",ie,[e("button",{onClick:M,class:"px-4 py-2 text-sm text-gray-300 bg-gray-700 hover:bg-gray-600 rounded-lg transition"}," Standartga qaytarish "),e("button",{onClick:s[0]||(s[0]=t=>y.value=!0),class:"px-4 py-2 text-sm text-white bg-emerald-600 hover:bg-emerald-700 rounded-lg transition flex items-center gap-2"},[n(i(k),{class:"w-4 h-4"}),s[11]||(s[11]=u(" Qoida qo'shish ",-1))])])]),e("div",ne,[(a(!0),o(c,null,p(d.pipelineStats.stages,t=>(a(),o("div",{key:t.slug,class:"bg-gray-800 rounded-lg p-4"},[e("div",de,[e("div",{class:f(["w-3 h-3 rounded-full",`bg-${t.color}-500`])},null,2),e("span",ge,l(t.name),1)]),e("p",ue,l(t.count),1)]))),128))]),d.bottlenecks.length>0?(a(),o("div",ce,[e("div",me,[n(i(Y),{class:"w-6 h-6 text-orange-400 flex-shrink-0 mt-0.5"}),e("div",null,[s[14]||(s[14]=e("h3",{class:"font-semibold text-orange-400 mb-2"},"Bottleneck lar aniqlandi",-1)),e("div",pe,[(a(!0),o(c,null,p(d.bottlenecks,t=>(a(),o("div",{key:t.stage_slug,class:"flex items-center gap-3 text-sm"},[e("span",{class:f(["px-2 py-0.5 rounded text-xs font-medium",t.severity==="critical"?"bg-red-500/20 text-red-400":t.severity==="high"?"bg-orange-500/20 text-orange-400":"bg-yellow-500/20 text-yellow-400"])},l(t.severity),3),e("span",ye,[e("strong",null,l(t.lead_count),1),u(' ta lead "'+l(t.stage_name)+`" da o'rtacha `,1),e("strong",null,l(t.avg_days),1),s[13]||(s[13]=u(" kun turibdi ",-1))])]))),128))])])])])):v("",!0),e("div",xe,[s[16]||(s[16]=e("div",{class:"p-4 border-b border-gray-700"},[e("h2",{class:"text-lg font-semibold text-white"},"Avtomatlashtirish qoidalari")],-1)),d.rules.length===0?(a(),o("div",ve,[n(i(z),{class:"w-12 h-12 mx-auto mb-3 opacity-50"}),s[15]||(s[15]=e("p",null,"Hozircha qoidalar yo'q",-1)),e("button",{onClick:s[1]||(s[1]=t=>y.value=!0),class:"mt-3 text-emerald-400 hover:text-emerald-300"}," Birinchi qoidani qo'shing ")])):(a(),o("div",fe,[(a(!0),o(c,null,p(d.rules,t=>(a(),o("div",{key:t.id,class:f(["p-4 flex items-center gap-4",!t.is_active&&"opacity-50"])},[e("div",be,[(a(),h(F(O(t.trigger_type)),{class:"w-5 h-5 text-gray-400"}))]),e("div",_e,[e("div",he,[e("span",we,l(t.trigger_info.name),1),n(i($),{class:"w-4 h-4 text-gray-500"}),e("span",{class:f(["px-2 py-0.5 rounded text-xs font-medium",`bg-${t.to_stage_color}-500/20 text-${t.to_stage_color}-400`])},l(t.to_stage_name),3)]),e("div",ke,[t.from_stage_slug?(a(),o("span",qe,' Faqat "'+l(t.from_stage_name)+'" dan ',1)):v("",!0),t.trigger_conditions&&Object.keys(t.trigger_conditions).length?(a(),o("span",$e," â€¢ Shart: "+l(U(t.trigger_conditions)),1)):v("",!0)])]),e("div",Ce," Prioritet: "+l(t.priority),1),e("div",je,[e("button",{onClick:m=>D(t),class:f(["px-3 py-1.5 text-xs rounded-lg transition",t.is_active?"bg-emerald-500/20 text-emerald-400 hover:bg-emerald-500/30":"bg-gray-700 text-gray-400 hover:bg-gray-600"])},l(t.is_active?"Faol":"O'chiq"),11,Se),e("button",{onClick:m=>L(t),class:"p-1.5 text-red-400 hover:bg-red-500/20 rounded-lg transition"},[n(i(E),{class:"w-4 h-4"})],8,Ve)])],2))),128))]))]),e("div",Te,[s[17]||(s[17]=e("h2",{class:"text-lg font-semibold text-white mb-4"},"Pipeline oqimi",-1)),e("div",Be,[(a(!0),o(c,null,p(d.stages,(t,m)=>(a(),o(c,{key:t.slug},[e("div",{class:f(["flex-shrink-0 px-4 py-3 rounded-lg text-center min-w-[120px]",t.is_won?"bg-green-500/20 border border-green-500/30":t.is_lost?"bg-red-500/20 border border-red-500/30":"bg-gray-700"])},[e("div",{class:f(["w-3 h-3 rounded-full mx-auto mb-2",`bg-${t.color}-500`])},null,2),e("span",ze,l(t.name),1),e("div",Ae,l(P(t.slug))+" ta ",1)],2),m<d.stages.length-1&&!t.is_won&&!t.is_lost?(a(),h(i($),{key:0,class:"w-5 h-5 text-gray-500 flex-shrink-0"})):v("",!0)],64))),128))])])])]),n(i(ee),{appear:"",show:y.value,as:"template"},{default:x(()=>[n(i(te),{as:"div",class:"relative z-50",onClose:s[10]||(s[10]=t=>y.value=!1)},{default:x(()=>[n(i(A),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:x(()=>[...s[18]||(s[18]=[e("div",{class:"fixed inset-0 bg-black/60 backdrop-blur-sm"},null,-1)])]),_:1}),e("div",Oe,[e("div",Ue,[n(i(A),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:x(()=>[n(i(se),{class:"w-full max-w-lg transform overflow-hidden rounded-2xl bg-gray-800 shadow-2xl transition-all"},{default:x(()=>[e("div",Pe,[e("div",De,[n(i(re),{class:"text-lg font-semibold text-white flex items-center gap-2"},{default:x(()=>[e("div",Le,[n(i(k),{class:"w-5 h-5 text-emerald-400"})]),s[19]||(s[19]=u(" Yangi qoida qo'shish ",-1))]),_:1}),e("button",{onClick:s[2]||(s[2]=t=>y.value=!1),class:"p-1.5 rounded-lg text-gray-400 hover:text-white hover:bg-gray-700 transition"},[n(i(I),{class:"w-5 h-5"})])])]),e("form",{onSubmit:R(S,["prevent"]),class:"p-6 space-y-5"},[e("div",null,[s[21]||(s[21]=e("label",{class:"block text-sm font-medium text-gray-300 mb-2"},[u(" Trigger hodisasi "),e("span",{class:"text-red-400"},"*")],-1)),e("div",Me,[b(e("select",{"onUpdate:modelValue":s[3]||(s[3]=t=>r.value.trigger_type=t),class:"w-full appearance-none bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition cursor-pointer"},[s[20]||(s[20]=e("option",{value:"",class:"bg-gray-800"},"Tanlang...",-1)),(a(!0),o(c,null,p(d.triggerTypes,(t,m)=>(a(),o("option",{key:m,value:m,class:"bg-gray-800"},l(t.name),9,Qe))),128))],512),[[w,r.value.trigger_type]]),n(i(q),{class:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"})]),r.value.trigger_type&&d.triggerTypes[r.value.trigger_type]?(a(),o("p",Fe,l(d.triggerTypes[r.value.trigger_type].description||"Bu hodisa sodir bo'lganda qoida ishga tushadi"),1)):v("",!0)]),r.value.trigger_type&&j.value.length>0?(a(),o("div",Re,[s[22]||(s[22]=e("label",{class:"block text-sm font-medium text-gray-300 mb-3"},[u(" Qo'shimcha shartlar "),e("span",{class:"text-gray-500 font-normal"},"(ixtiyoriy)")],-1)),e("div",He,[(a(!0),o(c,null,p(j.value,t=>(a(),o("div",{key:t,class:"flex items-center gap-3"},[e("span",Ne,l(t),1),b(e("input",{"onUpdate:modelValue":m=>r.value.trigger_conditions[t]=m,type:"text",class:"flex-1 bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-white text-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition",placeholder:`${t} qiymati`},null,8,Ye),[[T,r.value.trigger_conditions[t]]])]))),128))])])):v("",!0),e("div",Ee,[e("div",null,[s[24]||(s[24]=e("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Qaysi bosqichdan ",-1)),e("div",Ge,[b(e("select",{"onUpdate:modelValue":s[4]||(s[4]=t=>r.value.from_stage_slug=t),class:"w-full appearance-none bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition cursor-pointer text-sm"},[s[23]||(s[23]=e("option",{value:"",class:"bg-gray-800"},"Har qanday",-1)),(a(!0),o(c,null,p(d.stages,t=>(a(),o("option",{key:t.slug,value:t.slug,class:"bg-gray-800"},l(t.name),9,Ie))),128))],512),[[w,r.value.from_stage_slug]]),n(i(q),{class:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"})])]),e("div",null,[s[26]||(s[26]=e("label",{class:"block text-sm font-medium text-gray-300 mb-2"},[u(" Qaysi bosqichga "),e("span",{class:"text-red-400"},"*")],-1)),e("div",Je,[b(e("select",{"onUpdate:modelValue":s[5]||(s[5]=t=>r.value.to_stage_slug=t),required:"",class:"w-full appearance-none bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition cursor-pointer text-sm"},[s[25]||(s[25]=e("option",{value:"",class:"bg-gray-800"},"Tanlang...",-1)),(a(!0),o(c,null,p(d.stages,t=>(a(),o("option",{key:t.slug,value:t.slug,class:"bg-gray-800"},l(t.name),9,Ke))),128))],512),[[w,r.value.to_stage_slug]]),n(i(q),{class:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"})])])]),r.value.from_stage_slug||r.value.to_stage_slug?(a(),o("div",We,[e("span",Xe,l(r.value.from_stage_slug?d.stages.find(t=>t.slug===r.value.from_stage_slug)?.name:"Har qanday"),1),n(i($),{class:"w-5 h-5 text-emerald-400"}),r.value.to_stage_slug?(a(),o("span",Ze,l(d.stages.find(t=>t.slug===r.value.to_stage_slug)?.name),1)):(a(),o("span",et," ? "))])):v("",!0),e("div",tt,[e("label",st,[b(e("input",{"onUpdate:modelValue":s[6]||(s[6]=t=>r.value.only_if_current_stage=t),type:"checkbox",class:"w-5 h-5 rounded bg-gray-700 border-gray-600 text-emerald-500 focus:ring-emerald-500 focus:ring-offset-gray-800"},null,512),[[B,r.value.only_if_current_stage]]),s[27]||(s[27]=e("div",null,[e("span",{class:"text-sm text-white group-hover:text-emerald-400 transition"},"Faqat tanlangan bosqichdan"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Lead aynan shu bosqichda bo'lgandagina ishlaydi")],-1))]),e("label",rt,[b(e("input",{"onUpdate:modelValue":s[7]||(s[7]=t=>r.value.prevent_backward=t),type:"checkbox",class:"w-5 h-5 rounded bg-gray-700 border-gray-600 text-emerald-500 focus:ring-emerald-500 focus:ring-offset-gray-800"},null,512),[[B,r.value.prevent_backward]]),s[28]||(s[28]=e("div",null,[e("span",{class:"text-sm text-white group-hover:text-emerald-400 transition"},"Orqaga o'tishni oldini ol"),e("p",{class:"text-xs text-gray-500 mt-0.5"},"Lead orqaga qaytmasligini ta'minlaydi")],-1))])]),e("div",null,[e("label",at,[s[29]||(s[29]=u(" Prioritet ",-1)),e("span",ot,"("+l(r.value.priority)+")",1)]),b(e("input",{"onUpdate:modelValue":s[8]||(s[8]=t=>r.value.priority=t),type:"range",min:"0",max:"100",class:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-emerald-500"},null,512),[[T,r.value.priority,void 0,{number:!0}]]),s[30]||(s[30]=e("div",{class:"flex justify-between text-xs text-gray-500 mt-1"},[e("span",null,"Past"),e("span",null,"O'rta"),e("span",null,"Yuqori")],-1))])],32),e("div",lt,[e("button",{type:"button",onClick:s[9]||(s[9]=t=>y.value=!1),class:"px-4 py-2.5 text-sm font-medium text-gray-300 hover:text-white transition"}," Bekor qilish "),e("button",{onClick:S,disabled:!r.value.trigger_type||!r.value.to_stage_slug,class:"px-5 py-2.5 text-sm font-medium bg-emerald-600 hover:bg-emerald-500 text-white rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition flex items-center gap-2"},[n(i(k),{class:"w-4 h-4"}),s[31]||(s[31]=u(" Qoida qo'shish ",-1))],8,it)])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])]),_:1}))}};export{Lt as default};
