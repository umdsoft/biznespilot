import{r as a,b as e,o as r,v as t,x as s,L as i,y as l,C as o,I as d,A as n,B as g,E as u,D as c,z as x,J as p,K as y,F as m,H as h,G as b}from"./chunk-CpmtkKLp.js";import{h as k,a as v}from"./chunk-BhZp3z4u.js";import{_ as f}from"./chunk-BDBDdGhv.js";import{a as w}from"./chunk-D7SyfRoT.js";import{r as j}from"./chunk-C8W6ukxQ.js";import{a as q}from"./chunk-CouA7u-j.js";import{r as _}from"./chunk-CdKrFGoA.js";import{r as z}from"./chunk-DvlohF_U.js";import{r as B}from"./chunk-C9nNyFhC.js";import{r as C}from"./chunk-beXL1A--.js";import"./app-C-ZlocOh.js";import"./chunk-BWiubfpN.js";import"./chunk-DmrwHl-6.js";import"./chunk-De_qwhex.js";import"./chunk-eMHYSAeQ.js";import"./chunk-CAoK8Mdm.js";import"./chunk-BiBvtcLb.js";import"./chunk-DNKDGYPp.js";import"./chunk-BiW1c8q7.js";import"./chunk-CTIk0k8a.js";import"./chunk-dqIIyBTR.js";import"./chunk-CvscUVdi.js";import"./chunk-BvbZUszZ.js";import"./chunk-BYA8ViGa.js";import"./chunk-DCXiFUg-.js";import"./chunk-Bsc1JRL5.js";import"./chunk-BuJDoypK.js";const $={class:"space-y-6"},O={class:"flex items-center justify-between"},Y=["disabled"],H={key:0,class:"grid grid-cols-1 md:grid-cols-5 gap-4"},A={class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700"},K={class:"text-center"},X={class:"w-12 h-12 mx-auto bg-gray-100 dark:bg-gray-700 rounded-xl flex items-center justify-center mb-3"},J={class:"text-2xl font-bold text-gray-900 dark:text-white"},P={class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border-l-4 border-red-500"},R={class:"text-center"},F={class:"text-3xl font-bold text-red-500 dark:text-red-400"},I={class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border-l-4 border-orange-500"},T={class:"text-center"},U={class:"text-3xl font-bold text-orange-500 dark:text-orange-400"},D={class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border-l-4 border-yellow-500"},G={class:"text-center"},M={class:"text-3xl font-bold text-yellow-500 dark:text-yellow-400"},Q={class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border-l-4 border-green-500"},V={class:"text-center"},E={class:"text-3xl font-bold text-green-500 dark:text-green-400"},L={key:1,class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700"},N={class:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2"},W={class:"space-y-3"},S={key:2,class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700"},Z={class:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4"},aa={class:"text-sm text-gray-700 dark:text-gray-300 mt-1 font-medium"},ea={class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},ra={class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700"},ta={class:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2"},sa={class:"flex items-center gap-4"},ia={class:"flex items-center gap-2"},la=["value"],oa={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden border border-gray-200 dark:border-gray-700"},da={class:"overflow-x-auto"},na={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},ga={class:"divide-y divide-gray-200 dark:divide-gray-700"},ua={class:"px-6 py-4 whitespace-nowrap"},ca={class:"flex items-center"},xa={class:"w-10 h-10 bg-purple-100 dark:bg-purple-900/50 rounded-full flex items-center justify-center"},pa={class:"text-sm font-medium text-purple-600 dark:text-purple-300"},ya={class:"ml-4"},ma={class:"text-sm font-medium text-gray-900 dark:text-white"},ha={class:"text-sm text-gray-500 dark:text-gray-400"},ba={class:"px-6 py-4 whitespace-nowrap"},ka={class:"flex items-center gap-2"},va={class:"px-6 py-4 whitespace-nowrap"},fa={class:"px-6 py-4"},wa={class:"flex flex-wrap gap-1"},ja={class:"px-6 py-4 whitespace-nowrap text-right"},qa={class:"flex items-center justify-end gap-2"},_a=["onClick"],za=["onClick"],Ba={key:0,class:"p-8 text-center"},Ca={key:1,class:"p-8 text-center text-gray-500 dark:text-gray-400"},$a={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/60"},Oa={class:"bg-white dark:bg-gray-800 rounded-xl p-6 w-full max-w-md mx-4 border border-gray-200 dark:border-gray-700"},Ya={class:"text-sm text-gray-600 dark:text-gray-300 mb-4"},Ha={class:"font-medium"},Aa={class:"flex justify-end gap-3 mt-4"},Ka={__name:"Index",props:{currentBusiness:Object},setup(Ka){const Xa=Ka,Ja=a(!0),Pa=a([]),Ra=a(null),Fa=a(""),Ia=a(!1),Ta=a(null),Ua=a(""),Da=[{value:"",label:"Barcha darajalar"},{value:"critical",label:"Juda yuqori xavf"},{value:"high",label:"Yuqori xavf"},{value:"moderate",label:"O'rtacha xavf"},{value:"low",label:"Past xavf"}],Ga=a=>({critical:"Juda yuqori xavf",high:"Yuqori xavf",moderate:"O'rtacha xavf",medium:"O'rtacha xavf",low:"Past xavf"}[a]||a),Ma=e(()=>{if(!Ra.value)return[];const a=[],e=Ra.value.distribution||{},r=Ra.value.factor_analysis||[],t=Ra.value.overview?.avg_risk_score||0,s=(e.critical?.count||0)+(e.high?.count||0);s>0&&a.push({type:"warning",title:"Yuqori xavfdagi hodimlar",message:`${s} ta hodim yuqori yoki juda yuqori ketish xavfida. Ular bilan shaxsiy suhbat o'tkazing va sabablarini aniqlang.`,icon:"exclamation"}),t>=60?a.push({type:"danger",title:"Umumiy xavf darajasi yuqori",message:`O'rtacha xavf balli ${t}%. Kompaniyada umumiy muammo bo'lishi mumkin - ish sharoitlari, kompensatsiya yoki boshqaruv sifatini tekshiring.`,icon:"alert"}):t>=40?a.push({type:"warning",title:"O'rtacha xavf darajasi",message:`O'rtacha xavf balli ${t}%. Proaktiv choralar ko'rish tavsiya etiladi.`,icon:"info"}):a.push({type:"success",title:"Xavf darajasi nazorat ostida",message:`O'rtacha xavf balli ${t}%. Hodimlar odatda kompaniyada qolishga tayyor.`,icon:"check"});const i=r.filter(a=>a.avg_score>=50);if(i.length>0){const e=i.map(a=>a.label).join(", ");a.push({type:"info",title:"Asosiy xavf omillari",message:`Eng ko'p ta'sir qiluvchi omillar: ${e}. Bu sohalarga e'tibor qarating.`,icon:"lightbulb"})}if(r.length>0){const e=r[0],t=Qa(e.key,e.avg_score);t&&a.push({type:"tip",title:"Tavsiya",message:t,icon:"lightbulb"})}return a}),Qa=(a,e)=>{if(e<40)return null;return{engagement:"Hodimlar ishga qiziqishi past. Gallup Q12 so'rovnomasini o'tkazing va natijalarni tahlil qiling. Regular 1:1 uchrashuvlar o'tkazing.",tenure:"Yangi hodimlar ko'p ketmoqda. Onboarding jarayonini yaxshilang va birinchi 90 kun davomida ko'proq e'tibor bering.",compensation:"Kompensatsiya bilan bog'liq muammolar bor. Bozor narxlarini o'rganing va raqobatbardosh taklif qiling.",growth:"Hodimlar o'sish imkoniyatlarini ko'rmayapti. Aniq martaba yo'llarini belgilang va o'quv dasturlarini taklif qiling.",workload:"Ish yuki juda og'ir. Vazifalarni qayta taqsimlang va qo'shimcha resurslar yollashni ko'rib chiqing.",recognition:"Hodimlar tan olinmayapti. Muvaffaqiyatlarni nishonlash va tashakkur bildirish madaniyatini joriy qiling."}[a]||null},Va=async()=>{if(Xa.currentBusiness?.id){Ja.value=!0;try{const[a,e]=await Promise.all([v.get(`/api/v1/businesses/${Xa.currentBusiness.id}/hr/flight-risk`,{params:{risk_level:Fa.value||void 0}}),v.get(`/api/v1/businesses/${Xa.currentBusiness.id}/hr/flight-risk/statistics`)]);Pa.value=a.data.data?.data||[],Ra.value=e.data.data}catch(a){}finally{Ja.value=!1}}},Ea=async()=>{if(Xa.currentBusiness?.id&&Ta.value&&Ua.value.trim())try{await v.post(`/api/v1/businesses/${Xa.currentBusiness.id}/hr/flight-risk/${Ta.value.user?.id}/mitigation`,{action:Ua.value}),Ia.value=!1,Ua.value="",Va()}catch(a){}},La=a=>a>=70?"text-red-500 dark:text-red-400":a>=50?"text-orange-500 dark:text-orange-400":a>=30?"text-yellow-500 dark:text-yellow-400":"text-green-500 dark:text-green-400",Na=a=>({danger:"text-red-800 dark:text-red-300",warning:"text-amber-800 dark:text-amber-300",success:"text-green-800 dark:text-green-300",info:"text-blue-800 dark:text-blue-300",tip:"text-purple-800 dark:text-purple-300"}[a]||"text-gray-800 dark:text-gray-300");return r(Va),(a,e)=>(c(),t(f,{title:"Flight Risk"},{default:s(()=>[i(n(k),{title:"Ketish Xavfi"}),l("div",$,[l("div",O,[e[4]||(e[4]=l("div",null,[l("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"}," Ketish Xavfi Tahlili "),l("p",{class:"text-gray-500 dark:text-gray-400 mt-1"}," Hodimlarning ketish xavfini kuzatish va proaktiv choralar ko'rish ")],-1)),l("button",{onClick:Va,disabled:Ja.value,class:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50"},[i(n(w),{class:u(["w-5 h-5",Ja.value?"animate-spin":""])},null,8,["class"]),e[3]||(e[3]=g(" Yangilash ",-1))],8,Y)]),Ra.value?(c(),o("div",H,[l("div",A,[l("div",K,[l("div",X,[i(n(j),{class:"w-6 h-6 text-gray-600 dark:text-gray-300"})]),l("p",J,x(Ra.value.overview?.total_employees||0),1),e[5]||(e[5]=l("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Jami hodimlar",-1))])]),l("div",P,[l("div",R,[l("p",F,x(Ra.value.distribution?.critical?.count||0),1),e[6]||(e[6]=l("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Juda yuqori xavf",-1))])]),l("div",I,[l("div",T,[l("p",U,x(Ra.value.distribution?.high?.count||0),1),e[7]||(e[7]=l("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Yuqori xavf",-1))])]),l("div",D,[l("div",G,[l("p",M,x(Ra.value.distribution?.moderate?.count||0),1),e[8]||(e[8]=l("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"O'rtacha xavf",-1))])]),l("div",Q,[l("div",V,[l("p",E,x(Ra.value.distribution?.low?.count||0),1),e[9]||(e[9]=l("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Past xavf",-1))])])])):d("",!0),Ma.value.length>0?(c(),o("div",L,[l("h3",N,[i(n(q),{class:"w-5 h-5 text-amber-500"}),e[10]||(e[10]=g(" Xulosa va Tavsiyalar ",-1))]),l("div",W,[(c(!0),o(p,null,y(Ma.value,(a,e)=>{return c(),o("div",{key:e,class:u(["p-4 rounded-lg border",(r=a.type,{danger:"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800",warning:"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800",success:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",info:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",tip:"bg-purple-50 dark:bg-purple-900/20 border-purple-200 dark:border-purple-800"}[r]||"bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-700")])},[l("h4",{class:u(["font-medium mb-1",Na(a.type)])},x(a.title),3),l("p",{class:u(["text-sm",Na(a.type)])},x(a.message),3)],2);var r}),128))])])):d("",!0),Ra.value?.factor_analysis?(c(),o("div",S,[e[11]||(e[11]=l("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"}," Xavf omillari tahlili ",-1)),l("div",Z,[(c(!0),o(p,null,y(Ra.value.factor_analysis,a=>(c(),o("div",{key:a.key,class:"p-4 bg-gray-50 dark:bg-gray-700 rounded-lg text-center border border-gray-200 dark:border-gray-600"},[l("div",{class:u(["text-2xl font-bold",La(a.avg_score)])},x(a.avg_score)+"% ",3),l("div",aa,x(a.label),1),l("div",ea,x(a.impact),1)]))),128))])])):d("",!0),l("div",ra,[l("h3",ta,[i(n(_),{class:"w-5 h-5 text-blue-500"}),e[12]||(e[12]=g(" Flight Risk haqida ",-1))]),e[13]||(e[13]=l("div",{class:"prose dark:prose-invert max-w-none text-sm"},[l("p",{class:"text-gray-700 dark:text-gray-300 mb-3"},[l("strong",null,"Flight Risk"),g(" - bu hodimning kompaniyani tark etish ehtimolini baholash tizimi. Bu ko'rsatkich bir nechta omillar asosida hisoblanadi va HR jamoasiga proaktiv choralar ko'rishga yordam beradi. ")]),l("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[l("div",null,[l("h4",{class:"font-medium text-gray-900 dark:text-white mb-2"},"Xavf darajalari:"),l("ul",{class:"space-y-1 text-gray-600 dark:text-gray-400"},[l("li",null,[l("span",{class:"text-red-500 font-medium"},"Juda yuqori (70%+):"),g(" Tezkor aralashuv zarur")]),l("li",null,[l("span",{class:"text-orange-500 font-medium"},"Yuqori (50-70%):"),g(" Diqqat talab qiladi")]),l("li",null,[l("span",{class:"text-yellow-500 font-medium"},"O'rtacha (30-50%):"),g(" Kuzatish ostida")]),l("li",null,[l("span",{class:"text-green-500 font-medium"},"Past (0-30%):"),g(" Barqaror")])])]),l("div",null,[l("h4",{class:"font-medium text-gray-900 dark:text-white mb-2"},"Asosiy omillar:"),l("ul",{class:"space-y-1 text-gray-600 dark:text-gray-400"},[l("li",null,[l("strong",null,"Ishga qiziqish:"),g(" Ishga qiziqish darajasi (so'rovnoma asosida)")]),l("li",null,[l("strong",null,"Tenure:"),g(" Kompaniyada ishlash muddati")]),l("li",null,[l("strong",null,"Growth:"),g(" Martaba o'sish imkoniyatlari")]),l("li",null,[l("strong",null,"Recognition:"),g(" Muvaffaqiyatlarni tan olish")])])])])],-1))]),l("div",sa,[l("div",ia,[i(n(z),{class:"w-5 h-5 text-gray-400 dark:text-gray-500"}),m(l("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>Fa.value=a),onChange:Va,class:"px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 text-gray-900 dark:text-white"},[(c(),o(p,null,y(Da,a=>l("option",{key:a.value,value:a.value},x(a.label),9,la)),64))],544),[[h,Fa.value]])])]),l("div",oa,[l("div",da,[l("table",na,[e[14]||(e[14]=l("thead",{class:"bg-gray-50 dark:bg-gray-700"},[l("tr",null,[l("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase"},"Hodim"),l("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase"},"Xavf balli"),l("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase"},"Daraja"),l("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase"},"Asosiy omillar"),l("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase"},"Amallar")])],-1)),l("tbody",ga,[(c(!0),o(p,null,y(Pa.value,a=>{return c(),o("tr",{key:a.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50"},[l("td",ua,[l("div",ca,[l("div",xa,[l("span",pa,x(a.user?.name?.charAt(0)||"?"),1)]),l("div",ya,[l("div",ma,x(a.user?.name||"Noma'lum"),1),l("div",ha,x(a.user?.email),1)])])]),l("td",ba,[l("div",ka,[l("span",{class:u(["text-lg font-bold",La(a.risk_score)])},x(a.risk_score)+"% ",3)])]),l("td",va,[l("span",{class:u(["px-3 py-1 text-xs font-medium rounded-full",(e=a.risk_level,{critical:"bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300",high:"bg-orange-100 text-orange-800 dark:bg-orange-900/50 dark:text-orange-300",moderate:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300",medium:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300",low:"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300"}[e]||"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300")])},x(Ga(a.risk_level)),3)]),l("td",fa,[l("div",wa,[(c(!0),o(p,null,y(a.top_risk_factors,(a,e)=>(c(),o("span",{key:e,class:"px-2 py-0.5 text-xs bg-gray-100 dark:bg-gray-600 text-gray-700 dark:text-gray-200 rounded"},x(a),1))),128))])]),l("td",ja,[l("div",qa,[l("button",{onClick:e=>(a=>{Ta.value=a,Ia.value=!0})(a),class:"p-2 text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/30 rounded-lg",title:"Chora-tadbir qo'shish"},[i(n(B),{class:"w-5 h-5"})],8,_a),l("button",{onClick:e=>(async a=>{if(Xa.currentBusiness?.id)try{await v.post(`/api/v1/businesses/${Xa.currentBusiness.id}/hr/flight-risk/${a}/recalculate`),Va()}catch(e){}})(a.user?.id),class:"p-2 text-purple-600 dark:text-purple-400 hover:bg-purple-50 dark:hover:bg-purple-900/30 rounded-lg",title:"Qayta hisoblash"},[i(n(w),{class:"w-5 h-5"})],8,za)])])]);var e}),128))])])]),Ja.value?(c(),o("div",Ba,[i(n(w),{class:"w-8 h-8 mx-auto animate-spin text-purple-500 dark:text-purple-400"}),e[15]||(e[15]=l("p",{class:"mt-2 text-gray-500 dark:text-gray-400"},"Yuklanmoqda...",-1))])):0===Pa.value.length?(c(),o("div",Ca,[i(n(C),{class:"w-12 h-12 mx-auto opacity-50 mb-3"}),e[16]||(e[16]=l("p",null,"Flight risk ma'lumotlari topilmadi",-1))])):d("",!0)])]),Ia.value?(c(),o("div",$a,[l("div",Oa,[e[18]||(e[18]=l("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"}," Chora-tadbir qo'shish ",-1)),l("p",Ya,[l("span",Ha,x(Ta.value?.user?.name),1),e[17]||(e[17]=g(" uchun ",-1))]),m(l("textarea",{"onUpdate:modelValue":e[1]||(e[1]=a=>Ua.value=a),rows:"3",placeholder:"Chora-tadbir tavsifi...",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 focus:ring-2 focus:ring-purple-500 focus:border-purple-500"},null,512),[[b,Ua.value]]),l("div",Aa,[l("button",{onClick:e[2]||(e[2]=a=>Ia.value=!1),class:"px-4 py-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"}," Bekor qilish "),l("button",{onClick:Ea,class:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"}," Qo'shish ")])])])):d("",!0)]),_:1}))}};export{Ka as default};
