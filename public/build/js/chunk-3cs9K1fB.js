import{r as e,b as a,o as t,e as r,C as s,D as l,y as o,F as i,L as n,I as d,A as u,z as c,V as g,x as h,B as x,J as b,K as v,E as y,v as m,O as k}from"./chunk-CpmtkKLp.js";import{b as p,l as f,r as w,a as j}from"./chunk-BhZp3z4u.js";import{r as C}from"./chunk-BG5DB3cD.js";import{r as z}from"./chunk-eMHYSAeQ.js";import{r as D}from"./chunk-CdKrFGoA.js";import{r as $}from"./chunk-DvBKKKMs.js";import{r as _}from"./chunk-beXL1A--.js";const q={class:"relative"},L={key:0,class:"absolute -top-1 -right-1 inline-flex items-center justify-center min-w-[18px] h-[18px] px-1 text-xs font-bold bg-red-500 text-white rounded-full animate-pulse"},W={class:"absolute right-0 mt-2 w-80 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 z-50 overflow-hidden"},B={class:"px-4 py-3 border-b border-gray-100 dark:border-gray-700 flex items-center justify-between"},E={class:"max-h-80 overflow-y-auto"},I=["onClick"],M={class:"flex items-start gap-3"},O={class:"flex-1 min-w-0"},A={class:"text-sm font-medium text-gray-900 dark:text-white truncate"},H={class:"text-xs text-gray-500 dark:text-gray-400 line-clamp-2"},F={class:"text-xs text-gray-400 dark:text-gray-500 mt-1"},J={key:1,class:"px-4 py-8 text-center"},K={key:0,class:"px-4 py-2 border-t border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50"},N={__name:"AlertDropdown",setup(N){const S=p(),U=e(!1),V=e([]),Z=e(0),G=e(!1);let P=null;const Q=a(()=>{const e=S.url;return e.startsWith("/operator")?"/operator/alerts":e.startsWith("/sales-head")?"/sales-head/alerts":"/business/alerts"}),R=a(()=>{const e=S.url;return e.startsWith("/operator")?"/operator/alerts/active":e.startsWith("/sales-head")?"/sales-head/alerts/active":"/business/alerts/active"}),T=()=>{U.value=!U.value,U.value&&X()},X=async()=>{try{G.value=!0;const e=await j.get(R.value);e.data&&(V.value=e.data.alerts||[],Z.value=e.data.unreadCount||0)}catch(e){}finally{G.value=!1}},Y=async()=>{try{const e=Q.value+"/mark-all-read";await j.post(e),Z.value=0,V.value=V.value.map(e=>({...e,status:"read"}))}catch(e){}},ee=e=>{const a={urgent:"bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400",high:"bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400",medium:"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400",low:"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"};return a[e]||a.medium},ae=e=>{const a={urgent:_,high:$,medium:D,low:z};return a[e]||a.medium},te=e=>{const a=new Date(e),t=new Date-a,r=Math.floor(t/6e4),s=Math.floor(t/36e5),l=Math.floor(t/864e5);return r<1?"Hozir":r<60?`${r} daqiqa oldin`:s<24?`${s} soat oldin`:l<7?`${l} kun oldin`:a.toLocaleDateString("uz-UZ")},re=e=>{e.target.closest(".relative")||(U.value=!1)};return t(()=>{document.addEventListener("click",re),X(),P=setInterval(()=>{U.value||X()},6e4)}),r(()=>{document.removeEventListener("click",re),P&&clearInterval(P)}),(e,a)=>(l(),s("div",q,[o("button",{onClick:T,class:"relative flex items-center justify-center w-10 h-10 rounded-xl border border-gray-200 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all duration-200",title:"Ogohlantirishlar"},[n(u(C),{class:"w-5 h-5 text-gray-600 dark:text-gray-400"}),Z.value>0?(l(),s("span",L,c(Z.value>99?"99+":Z.value),1)):d("",!0)]),i(o("div",W,[o("div",B,[a[2]||(a[2]=o("h3",{class:"font-semibold text-gray-900 dark:text-white"},"Ogohlantirishlar",-1)),n(u(f),{href:Q.value,class:"text-xs text-blue-600 dark:text-blue-400 hover:underline",onClick:a[0]||(a[0]=e=>U.value=!1)},{default:h(()=>[...a[1]||(a[1]=[x(" Barchasini ko'rish ",-1)])]),_:1},8,["href"])]),o("div",E,[V.value.length>0?(l(!0),s(b,{key:0},v(V.value,e=>(l(),s("div",{key:e.id,class:"px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700 border-b border-gray-100 dark:border-gray-700 last:border-0 cursor-pointer",onClick:a=>(e=>{U.value=!1,w.visit(`${Q.value}/${e.id}`)})(e)},[o("div",M,[o("div",{class:y(["w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",ee(e.priority)])},[(l(),m(k(ae(e.priority)),{class:"w-4 h-4"}))],2),o("div",O,[o("p",A,c(e.title),1),o("p",H,c(e.message),1),o("p",F,c(te(e.created_at)),1)])])],8,I))),128)):(l(),s("div",J,[n(u(C),{class:"w-12 h-12 mx-auto text-gray-300 dark:text-gray-600"}),a[3]||(a[3]=o("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"}," Hozircha ogohlantirishlar yo'q ",-1))]))]),V.value.length>0?(l(),s("div",K,[o("button",{onClick:Y,class:"w-full text-center text-sm text-blue-600 dark:text-blue-400 hover:underline"}," Barchasini o'qilgan deb belgilash ")])):d("",!0)],512),[[g,U.value]])]))}};export{N as _};
