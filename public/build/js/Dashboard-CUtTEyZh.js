import{r as e,o as t,w as a,b as s,v as r,x as l,L as d,y as i,A as n,C as o,I as c,F as g,G as x,D as u,E as m,z as p,Q as y,B as b,J as h,K as v}from"./chunk-CpmtkKLp.js";import{b as f,h as k,l as w,a as _}from"./chunk-BhZp3z4u.js";import{_ as j}from"./chunk-DQR5_hTm.js";import{u as F}from"./app-C-ZlocOh.js";import{r as M}from"./chunk-dqIIyBTR.js";import{r as q}from"./chunk-BiW1c8q7.js";import{r as D}from"./chunk-D7oP9pDe.js";import{r as R}from"./chunk-C-cD-j23.js";import{r as B}from"./chunk-Bsc1JRL5.js";import{r as S}from"./chunk-B3ILNJqD.js";import{r as I}from"./chunk-eMHYSAeQ.js";import{r as U}from"./chunk-DNKDGYPp.js";import{r as A}from"./chunk-C2r_KHf6.js";import{r as O}from"./chunk-XzsiFwnJ.js";import"./chunk-D7SyfRoT.js";import"./chunk-CouA7u-j.js";import"./chunk-DmrwHl-6.js";import"./chunk-De_qwhex.js";import"./chunk-beXL1A--.js";import"./chunk-CAoK8Mdm.js";import"./chunk-BiBvtcLb.js";import"./chunk-CTIk0k8a.js";import"./chunk-CvscUVdi.js";import"./chunk-BvbZUszZ.js";import"./chunk-C9nNyFhC.js";import"./chunk-BYA8ViGa.js";import"./chunk-DCXiFUg-.js";import"./chunk-BuJDoypK.js";import"./chunk-BWiubfpN.js";const z={class:"py-6 px-4 sm:px-6 lg:px-8"},K={class:"mb-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4"},P={class:"flex items-center gap-4"},Y=["disabled"],Z={key:0},J={key:1},C={key:0,class:"flex items-center justify-center py-20"},E={key:1,class:"space-y-8"},N={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"},Q={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-100 dark:border-gray-700"},$={class:"flex items-center justify-between mb-4"},G={class:"w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-xl flex items-center justify-center"},H={class:"space-y-2"},L={class:"text-3xl font-bold text-gray-900 dark:text-white"},T={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2"},V={class:"text-xs text-gray-500"},X={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-100 dark:border-gray-700"},W={class:"flex items-center justify-between mb-4"},ee={class:"w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-xl flex items-center justify-center"},te={key:0,class:"flex items-center text-green-600"},ae={key:1,class:"flex items-center text-red-600"},se={class:"space-y-2"},re={class:"text-2xl font-bold text-gray-900 dark:text-white"},le={class:"text-sm text-gray-500"},de={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-100 dark:border-gray-700"},ie={class:"flex items-center justify-between mb-4"},ne={class:"w-12 h-12 bg-orange-100 dark:bg-orange-900/30 rounded-xl flex items-center justify-center"},oe={class:"text-sm font-medium text-orange-600 dark:text-orange-400"},ce={class:"space-y-2"},ge={class:"text-2xl font-bold text-gray-900 dark:text-white"},xe={class:"text-sm text-gray-500"},ue={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-100 dark:border-gray-700"},me={class:"flex items-center justify-between mb-4"},pe={class:"w-12 h-12 bg-red-100 dark:bg-red-900/30 rounded-xl flex items-center justify-center"},ye={key:0,class:"px-2 py-1 text-xs font-medium text-red-600 bg-red-100 rounded-full"},be={class:"space-y-2"},he={class:"text-2xl font-bold text-gray-900 dark:text-white"},ve={class:"text-sm text-red-600"},fe={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ke={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-100 dark:border-gray-700"},we={class:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center"},_e={class:"flex items-end justify-between"},je={class:"text-4xl font-bold text-gray-900 dark:text-white"},Fe={class:"text-sm text-gray-500"},Me={class:"text-right"},qe={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-100 dark:border-gray-700"},De={class:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center"},Re={class:"flex items-end justify-between"},Be={class:"text-4xl font-bold text-gray-900 dark:text-white"},Se={class:"text-sm text-gray-500"},Ie={class:"h-16 w-16 rounded-full border-4 border-blue-500 flex items-center justify-center"},Ue={class:"text-lg font-bold text-blue-600"},Ae={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-100 dark:border-gray-700"},Oe={class:"flex items-center justify-between mb-6"},ze={class:"text-lg font-semibold text-gray-900 dark:text-white flex items-center"},Ke={class:"flex gap-2 text-sm"},Pe={class:"px-2 py-1 bg-green-100 text-green-700 rounded-full"},Ye={class:"px-2 py-1 bg-red-100 text-red-700 rounded-full"},Ze={class:"overflow-x-auto"},Je={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},Ce={class:"divide-y divide-gray-200 dark:divide-gray-700"},Ee={class:"px-4 py-4"},Ne={class:"px-4 py-4"},Qe={class:"flex items-center"},$e={class:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white font-bold"},Ge={class:"ml-3 font-medium text-gray-900 dark:text-white"},He={class:"px-4 py-4 text-right text-gray-500"},Le={class:"px-4 py-4 text-right font-medium text-gray-900 dark:text-white"},Te={class:"px-4 py-4 text-right"},Ve={class:"flex items-center justify-end"},Xe={class:"w-20 bg-gray-200 dark:bg-gray-700 rounded-full h-2 mr-2"},We={class:"px-4 py-4 text-right"},et={class:"px-4 py-4 text-right font-medium"},tt={key:0,class:"text-center py-8 text-gray-500"},at={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},st={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-100 dark:border-gray-700"},rt={class:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center"},lt={class:"space-y-4"},dt={class:"text-sm text-gray-600 dark:text-gray-400"},it={class:"flex items-center"},nt={class:"font-medium text-gray-900 dark:text-white min-w-[100px] text-right"},ot={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-100 dark:border-gray-700"},ct={class:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center"},gt={class:"grid grid-cols-2 gap-4 mb-4"},xt={class:"bg-red-50 dark:bg-red-900/20 rounded-xl p-4"},ut={class:"text-3xl font-bold text-red-600"},mt={class:"bg-red-50 dark:bg-red-900/20 rounded-xl p-4"},pt={class:"text-2xl font-bold text-red-600"},yt={key:0,class:"bg-gray-50 dark:bg-gray-700/50 rounded-xl p-4"},bt={class:"font-medium text-gray-900 dark:text-white"},ht={class:"text-sm text-gray-500"},vt={key:1,class:"mt-3 bg-gray-50 dark:bg-gray-700/50 rounded-xl p-4"},ft={class:"font-medium text-gray-900 dark:text-white"},kt={class:"text-sm text-gray-500"},wt={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-100 dark:border-gray-700"},_t={class:"text-lg font-semibold text-gray-900 dark:text-white mb-6 flex items-center"},jt={class:"h-64 flex items-end justify-between gap-4"},Ft={class:"w-full flex flex-col items-center gap-1 h-48"},Mt=["title"],qt=["title"],Dt={class:"mt-2 text-center"},Rt={class:"text-xs font-medium text-gray-900 dark:text-white"},Bt={class:"text-xs text-gray-500"},St={key:2,class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-12 text-center"},It={__name:"Dashboard",props:{currentBusiness:{type:Object,default:null}},setup(It){F(),f();const Ut=It,At=e(!1),Ot=e((new Date).toISOString().slice(0,7)),zt=e(null),Kt=async()=>{if(Ut.currentBusiness?.id){At.value=!0;try{const e=await _.get(`/api/v1/businesses/${Ut.currentBusiness.id}/sales-analytics/dashboard`,{params:{date:Ot.value+"-01"}});zt.value=e.data.data}catch(e){}finally{At.value=!1}}};t(()=>{Kt()}),a(Ot,()=>{Kt()});const Pt=s(()=>zt.value?.current_period||{}),Yt=s(()=>zt.value?.manager_rankings||{}),Zt=s(()=>zt.value?.receivables||{}),Jt=s(()=>zt.value?.rejection_analysis||{}),Ct=s(()=>zt.value?.trend||[]),Et=e=>e<0?"text-red-600 bg-red-100":e<.5?"text-orange-600 bg-orange-100":e<1?"text-yellow-600 bg-yellow-100":e>=1?"text-green-600 bg-green-100":"text-gray-600 bg-gray-100",Nt=e=>e>=100?"bg-green-500":e>=80?"bg-blue-500":e>=50?"bg-yellow-500":"bg-red-500",Qt=e=>e?new Intl.NumberFormat("uz-UZ").format(Math.round(e)):"0",$t=e=>e?new Intl.NumberFormat("uz-UZ",{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)+" UZS":"0 UZS";return(e,t)=>(u(),r(j,null,{default:l(()=>[d(n(k),{title:"Sotuv Dashboardi - ROP"}),i("div",z,[i("div",K,[t[1]||(t[1]=i("div",null,[i("h1",{class:"text-3xl font-bold text-gray-900 dark:text-white"}," Sotuv bo'limi dashboardi "),i("p",{class:"text-gray-500 dark:text-gray-400 mt-1"}," Denis Shenukov metodologiyasi asosida tahlil ")],-1)),i("div",P,[g(i("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>Ot.value=e),type:"month",class:"rounded-lg border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[x,Ot.value]]),i("button",{onClick:Kt,disabled:At.value,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors"},[At.value?(u(),o("span",Z,"Yuklanmoqda...")):(u(),o("span",J,"Yangilash"))],8,Y)])]),At.value?(u(),o("div",C,[...t[2]||(t[2]=[i("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"},null,-1)])])):zt.value?(u(),o("div",E,[i("div",N,[i("div",Q,[i("div",$,[i("div",G,[d(n(M),{class:"w-6 h-6 text-blue-600 dark:text-blue-400"})]),Pt.value.has_target?(u(),o("span",{key:0,class:m(["px-3 py-1 text-sm font-medium rounded-full",Et(Pt.value.kpi_score)])}," KPI: "+p((100*Pt.value.kpi_score).toFixed(1))+"% ",3)):c("",!0)]),i("div",H,[t[3]||(t[3]=i("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Reja bajarilishi",-1)),i("p",L,p(Pt.value.completion_percent?.toFixed(1)||0)+"% ",1),i("div",T,[i("div",{class:m(["h-2 rounded-full transition-all",Nt(Pt.value.completion_percent)]),style:y({width:Math.min(Pt.value.completion_percent||0,100)+"%"})},null,6)]),i("p",V,p(Pt.value.kpi_interpretation?.message),1)])]),i("div",X,[i("div",W,[i("div",ee,[d(n(q),{class:"w-6 h-6 text-green-600 dark:text-green-400"})]),Pt.value.is_on_track?(u(),o("div",te,[d(n(D),{class:"w-5 h-5 mr-1"}),t[4]||(t[4]=i("span",{class:"text-sm font-medium"},"Trendda",-1))])):(u(),o("div",ae,[d(n(R),{class:"w-5 h-5 mr-1"}),t[5]||(t[5]=i("span",{class:"text-sm font-medium"},"Orqada",-1))]))]),i("div",se,[t[6]||(t[6]=i("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Haqiqiy daromad",-1)),i("p",re,p($t(Pt.value.fact_revenue)),1),i("p",le," Reja: "+p($t(Pt.value.plan_revenue)),1)])]),i("div",de,[i("div",ie,[i("div",ne,[d(n(B),{class:"w-6 h-6 text-orange-600 dark:text-orange-400"})]),i("span",oe,p(Pt.value.days_remaining)+" kun qoldi ",1)]),i("div",ce,[t[7]||(t[7]=i("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Qolgan maqsad",-1)),i("p",ge,p($t(Pt.value.remaining_revenue)),1),i("p",xe," Kunlik kerak: "+p($t(Pt.value.daily_target)),1)])]),i("div",ue,[i("div",me,[i("div",pe,[d(n(S),{class:"w-6 h-6 text-red-600 dark:text-red-400"})]),Zt.value.overdue_percent>20?(u(),o("span",ye," Xavf! ")):c("",!0)]),i("div",be,[t[8]||(t[8]=i("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Debitorka",-1)),i("p",he,p($t(Zt.value.total_amount)),1),i("p",ve," Muddati o'tgan: "+p($t(Zt.value.overdue_amount))+" ("+p(Zt.value.overdue_percent?.toFixed(1))+"%) ",1)])])]),i("div",fe,[i("div",ke,[i("h3",we,[d(n(I),{class:"w-5 h-5 mr-2 text-green-600"}),t[9]||(t[9]=b(" Bitimlar ",-1))]),i("div",_e,[i("div",null,[i("p",je,p(Pt.value.deals?.fact||0),1),i("p",Fe," Rejadan "+p(Pt.value.deals?.plan||0)+" ta ",1)]),i("div",Me,[i("p",{class:m(["text-2xl font-bold",(Pt.value.deals?.percent||0)>=100?"text-green-600":"text-orange-600"])},p(Pt.value.deals?.percent?.toFixed(1)||0)+"% ",3),t[10]||(t[10]=i("p",{class:"text-sm text-gray-500"},"bajarildi",-1))])])]),i("div",qe,[i("h3",De,[d(n(U),{class:"w-5 h-5 mr-2 text-blue-600"}),t[11]||(t[11]=b(" Yangi mijozlar ",-1))]),i("div",Re,[i("div",null,[i("p",Be,p(Pt.value.new_clients?.fact||0),1),i("p",Se," Rejadan "+p(Pt.value.new_clients?.plan||0)+" ta ",1)]),i("div",Ie,[i("span",Ue,p(Pt.value.new_clients?.plan>0?Math.round(Pt.value.new_clients?.fact/Pt.value.new_clients?.plan*100):0)+"% ",1)])])])]),i("div",Ae,[i("div",Oe,[i("h3",ze,[d(n(A),{class:"w-5 h-5 mr-2 text-yellow-500"}),t[12]||(t[12]=b(" Menejerlar reytingi ",-1))]),i("div",Ke,[i("span",Pe,p(Yt.value.on_target_count||0)+" rejada ",1),i("span",Ye,p(Yt.value.below_target_count||0)+" orqada ",1)])]),i("div",Ze,[i("table",Je,[t[13]||(t[13]=i("thead",null,[i("tr",null,[i("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"#"),i("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Menejer"),i("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Reja"),i("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Fakt"),i("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Bajarilish"),i("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"KPI"),i("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Bitimlar")])],-1)),i("tbody",Ce,[(u(!0),o(h,null,v(Yt.value.rankings,(e,t)=>(u(),o("tr",{key:e.user_id,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50"},[i("td",Ee,[i("span",{class:m(["inline-flex items-center justify-center w-8 h-8 rounded-full font-bold text-sm",0===t?"bg-yellow-100 text-yellow-700":1===t?"bg-gray-100 text-gray-700":2===t?"bg-orange-100 text-orange-700":"bg-gray-50 text-gray-500"])},p(t+1),3)]),i("td",Ne,[i("div",Qe,[i("div",$e,p(e.user_name?.charAt(0)||"?"),1),i("span",Ge,p(e.user_name),1)])]),i("td",He,p(Qt(e.plan)),1),i("td",Le,p(Qt(e.fact)),1),i("td",Te,[i("div",Ve,[i("div",Xe,[i("div",{class:m(["h-2 rounded-full",Nt(e.completion_percent)]),style:y({width:Math.min(e.completion_percent,100)+"%"})},null,6)]),i("span",{class:m(e.completion_percent>=100?"text-green-600":"text-gray-600")},p(e.completion_percent?.toFixed(1))+"% ",3)])]),i("td",We,[i("span",{class:m(["px-2 py-1 text-sm font-medium rounded-full",Et(e.kpi_score)])},p((100*e.kpi_score).toFixed(0))+"% ",3)]),i("td",et,p(e.deals_closed),1)]))),128))])])]),Yt.value.rankings?.length?c("",!0):(u(),o("div",tt," Menejer ma'lumotlari topilmadi "))]),i("div",at,[i("div",st,[i("h3",rt,[d(n(S),{class:"w-5 h-5 mr-2 text-red-600"}),t[14]||(t[14]=b(" Debitorka yoshi (Aging) ",-1))]),i("div",lt,[(u(!0),o(h,null,v(Zt.value.aging,(e,t)=>(u(),o("div",{key:t,class:"flex items-center justify-between"},[i("span",dt,p("current"===t?"Joriy":"1_30_days"===t?"1-30 kun":"31_60_days"===t?"31-60 kun":"61_90_days"===t?"61-90 kun":"90+ kun"),1),i("div",it,[i("div",{class:m(["h-4 rounded mr-3","current"===t?"bg-green-500":"1_30_days"===t?"bg-yellow-500":"31_60_days"===t?"bg-orange-500":"bg-red-500"]),style:y({width:Zt.value.total_amount>0?Math.max(e/Zt.value.total_amount*200,4)+"px":"4px"})},null,6),i("span",nt,p($t(e)),1)])]))),128))])]),i("div",ot,[i("h3",ct,[d(n(O),{class:"w-5 h-5 mr-2 text-red-600"}),t[15]||(t[15]=b(" Yo'qotilgan bitimlar tahlili ",-1))]),i("div",gt,[i("div",xt,[i("p",ut,p(Jt.value.total_lost||0),1),t[16]||(t[16]=i("p",{class:"text-sm text-gray-500"},"Jami yo'qotilgan",-1))]),i("div",mt,[i("p",pt,p($t(Jt.value.total_lost_value)),1),t[17]||(t[17]=i("p",{class:"text-sm text-gray-500"},"Potensial qiymat",-1))])]),Jt.value.top_reason?(u(),o("div",yt,[t[18]||(t[18]=i("p",{class:"text-sm text-gray-500 mb-1"},"Eng ko'p rad etish sababi:",-1)),i("p",bt,[b(p(Jt.value.top_reason.reason_name)+" ",1),i("span",ht,"("+p(Jt.value.top_reason.count)+" marta)",1)])])):c("",!0),Jt.value.top_competitor?(u(),o("div",vt,[t[19]||(t[19]=i("p",{class:"text-sm text-gray-500 mb-1"},"Asosiy raqobatchi:",-1)),i("p",ft,[b(p(Jt.value.top_competitor.competitor_name)+" ",1),i("span",kt,"("+p(Jt.value.top_competitor.count)+" marta)",1)])])):c("",!0)])]),i("div",wt,[i("h3",_t,[d(n(M),{class:"w-5 h-5 mr-2 text-blue-600"}),t[20]||(t[20]=b(" 6 oylik trend ",-1))]),i("div",jt,[(u(!0),o(h,null,v(Ct.value,e=>(u(),o("div",{key:e.month,class:"flex-1 flex flex-col items-center"},[i("div",Ft,[i("div",{class:"w-6 bg-gray-300 dark:bg-gray-600 rounded-t transition-all",style:y({height:Ct.value.length>0&&Math.max(...Ct.value.map(e=>e.plan))>0?e.plan/Math.max(...Ct.value.map(e=>e.plan))*100+"%":"0%"}),title:"Reja: "+Qt(e.plan)},null,12,Mt),i("div",{class:m(["w-6 rounded-t transition-all",e.completion_percent>=100?"bg-green-500":"bg-blue-500"]),style:y({height:Ct.value.length>0&&Math.max(...Ct.value.map(e=>e.plan))>0?e.fact/Math.max(...Ct.value.map(e=>e.plan))*100+"%":"0%"}),title:"Fakt: "+Qt(e.fact)},null,14,qt)]),i("div",Dt,[i("p",Rt,p(e.completion_percent?.toFixed(0))+"% ",1),i("p",Bt,p(e.month_name?.slice(0,3)),1)])]))),128))]),t[21]||(t[21]=i("div",{class:"flex justify-center gap-6 mt-4"},[i("div",{class:"flex items-center"},[i("div",{class:"w-4 h-4 bg-gray-300 dark:bg-gray-600 rounded mr-2"}),i("span",{class:"text-sm text-gray-500"},"Reja")]),i("div",{class:"flex items-center"},[i("div",{class:"w-4 h-4 bg-blue-500 rounded mr-2"}),i("span",{class:"text-sm text-gray-500"},"Fakt")]),i("div",{class:"flex items-center"},[i("div",{class:"w-4 h-4 bg-green-500 rounded mr-2"}),i("span",{class:"text-sm text-gray-500"},"100%+ bajarildi")])],-1))])])):At.value?c("",!0):(u(),o("div",St,[d(n(M),{class:"w-16 h-16 mx-auto text-gray-400 mb-4"}),t[23]||(t[23]=i("h3",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-2"}," Ma'lumot topilmadi ",-1)),t[24]||(t[24]=i("p",{class:"text-gray-500 mb-6"}," Ushbu davr uchun sotuv ma'lumotlari mavjud emas. Avval sotuv rejasini yarating. ",-1)),d(n(w),{href:"/sales/targets/create",class:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"},{default:l(()=>[...t[22]||(t[22]=[b(" Reja yaratish ",-1)])]),_:1})]))])]),_:1}))}};export{It as default};
