var t=Object.defineProperty,e=(e,s,n)=>((e,s,n)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n)(e,"symbol"!=typeof s?s+"":s,n);const s={"#":{pattern:/[0-9]/},"@":{pattern:/[a-zA-Z]/},"*":{pattern:/[a-zA-Z0-9]/}},n=(t,e,s)=>t.replaceAll(e,"").replace(s,".").replace("..",".").replace(/[^.\d]/g,""),a=(t,e,s)=>{var n;return new Intl.NumberFormat((null==(n=s.number)?void 0:n.locale)??"en",{minimumFractionDigits:t,maximumFractionDigits:e,roundingMode:"trunc"})},r=t=>JSON.parse(t.replaceAll("'",'"')),i=(t,e={})=>{const s={...e};null!=t.dataset.maska&&""!==t.dataset.maska&&(s.mask=l(t.dataset.maska)),null!=t.dataset.maskaEager&&(s.eager=o(t.dataset.maskaEager)),null!=t.dataset.maskaReversed&&(s.reversed=o(t.dataset.maskaReversed)),null!=t.dataset.maskaTokensReplace&&(s.tokensReplace=o(t.dataset.maskaTokensReplace)),null!=t.dataset.maskaTokens&&(s.tokens=u(t.dataset.maskaTokens));const n={};return null!=t.dataset.maskaNumberLocale&&(n.locale=t.dataset.maskaNumberLocale),null!=t.dataset.maskaNumberFraction&&(n.fraction=parseInt(t.dataset.maskaNumberFraction)),null!=t.dataset.maskaNumberUnsigned&&(n.unsigned=o(t.dataset.maskaNumberUnsigned)),(null!=t.dataset.maskaNumber||Object.values(n).length>0)&&(s.number=n),s},o=t=>""===t||!!JSON.parse(t),l=t=>t.startsWith("[")&&t.endsWith("]")?r(t):t,u=t=>{if(t.startsWith("{")&&t.endsWith("}"))return r(t);const e={};return t.split("|").forEach(t=>{const s=t.split(":");e[s[0]]={pattern:p()?new RegExp(s[1],"u"):new RegExp(s[1]),optional:"optional"===s[2],multiple:"multiple"===s[2],repeated:"repeated"===s[2]}}),e},p=()=>{try{return new RegExp("\\p{L}","u"),!0}catch{return!1}};class c{constructor(t={}){e(this,"opts",{}),e(this,"memo",new Map);const n={...t};if(null!=n.tokens){n.tokens=n.tokensReplace?{...n.tokens}:{...s,...n.tokens};for(const t of Object.values(n.tokens))"string"==typeof t.pattern&&(t.pattern=p()?new RegExp(t.pattern,"u"):new RegExp(t.pattern))}else n.tokens=s;Array.isArray(n.mask)&&(n.mask.length>1?n.mask=[...n.mask].sort((t,e)=>t.length-e.length):n.mask=n.mask[0]??""),""===n.mask&&(n.mask=null),this.opts=n}masked(t){return this.process(String(t),this.findMask(String(t)))}unmasked(t){return this.process(String(t),this.findMask(String(t)),!1)}isEager(){return!0===this.opts.eager}isReversed(){return!0===this.opts.reversed}completed(t){const e=this.findMask(String(t));if(null==this.opts.mask||null==e)return!1;const s=this.process(String(t),e).length;return"string"==typeof this.opts.mask?s>=this.opts.mask.length:s>=e.length}findMask(t){const e=this.opts.mask;if(null==e)return null;if("string"==typeof e)return e;if("function"==typeof e)return e(t);const s=this.process(t,e.slice(-1).pop()??"",!1);return e.find(e=>this.process(t,e,!1).length>=s.length)??""}escapeMask(t){const e=[],s=[];return t.split("").forEach((n,a)=>{"!"===n&&"!"!==t[a-1]?s.push(a-s.length):e.push(n)}),{mask:e.join(""),escaped:s}}process(t,e,s=!0){if(null!=this.opts.number)return((t,e=!0,s)=>{var r,i,o,l;const u=!0!==(null==(r=s.number)?void 0:r.unsigned)&&t.startsWith("-")?"-":"",p=(null==(i=s.number)?void 0:i.fraction)??0;let c=a(0,p,s);const h=c.formatToParts(1000.12),m=(null==(o=h.find(t=>"group"===t.type))?void 0:o.value)??" ",d=(null==(l=h.find(t=>"decimal"===t.type))?void 0:l.value)??".",k=n(t,m,d);if(Number.isNaN(parseFloat(k)))return u;const g=k.split(".");if(null!=g[1]&&g[1].length>=1){const t=g[1].length<=p?g[1].length:p;c=a(t,p,s)}let f=c.format(parseFloat(k));return e?p>0&&k.endsWith(".")&&!k.slice(0,-1).includes(".")&&(f+=d):f=n(f,m,d),u+f})(t,s,this.opts);if(null==e)return t;const r=`v=${t},mr=${e},m=${s?1:0}`;if(this.memo.has(r))return this.memo.get(r);const{mask:i,escaped:o}=this.escapeMask(e),l=[],u=null!=this.opts.tokens?this.opts.tokens:{},p=this.isReversed()?-1:1,c=this.isReversed()?"unshift":"push",h=this.isReversed()?0:i.length-1,m=this.isReversed()?()=>f>-1&&v>-1:()=>f<i.length&&v<t.length,d=t=>!this.isReversed()&&t<=h||this.isReversed()&&t>=h;let k,g=-1,f=this.isReversed()?i.length-1:0,v=this.isReversed()?t.length-1:0,b=!1;for(;m();){const e=i.charAt(f),n=u[e],a=null!=(null==n?void 0:n.transform)?n.transform(t.charAt(v)):t.charAt(v);if(o.includes(f)||null==n?(s&&!this.isEager()&&l[c](e),a!==e||this.isEager()?k=e:v+=p,this.isEager()||(f+=p)):(null!=a.match(n.pattern)?(l[c](a),n.repeated?(-1===g?g=f:f===h&&f!==g&&(f=g-p),h===g&&(f-=p)):n.multiple&&(b=!0,f-=p),f+=p):n.multiple?b&&(f+=p,v-=p,b=!1):a===k?k=void 0:n.optional&&(f+=p,v-=p),v+=p),this.isEager())for(;d(f)&&(null==u[i.charAt(f)]||o.includes(f));){if(s){if(l[c](i.charAt(f)),t.charAt(v)===i.charAt(f)){f+=p,v+=p;continue}}else i.charAt(f)===t.charAt(v)&&(v+=p);f+=p}}return this.memo.set(r,l.join("")),this.memo.get(r)}}class h{constructor(t,s={}){e(this,"items",new Map),e(this,"eventAbortController"),e(this,"onInput",t=>{if(t instanceof CustomEvent&&"input"===t.type&&!t.isTrusted&&!t.bubbles)return;const e=t.target,s=this.items.get(e);if(void 0===s)return;const n="inputType"in t&&t.inputType.startsWith("delete"),a=s.isEager(),r=n&&a&&""===s.unmasked(e.value)?"":e.value;this.fixCursor(e,n,()=>this.setValue(e,r))}),this.options=s,this.eventAbortController=new AbortController,this.init(this.getInputs(t))}update(t={}){this.options={...t},this.init(Array.from(this.items.keys()))}updateValue(t){var e;""!==t.value&&t.value!==(null==(e=this.processInput(t))?void 0:e.masked)&&this.setValue(t,t.value)}destroy(){this.eventAbortController.abort(),this.items.clear()}init(t){const e=this.getOptions(this.options);for(const s of t){if(!this.items.has(s)){const{signal:t}=this.eventAbortController;s.addEventListener("input",this.onInput,{capture:!0,signal:t})}const t=new c(i(s,e));this.items.set(s,t),queueMicrotask(()=>this.updateValue(s)),null===s.selectionStart&&t.isEager()}}getInputs(t){return"string"==typeof t?Array.from(document.querySelectorAll(t)):"length"in t?Array.from(t):[t]}getOptions(t){const{onMaska:e,preProcess:s,postProcess:n,...a}=t;return a}fixCursor(t,e,s){var n,a;const r=t.selectionStart,i=t.value;if(s(),null===r||r===i.length&&!e)return;const o=t.value,l=i.slice(0,r),u=o.slice(0,r),p=null==(n=this.processInput(t,l))?void 0:n.unmasked,c=null==(a=this.processInput(t,u))?void 0:a.unmasked;if(void 0===p||void 0===c)return;let h=r;l!==u&&(h+=e?o.length-i.length:p.length-c.length),t.setSelectionRange(h,h)}setValue(t,e){const s=this.processInput(t,e);void 0!==s&&(t.value=s.masked,null!=this.options.onMaska&&(Array.isArray(this.options.onMaska)?this.options.onMaska.forEach(t=>t(s)):this.options.onMaska(s)),t.dispatchEvent(new CustomEvent("maska",{detail:s})),t.dispatchEvent(new CustomEvent("input",{detail:s.masked})))}processInput(t,e){const s=this.items.get(t);if(void 0===s)return;let n=e??t.value;null!=this.options.preProcess&&(n=this.options.preProcess(n));let a=s.masked(n);return null!=this.options.postProcess&&(a=this.options.postProcess(a)),{masked:a,unmasked:s.unmasked(n),completed:s.completed(n)}}}const m=new WeakMap,d=(t,e)=>{var s;const n=t instanceof HTMLInputElement?t:t.querySelector("input");if(null==n||"file"===(null==n?void 0:n.type))return;let a={};if(null!=e.value&&(a="string"==typeof e.value?{mask:e.value}:{...e.value}),null!=e.arg){const t=t=>{const s=e.modifiers.unmasked?t.unmasked:e.modifiers.completed?t.completed:t.masked;((t,e)=>{if(null==t.arg||null==t.instance)return;t.instance.$.type,t.arg in t.instance&&(t.instance[t.arg]=e)})(e,s)};a.onMaska=null==a.onMaska?t:Array.isArray(a.onMaska)?[...a.onMaska,t]:[a.onMaska,t]}m.has(n)?null==(s=m.get(n))||s.update(a):m.set(n,new h(n,a))};export{d as k};
