import{r as e,b as t,v as a,x as s,y as r,z as l,A as o,D as i,L as n,C as g,E as c,F as d,G as u,B as p,H as m,M as y,Q as x,I as b,K as v,J as h,R as f}from"./chunk-7Urb0kxg.js";import{h as _,r as k}from"./chunk-DKkye6wf.js";import{_ as w}from"./chunk-k4W8urQJ.js";import{r as j}from"./chunk-ujXbNZhL.js";import{r as q}from"./chunk-C3XJH04c.js";import{s as C,e as S,o as O}from"./chunk-Dm-LAqtr.js";import{r as z}from"./chunk-Cwmxaszp.js";import{r as A}from"./chunk-Rl16a4N0.js";import{r as V}from"./chunk-Sfe4u6kO.js";import{r as B}from"./chunk-DncpFozA.js";import{r as T}from"./chunk-DmzgERdS.js";import{r as U}from"./chunk-DUcDuGHI.js";import{r as $}from"./chunk-BAC6lhkp.js";import{a as P}from"./chunk-9PkX4iPz.js";import{S as Q,Y as F,h as H,G as L,V as Y}from"./chunk-BWNgHGSI.js";import"./chunk-DmCyVuil.js";import"./chunk-Be6I8nOg.js";import"./chunk-DpGbuIFK.js";import"./chunk-78n7fhob.js";import"./app-DFslr8vl.js";import"./chunk-Di7Oc7TS.js";import"./chunk-Dg8ilgYs.js";import"./chunk-C1ExV0Y3.js";import"./chunk-D2XW56yD.js";import"./chunk-DS-Zp4Qb.js";import"./chunk-BugzYCIx.js";import"./chunk-ab1b1Fp4.js";import"./chunk-DhwSyUm1.js";import"./chunk-DOBCiesv.js";import"./chunk-YGW1Cp7-.js";import"./chunk-afst19KZ.js";import"./chunk-D4tA7yBb.js";const D={class:"py-6"},E={class:"w-full px-4 sm:px-6 lg:px-8"},G={class:"flex items-center justify-between mb-6"},I={class:"flex gap-3"},J={class:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-6"},K={class:"flex items-center gap-2 mb-2"},M={class:"text-sm text-gray-400"},R={class:"text-2xl font-bold text-white"},N={key:0,class:"bg-orange-500/10 border border-orange-500/30 rounded-xl p-4 mb-6"},W={class:"flex items-start gap-3"},X={class:"space-y-2"},Z={class:"text-gray-300"},ee={class:"bg-gray-800 rounded-xl overflow-hidden"},te={key:0,class:"p-8 text-center text-gray-500"},ae={key:1,class:"divide-y divide-gray-700"},se={class:"w-10 h-10 rounded-lg bg-gray-700 flex items-center justify-center"},re={class:"flex-1 min-w-0"},le={class:"flex items-center gap-2 mb-1"},oe={class:"font-medium text-white"},ie={class:"text-sm text-gray-400"},ne={key:0},ge={key:1},ce={class:"text-sm text-gray-500"},de={class:"flex items-center gap-2"},ue=["onClick"],pe=["onClick"],me={class:"mt-6 bg-gray-800 rounded-xl p-6"},ye={class:"flex items-center gap-2 overflow-x-auto pb-4"},xe={class:"text-sm text-white font-medium"},be={class:"text-xs text-gray-400 mt-1"},ve={class:"fixed inset-0 overflow-y-auto"},he={class:"flex min-h-full items-center justify-center p-4"},fe={class:"border-b border-gray-700 px-6 py-4"},_e={class:"flex items-center justify-between"},ke={class:"w-8 h-8 rounded-lg bg-emerald-500/20 flex items-center justify-center"},we={class:"relative"},je=["value"],qe={key:0,class:"mt-1.5 text-xs text-gray-500"},Ce={key:0,class:"bg-gray-700/30 rounded-xl p-4"},Se={class:"space-y-3"},Oe={class:"text-sm text-gray-400 min-w-[80px]"},ze=["onUpdate:modelValue","placeholder"],Ae={class:"grid grid-cols-2 gap-4"},Ve={class:"relative"},Be=["value"],Te={class:"relative"},Ue=["value"],$e={key:1,class:"flex items-center justify-center gap-3 py-2"},Pe={class:"px-3 py-1.5 rounded-lg bg-gray-700 text-sm text-gray-300"},Qe={key:0,class:"px-3 py-1.5 rounded-lg bg-emerald-500/20 text-sm text-emerald-400 font-medium"},Fe={key:1,class:"px-3 py-1.5 rounded-lg bg-gray-700 text-sm text-gray-500"},He={class:"space-y-3"},Le={class:"flex items-center gap-3 p-3 rounded-xl bg-gray-700/30 hover:bg-gray-700/50 cursor-pointer transition group"},Ye={class:"flex items-center gap-3 p-3 rounded-xl bg-gray-700/30 hover:bg-gray-700/50 cursor-pointer transition group"},De={class:"block text-sm font-medium text-gray-300 mb-2"},Ee={class:"text-gray-500 font-normal ml-1"},Ge={class:"border-t border-gray-700 px-6 py-4 bg-gray-800/50 flex items-center justify-end gap-3"},Ie=["disabled"],Je={__name:"Index",props:{rules:Array,stages:Array,triggerTypes:Object,bottlenecks:Array,pipelineStats:Object},setup(Je){const Ke=Je,Me=e(!1),Re=e({trigger_type:"",trigger_conditions:{},from_stage_slug:"",to_stage_slug:"",only_if_current_stage:!1,prevent_backward:!0,priority:0}),Ne=t(()=>Re.value.trigger_type&&Ke.triggerTypes[Re.value.trigger_type]?.conditions||[]),We=e=>{const t=Ke.pipelineStats.stages.find(t=>t.slug===e);return t?.count||0},Xe=()=>{const e=Object.fromEntries(Object.entries(Re.value.trigger_conditions).filter(([e,t])=>t));k.post(route("sales-head.pipeline-automation.store"),{...Re.value,trigger_conditions:Object.keys(e).length?e:null},{preserveScroll:!0,onSuccess:()=>{Me.value=!1,Re.value={trigger_type:"",trigger_conditions:{},from_stage_slug:"",to_stage_slug:"",only_if_current_stage:!1,prevent_backward:!0,priority:0}}})},Ze=()=>{confirm("Barcha qoidalar o'chirilib, standart qoidalar tiklanadi. Davom etasizmi?")&&k.post(route("sales-head.pipeline-automation.reset"),{},{preserveScroll:!0})};return(e,t)=>(c(),a(w,{title:"Pipeline Avtomatizatsiya"},{default:s(()=>[r(o(_),{title:"Pipeline Avtomatizatsiya"}),l("div",D,[l("div",E,[l("div",G,[t[12]||(t[12]=l("div",null,[l("h1",{class:"text-2xl font-bold text-white"},"Pipeline Avtomatizatsiya"),l("p",{class:"text-gray-400 mt-1"},"Lead bosqichlarini avtomatik o'zgartirish qoidalari")],-1)),l("div",I,[l("button",{onClick:Ze,class:"px-4 py-2 text-sm text-gray-300 bg-gray-700 hover:bg-gray-600 rounded-lg transition"}," Standartga qaytarish "),l("button",{onClick:t[0]||(t[0]=e=>Me.value=!0),class:"px-4 py-2 text-sm text-white bg-emerald-600 hover:bg-emerald-700 rounded-lg transition flex items-center gap-2"},[r(o(j),{class:"w-4 h-4"}),t[11]||(t[11]=g(" Qoida qo'shish ",-1))])])]),l("div",J,[(c(!0),i(d,null,u(Je.pipelineStats.stages,e=>(c(),i("div",{key:e.slug,class:"bg-gray-800 rounded-lg p-4"},[l("div",K,[l("div",{class:p(["w-3 h-3 rounded-full",`bg-${e.color}-500`])},null,2),l("span",M,m(e.name),1)]),l("p",R,m(e.count),1)]))),128))]),Je.bottlenecks.length>0?(c(),i("div",N,[l("div",W,[r(o(q),{class:"w-6 h-6 text-orange-400 flex-shrink-0 mt-0.5"}),l("div",null,[t[14]||(t[14]=l("h3",{class:"font-semibold text-orange-400 mb-2"},"Bottleneck lar aniqlandi",-1)),l("div",X,[(c(!0),i(d,null,u(Je.bottlenecks,e=>(c(),i("div",{key:e.stage_slug,class:"flex items-center gap-3 text-sm"},[l("span",{class:p(["px-2 py-0.5 rounded text-xs font-medium","critical"===e.severity?"bg-red-500/20 text-red-400":"high"===e.severity?"bg-orange-500/20 text-orange-400":"bg-yellow-500/20 text-yellow-400"])},m(e.severity),3),l("span",Z,[l("strong",null,m(e.lead_count),1),g(' ta lead "'+m(e.stage_name)+"\" da o'rtacha ",1),l("strong",null,m(e.avg_days),1),t[13]||(t[13]=g(" kun turibdi ",-1))])]))),128))])])])])):n("",!0),l("div",ee,[t[16]||(t[16]=l("div",{class:"p-4 border-b border-gray-700"},[l("h2",{class:"text-lg font-semibold text-white"},"Avtomatlashtirish qoidalari")],-1)),0===Je.rules.length?(c(),i("div",te,[r(o(C),{class:"w-12 h-12 mx-auto mb-3 opacity-50"}),t[15]||(t[15]=l("p",null,"Hozircha qoidalar yo'q",-1)),l("button",{onClick:t[1]||(t[1]=e=>Me.value=!0),class:"mt-3 text-emerald-400 hover:text-emerald-300"}," Birinchi qoidani qo'shing ")])):(c(),i("div",ae,[(c(!0),i(d,null,u(Je.rules,e=>{return c(),i("div",{key:e.id,class:p(["p-4 flex items-center gap-4",!e.is_active&&"opacity-50"])},[l("div",se,[(c(),a(y((s=e.trigger_type,{call_log_created:P,task_created:$,task_completed:U,message_sent:T,lead_lost:B,sale_created:V}[s]||C)),{class:"w-5 h-5 text-gray-400"}))]),l("div",re,[l("div",le,[l("span",oe,m(e.trigger_info.name),1),r(o(z),{class:"w-4 h-4 text-gray-500"}),l("span",{class:p(["px-2 py-0.5 rounded text-xs font-medium",`bg-${e.to_stage_color}-500/20 text-${e.to_stage_color}-400`])},m(e.to_stage_name),3)]),l("div",ie,[e.from_stage_slug?(c(),i("span",ne,' Faqat "'+m(e.from_stage_name)+'" dan ',1)):n("",!0),e.trigger_conditions&&Object.keys(e.trigger_conditions).length?(c(),i("span",ge," â€¢ Shart: "+m((t=e.trigger_conditions,Object.entries(t).map(([e,t])=>`${e}=${t}`).join(", "))),1)):n("",!0)])]),l("div",ce," Prioritet: "+m(e.priority),1),l("div",de,[l("button",{onClick:t=>(e=>{k.post(route("sales-head.pipeline-automation.toggle",e.id),{},{preserveScroll:!0})})(e),class:p(["px-3 py-1.5 text-xs rounded-lg transition",e.is_active?"bg-emerald-500/20 text-emerald-400 hover:bg-emerald-500/30":"bg-gray-700 text-gray-400 hover:bg-gray-600"])},m(e.is_active?"Faol":"O'chiq"),11,ue),l("button",{onClick:t=>(e=>{confirm("Bu qoidani o'chirmoqchimisiz?")&&k.delete(route("sales-head.pipeline-automation.destroy",e.id),{preserveScroll:!0})})(e),class:"p-1.5 text-red-400 hover:bg-red-500/20 rounded-lg transition"},[r(o(S),{class:"w-4 h-4"})],8,pe)])],2);var t,s}),128))]))]),l("div",me,[t[17]||(t[17]=l("h2",{class:"text-lg font-semibold text-white mb-4"},"Pipeline oqimi",-1)),l("div",ye,[(c(!0),i(d,null,u(Je.stages,(e,t)=>(c(),i(d,{key:e.slug},[l("div",{class:p(["flex-shrink-0 px-4 py-3 rounded-lg text-center min-w-[120px]",e.is_won?"bg-green-500/20 border border-green-500/30":e.is_lost?"bg-red-500/20 border border-red-500/30":"bg-gray-700"])},[l("div",{class:p(["w-3 h-3 rounded-full mx-auto mb-2",`bg-${e.color}-500`])},null,2),l("span",xe,m(e.name),1),l("div",be,m(We(e.slug))+" ta ",1)],2),t<Je.stages.length-1&&!e.is_won&&!e.is_lost?(c(),a(o(z),{key:0,class:"w-5 h-5 text-gray-500 flex-shrink-0"})):n("",!0)],64))),128))])])])]),r(o(Q),{appear:"",show:Me.value,as:"template"},{default:s(()=>[r(o(F),{as:"div",class:"relative z-50",onClose:t[10]||(t[10]=e=>Me.value=!1)},{default:s(()=>[r(o(H),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:s(()=>[...t[18]||(t[18]=[l("div",{class:"fixed inset-0 bg-black/60 backdrop-blur-sm"},null,-1)])]),_:1}),l("div",ve,[l("div",he,[r(o(H),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:s(()=>[r(o(L),{class:"w-full max-w-lg transform overflow-hidden rounded-2xl bg-gray-800 shadow-2xl transition-all"},{default:s(()=>[l("div",fe,[l("div",_e,[r(o(Y),{class:"text-lg font-semibold text-white flex items-center gap-2"},{default:s(()=>[l("div",ke,[r(o(j),{class:"w-5 h-5 text-emerald-400"})]),t[19]||(t[19]=g(" Yangi qoida qo'shish ",-1))]),_:1}),l("button",{onClick:t[2]||(t[2]=e=>Me.value=!1),class:"p-1.5 rounded-lg text-gray-400 hover:text-white hover:bg-gray-700 transition"},[r(o(A),{class:"w-5 h-5"})])])]),l("form",{onSubmit:x(Xe,["prevent"]),class:"p-6 space-y-5"},[l("div",null,[t[21]||(t[21]=l("label",{class:"block text-sm font-medium text-gray-300 mb-2"},[g(" Trigger hodisasi "),l("span",{class:"text-red-400"},"*")],-1)),l("div",we,[b(l("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>Re.value.trigger_type=e),class:"w-full appearance-none bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition cursor-pointer"},[t[20]||(t[20]=l("option",{value:"",class:"bg-gray-800"},"Tanlang...",-1)),(c(!0),i(d,null,u(Je.triggerTypes,(e,t)=>(c(),i("option",{key:t,value:t,class:"bg-gray-800"},m(e.name),9,je))),128))],512),[[v,Re.value.trigger_type]]),r(o(O),{class:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"})]),Re.value.trigger_type&&Je.triggerTypes[Re.value.trigger_type]?(c(),i("p",qe,m(Je.triggerTypes[Re.value.trigger_type].description||"Bu hodisa sodir bo'lganda qoida ishga tushadi"),1)):n("",!0)]),Re.value.trigger_type&&Ne.value.length>0?(c(),i("div",Ce,[t[22]||(t[22]=l("label",{class:"block text-sm font-medium text-gray-300 mb-3"},[g(" Qo'shimcha shartlar "),l("span",{class:"text-gray-500 font-normal"},"(ixtiyoriy)")],-1)),l("div",Se,[(c(!0),i(d,null,u(Ne.value,e=>(c(),i("div",{key:e,class:"flex items-center gap-3"},[l("span",Oe,m(e),1),b(l("input",{"onUpdate:modelValue":t=>Re.value.trigger_conditions[e]=t,type:"text",class:"flex-1 bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-white text-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition",placeholder:`${e} qiymati`},null,8,ze),[[h,Re.value.trigger_conditions[e]]])]))),128))])])):n("",!0),l("div",Ae,[l("div",null,[t[24]||(t[24]=l("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Qaysi bosqichdan ",-1)),l("div",Ve,[b(l("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>Re.value.from_stage_slug=e),class:"w-full appearance-none bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition cursor-pointer text-sm"},[t[23]||(t[23]=l("option",{value:"",class:"bg-gray-800"},"Har qanday",-1)),(c(!0),i(d,null,u(Je.stages,e=>(c(),i("option",{key:e.slug,value:e.slug,class:"bg-gray-800"},m(e.name),9,Be))),128))],512),[[v,Re.value.from_stage_slug]]),r(o(O),{class:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"})])]),l("div",null,[t[26]||(t[26]=l("label",{class:"block text-sm font-medium text-gray-300 mb-2"},[g(" Qaysi bosqichga "),l("span",{class:"text-red-400"},"*")],-1)),l("div",Te,[b(l("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>Re.value.to_stage_slug=e),required:"",class:"w-full appearance-none bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition cursor-pointer text-sm"},[t[25]||(t[25]=l("option",{value:"",class:"bg-gray-800"},"Tanlang...",-1)),(c(!0),i(d,null,u(Je.stages,e=>(c(),i("option",{key:e.slug,value:e.slug,class:"bg-gray-800"},m(e.name),9,Ue))),128))],512),[[v,Re.value.to_stage_slug]]),r(o(O),{class:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"})])])]),Re.value.from_stage_slug||Re.value.to_stage_slug?(c(),i("div",$e,[l("span",Pe,m(Re.value.from_stage_slug?Je.stages.find(e=>e.slug===Re.value.from_stage_slug)?.name:"Har qanday"),1),r(o(z),{class:"w-5 h-5 text-emerald-400"}),Re.value.to_stage_slug?(c(),i("span",Qe,m(Je.stages.find(e=>e.slug===Re.value.to_stage_slug)?.name),1)):(c(),i("span",Fe," ? "))])):n("",!0),l("div",He,[l("label",Le,[b(l("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>Re.value.only_if_current_stage=e),type:"checkbox",class:"w-5 h-5 rounded bg-gray-700 border-gray-600 text-emerald-500 focus:ring-emerald-500 focus:ring-offset-gray-800"},null,512),[[f,Re.value.only_if_current_stage]]),t[27]||(t[27]=l("div",null,[l("span",{class:"text-sm text-white group-hover:text-emerald-400 transition"},"Faqat tanlangan bosqichdan"),l("p",{class:"text-xs text-gray-500 mt-0.5"},"Lead aynan shu bosqichda bo'lgandagina ishlaydi")],-1))]),l("label",Ye,[b(l("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>Re.value.prevent_backward=e),type:"checkbox",class:"w-5 h-5 rounded bg-gray-700 border-gray-600 text-emerald-500 focus:ring-emerald-500 focus:ring-offset-gray-800"},null,512),[[f,Re.value.prevent_backward]]),t[28]||(t[28]=l("div",null,[l("span",{class:"text-sm text-white group-hover:text-emerald-400 transition"},"Orqaga o'tishni oldini ol"),l("p",{class:"text-xs text-gray-500 mt-0.5"},"Lead orqaga qaytmasligini ta'minlaydi")],-1))])]),l("div",null,[l("label",De,[t[29]||(t[29]=g(" Prioritet ",-1)),l("span",Ee,"("+m(Re.value.priority)+")",1)]),b(l("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>Re.value.priority=e),type:"range",min:"0",max:"100",class:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-emerald-500"},null,512),[[h,Re.value.priority,void 0,{number:!0}]]),t[30]||(t[30]=l("div",{class:"flex justify-between text-xs text-gray-500 mt-1"},[l("span",null,"Past"),l("span",null,"O'rta"),l("span",null,"Yuqori")],-1))])],32),l("div",Ge,[l("button",{type:"button",onClick:t[9]||(t[9]=e=>Me.value=!1),class:"px-4 py-2.5 text-sm font-medium text-gray-300 hover:text-white transition"}," Bekor qilish "),l("button",{onClick:Xe,disabled:!Re.value.trigger_type||!Re.value.to_stage_slug,class:"px-5 py-2.5 text-sm font-medium bg-emerald-600 hover:bg-emerald-500 text-white rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition flex items-center gap-2"},[r(o(j),{class:"w-4 h-4"}),t[31]||(t[31]=g(" Qoida qo'shish ",-1))],8,Ie)])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])]),_:1}))}};export{Je as default};
