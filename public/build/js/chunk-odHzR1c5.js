import{b as e,r as a,w as t,v as r,D as l,L as o,x as s,C as d,I as n,y as i,T as u,z as c,A as p,F as g,J as y,K as b,H as m,E as k,O as v,G as x,M as f}from"./chunk-CpmtkKLp.js";import{u as h,r as _,i as w}from"./app-C-ZlocOh.js";import{a as j}from"./chunk-C9nNyFhC.js";import{e as C,a as D}from"./chunk-D7SyfRoT.js";import{r as T}from"./chunk-CBAnz7Zv.js";import{r as U}from"./chunk-eMHYSAeQ.js";import{a as O}from"./chunk-De_qwhex.js";import{r as S}from"./chunk-DmrwHl-6.js";const V={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},z={key:0,class:"relative bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-lg z-10 overflow-hidden"},$={class:"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700"},A={class:"text-lg font-semibold text-gray-900 dark:text-white"},I={class:"p-6 space-y-5"},M={key:0,class:"flex items-center gap-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-xl"},B={class:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold text-sm"},E={class:"text-sm font-medium text-gray-900 dark:text-white"},F={class:"text-xs text-gray-500 dark:text-gray-400"},G={key:1},H={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},J={value:null},K=["value"],L={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},q={class:"grid grid-cols-3 gap-2"},N=["onClick"],P={class:"text-xs font-medium text-gray-700 dark:text-gray-300"},Q={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},R=["placeholder"],W={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},X={class:"flex gap-2 mb-2"},Y=["onClick"],Z={class:"flex gap-3"},ee={class:"flex-1"},ae={class:"w-28"},te={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},re={class:"flex gap-2"},le=["onClick"],oe={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},se=["placeholder"],de={key:2,class:"text-sm text-red-500"},ne={class:"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50"},ie=["disabled"],ue={__name:"TaskModal",props:{show:{type:Boolean,default:!1},lead:{type:Object,default:null},task:{type:Object,default:null},leads:{type:Array,default:()=>[]},panelType:{type:String,default:"business",validator:e=>["business","saleshead"].includes(e)}},emits:["close","saved"],setup(ue,{emit:ce}){const{t:pe}=h(),ge=ue,ye=ce,be=e(()=>"saleshead"===ge.panelType?"sales-head":"business"),me=a({title:"",description:"",type:"task",priority:"medium",due_date:"",due_time:"10:00",lead_id:null}),ke=a(!1),ve=a(""),xe=e(()=>[{value:"call",label:pe("components.task.type_call"),icon:j,color:"text-green-500"},{value:"meeting",label:pe("components.task.type_meeting"),icon:C,color:"text-blue-500"},{value:"email",label:pe("components.task.type_email"),icon:T,color:"text-purple-500"},{value:"task",label:pe("components.task.type_task"),icon:U,color:"text-orange-500"},{value:"follow_up",label:pe("components.task.type_follow_up"),icon:D,color:"text-indigo-500"},{value:"other",label:pe("components.task.type_other"),icon:O,color:"text-gray-500"}]),fe=e(()=>[{value:"low",label:pe("components.task.priority_low"),color:"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"},{value:"medium",label:pe("components.task.priority_medium"),color:"bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400"},{value:"high",label:pe("components.task.priority_high"),color:"bg-orange-100 text-orange-600 dark:bg-orange-900/30 dark:text-orange-400"},{value:"urgent",label:pe("components.task.priority_urgent"),color:"bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400"}]),he=e(()=>[{label:pe("components.task.today"),days:0},{label:pe("components.task.tomorrow"),days:1},{label:pe("components.task.in_3_days"),days:3},{label:pe("components.task.in_week"),days:7}]);t(()=>ge.show,e=>{if(e){if(ge.task)me.value={title:ge.task.title,description:ge.task.description||"",type:ge.task.type,priority:ge.task.priority,due_date:ge.task.due_date?.split(" ")[0]||"",due_time:ge.task.due_date?.split(" ")[1]?.slice(0,5)||"10:00",lead_id:ge.task.lead_id};else{const e=new Date;e.setDate(e.getDate()+1),me.value={title:"",description:"",type:"call",priority:"medium",due_date:e.toISOString().split("T")[0],due_time:"10:00",lead_id:ge.lead?.id||null}}ve.value=""}});const _e=e(()=>me.value.title.trim()&&me.value.due_date),we=async()=>{if(_e.value&&!ke.value){ke.value=!0,ve.value="";try{await _();const e={title:me.value.title,description:me.value.description||null,type:me.value.type,priority:me.value.priority,due_date:`${me.value.due_date} ${me.value.due_time}:00`,lead_id:me.value.lead_id},a=ge.task?route(`${be.value}.tasks.update`,ge.task.id):route(`${be.value}.tasks.store`),t=ge.task?await window.axios.put(a,e):await window.axios.post(a,e);t.data.success?(ye("saved",t.data.task),ye("close")):ve.value=t.data.error||t.data.message||pe("common.error_occurred")}catch(e){if(w(e))return ve.value=pe("common.session_expired"),void(await _());e.response?.data?.error?ve.value=e.response.data.error:e.response?.data?.message?ve.value=e.response.data.message:ve.value=pe("common.network_error")}finally{ke.value=!1}}},je=()=>{ye("close")};return(e,a)=>(l(),r(f,{to:"body"},[o(u,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:s(()=>[ue.show?(l(),d("div",V,[i("div",{class:"fixed inset-0 bg-black/50",onClick:je}),o(u,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:s(()=>[ue.show?(l(),d("div",z,[i("div",$,[i("h3",A,c(ue.task?p(pe)("components.task.edit_title"):p(pe)("components.task.new_title")),1),i("button",{onClick:je,class:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"},[o(p(S),{class:"w-5 h-5"})])]),i("div",I,[ue.lead?(l(),d("div",M,[i("div",B,c(ue.lead.name?.charAt(0)?.toUpperCase()||"?"),1),i("div",null,[i("p",E,c(ue.lead.name),1),i("p",F,c(ue.lead.phone),1)])])):n("",!0),!ue.lead&&ue.leads.length>0?(l(),d("div",G,[i("label",H,c(p(pe)("components.task.lead_optional")),1),g(i("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>me.value.lead_id=e),class:"w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"},[i("option",J,c(p(pe)("components.task.no_lead")),1),(l(!0),d(y,null,b(ue.leads,e=>(l(),d("option",{key:e.id,value:e.id},c(e.name)+" - "+c(e.phone),9,K))),128))],512),[[m,me.value.lead_id]])])):n("",!0),i("div",null,[i("label",L,c(p(pe)("components.task.task_type")),1),i("div",q,[(l(!0),d(y,null,b(xe.value,e=>(l(),d("button",{key:e.value,onClick:a=>me.value.type=e.value,class:k(["flex flex-col items-center gap-1 p-3 rounded-xl border-2 transition-all",me.value.type===e.value?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"])},[(l(),r(v(e.icon),{class:k(["w-5 h-5",e.color])},null,8,["class"])),i("span",P,c(e.label),1)],10,N))),128))])]),i("div",null,[i("label",Q,c(p(pe)("components.task.title_label")),1),g(i("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>me.value.title=e),type:"text",placeholder:p(pe)("components.task.title_placeholder"),class:"w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-900 dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,8,R),[[x,me.value.title]])]),i("div",null,[i("label",W,c(p(pe)("components.task.due_date")),1),i("div",X,[(l(!0),d(y,null,b(he.value,e=>(l(),d("button",{key:e.days,onClick:a=>(e=>{const a=new Date;a.setDate(a.getDate()+e),me.value.due_date=a.toISOString().split("T")[0]})(e.days),class:"px-3 py-1.5 text-xs font-medium bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors"},c(e.label),9,Y))),128))]),i("div",Z,[i("div",ee,[g(i("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>me.value.due_date=e),type:"date",class:"w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[x,me.value.due_date]])]),i("div",ae,[g(i("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>me.value.due_time=e),type:"time",class:"w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[x,me.value.due_time]])])])]),i("div",null,[i("label",te,c(p(pe)("components.task.priority")),1),i("div",re,[(l(!0),d(y,null,b(fe.value,e=>(l(),d("button",{key:e.value,onClick:a=>me.value.priority=e.value,class:k(["flex-1 py-2 px-3 text-sm font-medium rounded-xl transition-all",me.value.priority===e.value?e.color+" ring-2 ring-offset-2 ring-blue-500":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600"])},c(e.label),11,le))),128))])]),i("div",null,[i("label",oe,c(p(pe)("components.task.description_optional")),1),g(i("textarea",{"onUpdate:modelValue":a[4]||(a[4]=e=>me.value.description=e),rows:"2",placeholder:p(pe)("components.task.description_placeholder"),class:"w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-900 dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"},null,8,se),[[x,me.value.description]])]),ve.value?(l(),d("p",de,c(ve.value),1)):n("",!0)]),i("div",ne,[i("button",{onClick:je,class:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 font-medium rounded-xl transition-colors"},c(p(pe)("common.cancel")),1),i("button",{onClick:we,disabled:!_e.value||ke.value,class:k(["px-6 py-2 font-medium rounded-xl transition-colors",_e.value&&!ke.value?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"])},c(ke.value?p(pe)("common.saving"):ue.task?p(pe)("common.save"):p(pe)("common.create")),11,ie)])])):n("",!0)]),_:1})])):n("",!0)]),_:1})]))}};export{ue as _};
