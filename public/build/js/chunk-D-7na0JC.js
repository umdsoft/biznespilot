import{d as m}from"./chunk-C1xeNfMu.js";import{a as s}from"./chunk-BYRtWSr0.js";import{r as n,b as v}from"./chunk-BcTZxe-J.js";const S=m("auth",()=>{const o=n(null),a=n(sessionStorage.getItem("auth_token")||null),r=n(JSON.parse(sessionStorage.getItem("current_business"))||null),l=v(()=>!!a.value);a.value&&(s.defaults.headers.common.Authorization=`Bearer ${a.value}`),r.value&&(s.defaults.headers.common["X-Business-ID"]=r.value.id);async function c(e){try{const t=await s.post("/api/v1/auth/register",e);return a.value=t.data.data.token,o.value=t.data.data.user,sessionStorage.setItem("auth_token",a.value),s.defaults.headers.common.Authorization=`Bearer ${a.value}`,t.data}catch(t){throw t.response?.data||t}}async function d(e){try{const t=await s.post("/api/v1/auth/login",e);return a.value=t.data.data.token,o.value=t.data.data.user,sessionStorage.setItem("auth_token",a.value),s.defaults.headers.common.Authorization=`Bearer ${a.value}`,o.value.businesses&&o.value.businesses.length>0&&i(o.value.businesses[0]),t.data}catch(t){throw t.response?.data||t}}async function u(){try{await s.post("/api/v1/auth/logout")}catch(e){console.error("Logout error:",e)}finally{o.value=null,a.value=null,r.value=null,sessionStorage.removeItem("auth_token"),sessionStorage.removeItem("current_business"),delete s.defaults.headers.common.Authorization,delete s.defaults.headers.common["X-Business-ID"]}}async function h(){try{const e=await s.get("/api/v1/auth/me");return o.value=e.data.data,e.data}catch(e){throw await u(),e}}function i(e){r.value=e,sessionStorage.setItem("current_business",JSON.stringify(e)),s.defaults.headers.common["X-Business-ID"]=e.id}return{user:o,token:a,currentBusiness:r,isAuthenticated:l,register:c,login:d,logout:u,fetchUser:h,setCurrentBusiness:i}});export{S as u};
