import{r as e,b as a,o as t,e as r,D as s,E as l,z as o,I as i,y as n,L as d,A as u,H as c,W as g,x as h,C as x,F as b,G as v,B as y,v as k,M as m}from"./chunk-7Urb0kxg.js";import{b as p,l as f,r as w,a as j}from"./chunk-DKkye6wf.js";import{r as C}from"./chunk-Be6I8nOg.js";import{r as $}from"./chunk-DUcDuGHI.js";import{r as z}from"./chunk-DpGbuIFK.js";import{r as D}from"./chunk-78n7fhob.js";import{r as W}from"./chunk-C3XJH04c.js";const _={class:"relative"},q={key:0,class:"absolute -top-1 -right-1 inline-flex items-center justify-center min-w-[18px] h-[18px] px-1 text-xs font-bold bg-red-500 text-white rounded-full animate-pulse"},L={class:"absolute right-0 mt-2 w-80 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 z-50 overflow-hidden"},M={class:"px-4 py-3 border-b border-gray-100 dark:border-gray-700 flex items-center justify-between"},A={class:"max-h-80 overflow-y-auto"},B=["onClick"],E={class:"flex items-start gap-3"},H={class:"flex-1 min-w-0"},I={class:"text-sm font-medium text-gray-900 dark:text-white truncate"},O={class:"text-xs text-gray-500 dark:text-gray-400 line-clamp-2"},F={class:"text-xs text-gray-400 dark:text-gray-500 mt-1"},G={key:1,class:"px-4 py-8 text-center"},S={key:0,class:"px-4 py-2 border-t border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50"},U={__name:"AlertDropdown",setup(U){const Z=p(),J=e(!1),K=e([]),N=e(0),P=e(!1);let Q=null;const R=a(()=>{const e=Z.url;return e.startsWith("/operator")?"/operator/alerts":e.startsWith("/sales-head")?"/sales-head/alerts":"/business/alerts"}),T=a(()=>{const e=Z.url;return e.startsWith("/operator")?"/operator/alerts/active":e.startsWith("/sales-head")?"/sales-head/alerts/active":"/business/alerts/active"}),V=()=>{J.value=!J.value,J.value&&X()},X=async()=>{try{P.value=!0;const e=await j.get(T.value);e.data&&(K.value=e.data.alerts||[],N.value=e.data.unreadCount||0)}catch(e){}finally{P.value=!1}},Y=async()=>{try{const e=R.value+"/mark-all-read";await j.post(e),N.value=0,K.value=K.value.map(e=>({...e,status:"read"}))}catch(e){}},ee=e=>{const a={urgent:"bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400",high:"bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400",medium:"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400",low:"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"};return a[e]||a.medium},ae=e=>{const a={urgent:W,high:D,medium:z,low:$};return a[e]||a.medium},te=e=>{const a=new Date(e),t=new Date-a,r=Math.floor(t/6e4),s=Math.floor(t/36e5),l=Math.floor(t/864e5);return r<1?"Hozir":r<60?`${r} daqiqa oldin`:s<24?`${s} soat oldin`:l<7?`${l} kun oldin`:a.toLocaleDateString("uz-UZ")},re=e=>{e.target.closest(".relative")||(J.value=!1)};return t(()=>{document.addEventListener("click",re),X(),Q=setInterval(()=>{J.value||X()},6e4)}),r(()=>{document.removeEventListener("click",re),Q&&clearInterval(Q)}),(e,a)=>(l(),s("div",_,[o("button",{onClick:V,class:"relative flex items-center justify-center w-10 h-10 rounded-xl border border-gray-200 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all duration-200",title:"Ogohlantirishlar"},[n(u(C),{class:"w-5 h-5 text-gray-600 dark:text-gray-400"}),N.value>0?(l(),s("span",q,c(N.value>99?"99+":N.value),1)):d("",!0)]),i(o("div",L,[o("div",M,[a[2]||(a[2]=o("h3",{class:"font-semibold text-gray-900 dark:text-white"},"Ogohlantirishlar",-1)),n(u(f),{href:R.value,class:"text-xs text-blue-600 dark:text-blue-400 hover:underline",onClick:a[0]||(a[0]=e=>J.value=!1)},{default:h(()=>[...a[1]||(a[1]=[x(" Barchasini ko'rish ",-1)])]),_:1},8,["href"])]),o("div",A,[K.value.length>0?(l(!0),s(b,{key:0},v(K.value,e=>(l(),s("div",{key:e.id,class:"px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700 border-b border-gray-100 dark:border-gray-700 last:border-0 cursor-pointer",onClick:a=>(e=>{J.value=!1,w.visit(`${R.value}/${e.id}`)})(e)},[o("div",E,[o("div",{class:y(["w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",ee(e.priority)])},[(l(),k(m(ae(e.priority)),{class:"w-4 h-4"}))],2),o("div",H,[o("p",I,c(e.title),1),o("p",O,c(e.message),1),o("p",F,c(te(e.created_at)),1)])])],8,B))),128)):(l(),s("div",G,[n(u(C),{class:"w-12 h-12 mx-auto text-gray-300 dark:text-gray-600"}),a[3]||(a[3]=o("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"}," Hozircha ogohlantirishlar yo'q ",-1))]))]),K.value.length>0?(l(),s("div",S,[o("button",{onClick:Y,class:"w-full text-center text-sm text-blue-600 dark:text-blue-400 hover:underline"}," Barchasini o'qilgan deb belgilash ")])):d("",!0)],512),[[g,J.value]])]))}};export{U as _};
