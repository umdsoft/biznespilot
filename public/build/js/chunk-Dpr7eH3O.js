import{a as L,r as f,b as q,o as U,e as G,v as h,x as m,V as J,C as s,F as a,G as x,I as D,A as k,D as d,H as r,z as u,J as Q,B as I,y as j,M as A,W as Z}from"./chunk-KPSVwAyv.js";import{b as K,a as O}from"./chunk-BVrjkT6E.js";import{B as R,s as T,k as F,_ as X}from"./chunk-C_PbB7ed.js";import{_ as Y}from"./chunk-B1Yis8U5.js";import{u as ee}from"./app-DMGwzSHW.js";const te={key:0,class:"pt-3 mt-3 border-t border-gray-200 dark:border-gray-700"},ae={key:0,class:"px-3 mb-2 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider"},se={key:1,class:"mb-2"},le={class:"px-3 mb-2 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider"},re={key:0,class:"mb-1"},oe=["onClick"],ne={class:"flex-1 text-left"},de={class:"mt-1 ml-4 pl-4 border-l-2 border-gray-200 dark:border-gray-700 space-y-1"},ue={class:"flex-1"},ce={key:0,class:"ml-auto inline-flex items-center justify-center min-w-[20px] h-5 px-1.5 text-xs font-bold bg-emerald-500 text-white rounded-full"},ie={key:1,class:"ml-auto inline-flex items-center justify-center min-w-[20px] h-5 px-1.5 text-xs font-bold bg-red-500 text-white rounded-full animate-pulse"},fe={key:2,class:"ml-auto inline-flex items-center justify-center min-w-[20px] h-5 px-1.5 text-xs font-bold bg-orange-500 text-white rounded-full"},he={key:3,class:"ml-auto inline-flex items-center justify-center min-w-[20px] h-5 px-1.5 text-xs font-bold bg-red-500 text-white rounded-full animate-pulse"},ye={__name:"SalesHeadLayout",props:{title:{type:String,default:""}},setup(M){const{t:n}=ee(),w=K(),C=R,c=L({}),N=()=>{C.navigation.forEach(e=>{e.items.forEach(l=>{if(l.children){const o=l.children.some(_=>w.url.startsWith(_.href));c[l.label]=o}})})},P=e=>{c[e]=!c[e]},V=e=>e.some(l=>w.url.startsWith(l.href)),v=f({new:0,total:0}),b=f({total:0,overdue:0}),p=f({missed:0,total:0}),y=f({unread:0,total:0}),S=f({deals:0,revenue:0});let g=null;const W=e=>e?new Intl.NumberFormat("uz-UZ").format(e)+" "+n("common.currency"):"0 "+n("common.currency"),z=q(()=>[{label:n("layout.today"),value:`${S.value.deals} ${n("layout.deals")}`,bgClass:"bg-emerald-50 dark:bg-emerald-900/30",labelClass:"text-emerald-600 dark:text-emerald-400",valueClass:"text-emerald-700 dark:text-emerald-300"},{label:n("layout.amount"),value:W(S.value.revenue),bgClass:"bg-blue-50 dark:bg-blue-900/30",labelClass:"text-blue-600 dark:text-blue-400",valueClass:"text-blue-700 dark:text-blue-300"}]),$=async()=>{try{const e=await O.get("/sales-head/api/stats");e.data&&(v.value=e.data.leads||{new:0,total:0},b.value=e.data.tasks||{total:0,overdue:0},p.value=e.data.calls||{missed:0,total:0},y.value=e.data.inbox||{unread:0,total:0},S.value=e.data.today||{deals:0,revenue:0})}catch(e){console.error("Failed to fetch stats:",e)}},E=()=>{$(),g=setInterval($,3e4)},H=()=>{g&&(clearInterval(g),g=null)},B=e=>{const l=w.url;return e.exact?l===e.href||l===e.href+"/":e.activeMatch?e.activeMatch(l):l.startsWith(e.href)};return U(()=>{N(),E()}),G(()=>{H()}),(e,l)=>(a(),h(X,{title:M.title||k(n)("layout.home"),config:k(C),"quick-stats":z.value},{notifications:m(()=>[j(Y)]),navigation:m(()=>[(a(!0),s(x,null,D(k(C).navigation,(o,_)=>(a(),s(x,{key:_},[_>0?(a(),s("div",te,[o.title?(a(),s("p",ae,r(o.title),1)):d("",!0)])):o.title?(a(),s("div",se,[u("p",le,r(o.title),1)])):d("",!0),(a(!0),s(x,null,D(o.items,t=>(a(),s(x,{key:t.href||t.label},[t.children?(a(),s("div",re,[u("button",{onClick:i=>P(t.label),class:I(["w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg transition-colors",V(t.children)?"bg-emerald-50 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-300":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700/50"])},[(a(),h(A(t.icon),{class:"w-5 h-5 mr-3"})),u("span",ne,r(t.label),1),j(k(T),{class:I(["w-4 h-4 transition-transform duration-200",c[t.label]?"rotate-180":""])},null,8,["class"])],10,oe),Q(u("div",de,[(a(!0),s(x,null,D(t.children,i=>(a(),h(F,{key:i.href,href:i.href,active:B(i),class:"!py-1.5 !text-sm"},{default:m(()=>[u("span",null,r(i.label),1)]),_:2},1032,["href","active"]))),128))],512),[[Z,c[t.label]]])])):(a(),h(F,{key:1,href:t.href,active:B(t)},{default:m(()=>[(a(),h(A(t.icon),{class:"w-5 h-5 mr-3"})),u("span",ue,r(t.label),1),t.href==="/sales-head/leads"&&v.value.new>0?(a(),s("span",ce,r(v.value.new>99?"99+":v.value.new),1)):d("",!0),t.href==="/sales-head/tasks"&&b.value.overdue>0?(a(),s("span",ie,r(b.value.overdue>99?"99+":b.value.overdue),1)):d("",!0),t.href==="/sales-head/calls"&&p.value.missed>0?(a(),s("span",fe,r(p.value.missed>99?"99+":p.value.missed),1)):d("",!0),t.href==="/sales-head/inbox"&&y.value.unread>0?(a(),s("span",he,r(y.value.unread>99?"99+":y.value.unread),1)):d("",!0)]),_:2},1032,["href","active"]))],64))),128))],64))),128))]),default:m(()=>[J(e.$slots,"default")]),_:3},8,["title","config","quick-stats"]))}};export{ye as _};
