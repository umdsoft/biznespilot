import{b as p,r as C,w as E,v as V,E as n,y as $,x as S,D as u,L as m,z as t,T as j,H as s,A as l,I as b,F as k,G as v,K as F,B as x,M as L,J as f,P as N}from"./chunk-BcTZxe-J.js";import{u as P,r as B,i as G}from"./app-DWC75jbx.js";import{a as H}from"./chunk-CklLzvQL.js";import{f as J,b as K}from"./chunk-CYarSvys.js";import{r as Q}from"./chunk-zLGxu1Jg.js";import{r as R}from"./chunk-Rs1WNzbn.js";import{a as W}from"./chunk-_yYzsx_i.js";import{r as X}from"./chunk-BqueMrU7.js";const Y={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},Z={key:0,class:"relative bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-lg z-10 overflow-hidden"},q={class:"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700"},ee={class:"text-lg font-semibold text-gray-900 dark:text-white"},te={class:"p-6 space-y-5"},ae={key:0,class:"flex items-center gap-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-xl"},re={class:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold text-sm"},oe={class:"text-sm font-medium text-gray-900 dark:text-white"},se={class:"text-xs text-gray-500 dark:text-gray-400"},le={key:1},ne={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},de={value:null},ie=["value"],ce={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},ue={class:"grid grid-cols-3 gap-2"},ge=["onClick"],ye={class:"text-xs font-medium text-gray-700 dark:text-gray-300"},pe={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},me=["placeholder"],be={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},ke={class:"flex gap-2 mb-2"},ve=["onClick"],xe={class:"flex gap-3"},fe={class:"flex-1"},_e={class:"w-28"},he={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},we={class:"flex gap-2"},Ce=["onClick"],$e={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},De=["placeholder"],Te={key:2,class:"text-sm text-red-500"},Ve={class:"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50"},Se=["disabled"],Ee={__name:"TaskModal",props:{show:{type:Boolean,default:!1},lead:{type:Object,default:null},task:{type:Object,default:null},leads:{type:Array,default:()=>[]},panelType:{type:String,default:"business",validator:d=>["business","saleshead"].includes(d)}},emits:["close","saved"],setup(d,{emit:U}){const{t:a}=P(),i=d,_=U,D=p(()=>i.panelType==="saleshead"?"sales-head":"business"),r=C({title:"",description:"",type:"task",priority:"medium",due_date:"",due_time:"10:00",lead_id:null}),y=C(!1),g=C(""),z=p(()=>[{value:"call",label:a("components.task.type_call"),icon:H,color:"text-green-500"},{value:"meeting",label:a("components.task.type_meeting"),icon:J,color:"text-blue-500"},{value:"email",label:a("components.task.type_email"),icon:Q,color:"text-purple-500"},{value:"task",label:a("components.task.type_task"),icon:R,color:"text-orange-500"},{value:"follow_up",label:a("components.task.type_follow_up"),icon:K,color:"text-indigo-500"},{value:"other",label:a("components.task.type_other"),icon:W,color:"text-gray-500"}]),I=p(()=>[{value:"low",label:a("components.task.priority_low"),color:"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"},{value:"medium",label:a("components.task.priority_medium"),color:"bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400"},{value:"high",label:a("components.task.priority_high"),color:"bg-orange-100 text-orange-600 dark:bg-orange-900/30 dark:text-orange-400"},{value:"urgent",label:a("components.task.priority_urgent"),color:"bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400"}]),M=p(()=>[{label:a("components.task.today"),days:0},{label:a("components.task.tomorrow"),days:1},{label:a("components.task.in_3_days"),days:3},{label:a("components.task.in_week"),days:7}]),O=c=>{const o=new Date;o.setDate(o.getDate()+c),r.value.due_date=o.toISOString().split("T")[0]};E(()=>i.show,c=>{if(c){if(i.task)r.value={title:i.task.title,description:i.task.description||"",type:i.task.type,priority:i.task.priority,due_date:i.task.due_date?.split(" ")[0]||"",due_time:i.task.due_date?.split(" ")[1]?.slice(0,5)||"10:00",lead_id:i.task.lead_id};else{const o=new Date;o.setDate(o.getDate()+1),r.value={title:"",description:"",type:"call",priority:"medium",due_date:o.toISOString().split("T")[0],due_time:"10:00",lead_id:i.lead?.id||null}}g.value=""}});const h=p(()=>r.value.title.trim()&&r.value.due_date),A=async()=>{if(!(!h.value||y.value)){y.value=!0,g.value="";try{await B();const c={title:r.value.title,description:r.value.description||null,type:r.value.type,priority:r.value.priority,due_date:`${r.value.due_date} ${r.value.due_time}:00`,lead_id:r.value.lead_id},o=i.task?route(`${D.value}.tasks.update`,i.task.id):route(`${D.value}.tasks.store`),e=i.task?await window.axios.put(o,c):await window.axios.post(o,c);e.data.success?(_("saved",e.data.task),_("close")):g.value=e.data.error||e.data.message||a("common.error_occurred")}catch(c){if(console.error("Failed to save task:",c),G(c)){g.value=a("common.session_expired"),await B();return}c.response?.data?.error?g.value=c.response.data.error:c.response?.data?.message?g.value=c.response.data.message:g.value=a("common.network_error")}finally{y.value=!1}}},w=()=>{_("close")};return(c,o)=>(n(),V(N,{to:"body"},[$(j,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:S(()=>[d.show?(n(),u("div",Y,[t("div",{class:"fixed inset-0 bg-black/50",onClick:w}),$(j,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:S(()=>[d.show?(n(),u("div",Z,[t("div",q,[t("h3",ee,s(d.task?l(a)("components.task.edit_title"):l(a)("components.task.new_title")),1),t("button",{onClick:w,class:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"},[$(l(X),{class:"w-5 h-5"})])]),t("div",te,[d.lead?(n(),u("div",ae,[t("div",re,s(d.lead.name?.charAt(0)?.toUpperCase()||"?"),1),t("div",null,[t("p",oe,s(d.lead.name),1),t("p",se,s(d.lead.phone),1)])])):m("",!0),!d.lead&&d.leads.length>0?(n(),u("div",le,[t("label",ne,s(l(a)("components.task.lead_optional")),1),b(t("select",{"onUpdate:modelValue":o[0]||(o[0]=e=>r.value.lead_id=e),class:"w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"},[t("option",de,s(l(a)("components.task.no_lead")),1),(n(!0),u(k,null,v(d.leads,e=>(n(),u("option",{key:e.id,value:e.id},s(e.name)+" - "+s(e.phone),9,ie))),128))],512),[[F,r.value.lead_id]])])):m("",!0),t("div",null,[t("label",ce,s(l(a)("components.task.task_type")),1),t("div",ue,[(n(!0),u(k,null,v(z.value,e=>(n(),u("button",{key:e.value,onClick:T=>r.value.type=e.value,class:x(["flex flex-col items-center gap-1 p-3 rounded-xl border-2 transition-all",r.value.type===e.value?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"])},[(n(),V(L(e.icon),{class:x(["w-5 h-5",e.color])},null,8,["class"])),t("span",ye,s(e.label),1)],10,ge))),128))])]),t("div",null,[t("label",pe,s(l(a)("components.task.title_label")),1),b(t("input",{"onUpdate:modelValue":o[1]||(o[1]=e=>r.value.title=e),type:"text",placeholder:l(a)("components.task.title_placeholder"),class:"w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-900 dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,8,me),[[f,r.value.title]])]),t("div",null,[t("label",be,s(l(a)("components.task.due_date")),1),t("div",ke,[(n(!0),u(k,null,v(M.value,e=>(n(),u("button",{key:e.days,onClick:T=>O(e.days),class:"px-3 py-1.5 text-xs font-medium bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors"},s(e.label),9,ve))),128))]),t("div",xe,[t("div",fe,[b(t("input",{"onUpdate:modelValue":o[2]||(o[2]=e=>r.value.due_date=e),type:"date",class:"w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[f,r.value.due_date]])]),t("div",_e,[b(t("input",{"onUpdate:modelValue":o[3]||(o[3]=e=>r.value.due_time=e),type:"time",class:"w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[f,r.value.due_time]])])])]),t("div",null,[t("label",he,s(l(a)("components.task.priority")),1),t("div",we,[(n(!0),u(k,null,v(I.value,e=>(n(),u("button",{key:e.value,onClick:T=>r.value.priority=e.value,class:x(["flex-1 py-2 px-3 text-sm font-medium rounded-xl transition-all",r.value.priority===e.value?e.color+" ring-2 ring-offset-2 ring-blue-500":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600"])},s(e.label),11,Ce))),128))])]),t("div",null,[t("label",$e,s(l(a)("components.task.description_optional")),1),b(t("textarea",{"onUpdate:modelValue":o[4]||(o[4]=e=>r.value.description=e),rows:"2",placeholder:l(a)("components.task.description_placeholder"),class:"w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-900 dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"},null,8,De),[[f,r.value.description]])]),g.value?(n(),u("p",Te,s(g.value),1)):m("",!0)]),t("div",Ve,[t("button",{onClick:w,class:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 font-medium rounded-xl transition-colors"},s(l(a)("common.cancel")),1),t("button",{onClick:A,disabled:!h.value||y.value,class:x(["px-6 py-2 font-medium rounded-xl transition-colors",h.value&&!y.value?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"])},s(y.value?l(a)("common.saving"):d.task?l(a)("common.save"):l(a)("common.create")),11,Se)])])):m("",!0)]),_:1})])):m("",!0)]),_:1})]))}};export{Ee as _};
